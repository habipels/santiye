{% extends "homebase.html" %}
{% load i18n %}
{% load custom_tags %}
{% load static %}
{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<!-- Ana stil dosyasÄ±nÄ± doÄŸru ÅŸekilde dahil edelim -->
<link rel="stylesheet" href="{% static 'go/style/style.css' %}">
<link rel="stylesheet" href="{% static 'go/content/style/report.css' %}">
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://momentjs.com/downloads/moment.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<!-- Add missing static references -->
<script src="{% static 'go/content/script/report-card-layout.js' %}"></script>

<style>

    
table {
    border-collapse: collapse;
    background-color: #fff;
  }
  table tr,
  table td,
  table th {
    border: 1px solid #bbb;
    padding: 2px 0px;
  }
  table th {
    background-color: #d1084b;
    color: #fff;
    font-weight: 600;
  }
                              
                        
        .report-container {
            display: flex;
            height: calc(100vh - 60px);
            background: #f5f5f5;
            gap: 24px;
            padding: 24px;
        }

        .report-sidebar {
            width: 320px;
            background: #fff;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            height: calc(100vh - 108px);
        }

        .sidebar-scroll {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .report-main {
            flex: 1;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            overflow: auto;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .sidebar-title {
            font-size: 18px;
            font-weight: 600;
            color: #052941;
            margin-bottom: 16px;
        }

        .sidebar-filters {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .filter-group {
            margin-bottom: 16px;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .components-list {
            flex: 1;
            overflow: auto;
            padding: 20px;
        }

        .component-category {
            margin-bottom: 24px;
        }

        .category-title {
            font-size: 16px;
            font-weight: 600;
            color: #052941;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .component-item {
            padding: 12px;
            background: #f8f8f8;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .component-item:hover {
            background: #f0f0f0;
            border-color: #22D6B5;
        }

        .component-item.selected {
            background: #22D6B514;
            border-color: #22D6B5;
            color: #22D6B5;
        }

        .component-icon {
            width: 32px;
            height: 32px;
            background: #fff;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .component-info {
            flex: 1;
        }

        .component-name {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .component-desc {
            font-size: 12px;
            color: #666;
        }

        .preview-container {
            max-width: 210mm;
            margin: 0 auto;
            /*padding: 20mm;*/
            background: #fff;
        }

        .preview-header {
            margin-bottom: 15mm;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 5mm;
        }

        .preview-title {
            font-size: 18px;
            font-weight: 600;
            color: #052941;
            margin-bottom: 4px;
        }

        .preview-subtitle {
            font-size: 14px;
            color: #666;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 15mm;
        }

        .report-card {
            position: relative;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .report-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card-header {
            background: none;
            padding: 0 0 10px 0;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
            color: #052941;
        }

        .card-body {
            padding: 0;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #052941;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .trend {
            font-size: 12px;
            margin-top: 4px;
        }

        .chart-container {
            height: 250px;
        }

        .text-editor {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }

        .editor-toolbar {
            padding: 8px;
            background: #f8f8f8;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            gap: 8px;
        }

        .toolbar-btn {
            padding: 6px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 4px;
        }

        .toolbar-btn:hover {
            background: #e0e0e0;
        }

        .editor-content {
            padding: 12px;
            min-height: 100px;
        }

        .card-actions {
            display: flex;
            gap: 4px;
        }

        .card-action-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .card-action-btn:hover {
            background: #e0e0e0;
            color: #052941;
        }

        .move-handle {
            cursor: move;
        }

        /* Boyut sÄ±nÄ±flarÄ± */
        .report-card[data-size="small"] {
            grid-column: span 4;
        }

        .report-card[data-size="medium"] {
            grid-column: span 4;
        }

        .report-card[data-size="large"] {
            grid-column: span 8;
        }

        .report-card[data-size="full"] {
            grid-column: span 12;
        }

        @media print {
            body {
                background: #fff;
            }

            .report-sidebar,
            .preview-actions {
                display: none !important;
            }

            .report-container {
                padding: 0;
                height: auto;
            }

            .report-main {
                margin: 0;
                padding: 0;
                box-shadow: none;
            }

            .preview-container {
                padding: 0;
            }

            .preview-grid {
                gap: 10mm;
            }

            .report-card {
                page-break-inside: avoid;
            }

            .card-actions {
                display: none;
            }
        }

        /* Åžablon seÃ§ici stilleri */
        .template-selector {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .template-item {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .template-item:hover {
            border-color: #22D6B5;
        }

        .template-item.selected {
            border-color: #22D6B5;
            background: #22D6B514;
        }

        .template-preview {
            height: 100px;
            background: #f8f8f8;
            border-radius: 4px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .template-name {
            font-size: 14px;
            font-weight: 500;
            text-align: center;
        }

        /* Sayfa yÃ¶netimi stilleri */
        .page-tabs {
            display: flex;
            gap: 2px;
            padding: 0 20px;
            background: #f8f8f8;
            border-bottom: 1px solid #e0e0e0;
        }

        .page-tab {
            padding: 12px 20px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            position: relative;
            top: 1px;
        }

        .page-tab.active {
            border-bottom-color: #fff;
        }

        .page-tab-add {
            width: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        /* Rapor kaydetme formu */
        .save-report-form {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            width: 400px;
            z-index: 1000;
        }

        .form-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        /* Sayfa ayarlarÄ± - sabit alt kÄ±sÄ±m */
        .page-settings {
            flex-shrink: 0;
            border-top: 1px solid #E2E8F0;
            background: #fff;
            padding: 20px;
            border-radius: 0 0 12px 12px;
        }

        /* Components section */
        .components-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .components-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        /* SÃ¼rÃ¼kle-bÄ±rak ve boyutlandÄ±rma iÃ§in yeni stiller */
        .drop-zone {
            min-height: 100px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #f8f8f8;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .drop-zone.drag-over {
            border-color: #22D6B5;
            background: #22D6B514;
        }

        .drop-zone .drop-text {
            color: #666;
            font-size: 14px;
        }

        .resize-handle {
            position: absolute;
            background: transparent;
            z-index: 1000;
        }

        .resize-handle-e {
            top: 0;
            right: 0;
            width: 8px;
            height: 100%;
            cursor: e-resize;
        }

        .resize-handle-s {
            bottom: 0;
            left: 0;
            width: 100%;
            height: 8px;
            cursor: s-resize;
        }

        .resize-handle-se {
            bottom: 0;
            right: 0;
            width: 15px;
            height: 15px;
            cursor: se-resize;
            border-right: 3px solid #22D6B5;
            border-bottom: 3px solid #22D6B5;
            border-radius: 0 0 8px 0;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .report-card:hover .resize-handle-se {
            opacity: 1;
        }

        .card-move-handle {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 20px;
            height: 20px;
            background: #f0f0f0;
            border-radius: 4px;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            display: none;
        }

        .report-card:hover .card-move-handle {
            display: flex;
        }

        /* Grid sistemi iÃ§in yeni stiller */
        .report-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
             /* ðŸ”¥ TAM KAPLAMA */
            height: 100%;
            width: 100%;

            box-sizing: border-box;
        }

        .report-row {
            display: flex;
            gap: 20px;
            min-height: 100px;
            position: relative;
            padding: 10px;
            border: 1px dashed #ccc;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: #fff;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .report-row:hover {
            border-color: #22D6B5;
            background: #f8f8f8;
        }

        .report-column {
            flex: 1;
            min-height: 100px;
            position: relative;
            padding: 10px;
            border: 1px dashed #ddd;
            border-radius: 4px;
            transition: all 0.3s ease;
            background: #fff;
            overflow: hidden; /* TaÅŸmalarÄ± engelle */
        }

        .report-column:hover {
            border-color: #22D6B5;
            background: #f8f8f8;
        }

        /* Row kontrolleri */
        .row-controls {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: flex-end;
            gap: 5px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.9);
            border-bottom: 1px solid #e0e0e0;
            z-index: 1000;
            opacity: 1;
        }

        .report-row:hover .row-controls {
            opacity: 1;
        }

        .row-control-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }

        .row-control-btn:hover {
            background: #22D6B5;
            color: #fff;
        }

        .add-row-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border: none;
            background: #22D6B5;
            border-radius: 50%;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            z-index: 1000;
        }

        .add-row-btn:hover {
            background: #1ab3a0;
            transform: scale(1.1);
        }

        /* Kolon kontrolleri */
        .column-controls {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .report-column:hover .column-controls {
            opacity: 1;
        }

        .column-control-btn {
            width: 20px;
            height: 20px;
            border: none;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .column-control-btn:hover {
            background: #22D6B5;
            color: #fff;
        }

        /* BoyutlandÄ±rma tutamaÃ§larÄ± */
        .row-resize-handle {
            position: absolute;
            bottom: -5px;
            left: 0;
            right: 0;
            height: 10px;
            background: #22D6B5;
            cursor: row-resize;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .report-row:hover .row-resize-handle {
            opacity: 1;
        }

        /* Kolon boyutlandÄ±rma tutamaÃ§larÄ± */
        .column-resize-handle {
            position: absolute;
            right: -5px;
            top: 0;
            bottom: 0;
            width: 10px;
            background: #22D6B5;
            cursor: col-resize;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .report-column:hover .column-resize-handle {
            opacity: 1;
        }

        /* Grid ayarlarÄ± */
        .grid-settings {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .grid-settings-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: #fff;
            border-radius: 8px;
            color: #052941;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }

        .grid-settings-btn:hover {
            background: #f8f8f8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Responsive tasarÄ±m */
        @media (max-width: 768px) {
            .report-row {
                flex-direction: column;
            }
            
            .report-column {
                width: 100%;
            }
        }

        .report-info {
            width: 100%;
            /* DiÄŸer stil tanÄ±mlamalarÄ± */
        }

        .text-content {
            padding: 15px;
            min-height: 100px;
            background: #fff;
            border-radius: 4px;
        }

        .text-edit-modal .modal-content {
            width: 80%;
            max-width: 800px;
        }

        .text-edit-modal .editor-content {
            min-height: 300px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            margin-top: 10px;
        }

        .text-edit-modal .editor-toolbar {
            padding: 10px;
            background: #f8f8f8;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            display: flex;
            gap: 5px;
        }

        .text-edit-modal .toolbar-btn {
            padding: 8px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 4px;
            color: #666;
        }

        .text-edit-modal .toolbar-btn:hover {
            background: #e0e0e0;
            color: #052941;
        }

        /* BorÃ§/Alacak BileÅŸeni Stilleri */
        .deleted-row {
            background-color: #f1f1f1;
            color: #888;
        }
        
        .borc-alacak-filters {
            margin-bottom: 15px;
            background: #f8f9fa;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 12px;
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .filter-row:last-child {
            margin-bottom: 0;
        }
        
        .filter-group {
            flex: 1;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #64748b;
        }
        
        .apply-filters-btn {
            margin-top: 22px;
            padding: 8px 15px;
            background: #052941;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .apply-filters-btn:hover {
            background: #0b3b5f;
        }
        
        .minimal-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .minimal-table th {
            text-align: left;
            padding: 10px;
            background: #f1f5f9;
            color: #64748b;
            font-weight: 600;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .minimal-table td {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
            color: #334155;
        }
        
        .minimal-table tr:last-child td {
            border-bottom: none;
        }
        
        .minimal-table .amount-col {
            font-weight: 600;
            text-align: right;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
        }
        
        .status-badge.borc {
            background: #fee2e2;
            color: #b91c1c;
        }
        
        .status-badge.alacak {
            background: #dcfce7;
            color: #15803d;
        }
        
        .borc-alacak-summary {
            margin-top: 15px;
            background: #f8f9fa;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 12px;
        }
        
        /* Resize handle dÃ¼zeltmeleri */
        .resize-handle-e, 
        .resize-handle-s, 
        .resize-handle-se {
            position: absolute;
            background: #22D6B5;
            z-index: 100;
        }
        
        .resize-handle-e {
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            cursor: e-resize;
        }
        
        .resize-handle-s {
            left: 0;
            bottom: 0;
            width: 100%;
            height: 4px;
            cursor: s-resize;
        }
        
        .resize-handle-se {
            right: 0;
            bottom: 0;
            width: 8px;
            height: 8px;
            cursor: se-resize;
            border-radius: 50%;
        }
        
        .component-controls {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .component-controls > div {
            pointer-events: auto;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #e2e8f0;
        }
        
        .summary-row:last-child {
            border-bottom: none;
        }
        
        .summary-row.total {
            margin-top: 5px;
            padding-top: 10px;
            border-top: 2px solid #e2e8f0;
            font-weight: 700;
        }
        
        .summary-label {
            color: #64748b;
        }
        
        .summary-value {
            font-weight: 600;
        }
        
        .summary-value.borc {
            color: #b91c1c;
        }
        
        .summary-value.alacak {
            color: #15803d;
        }
        
        .summary-value.net-positive {
            color: #15803d;
        }
        
        .summary-value.net-negative {
            color: #b91c1c;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-left: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #052941;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .page-tabs-container {
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .page-tabs {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            overflow-x: auto;
        }

        .page-tab {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            background: #f5f5f5;
            border-radius: 4px;
            cursor: pointer;
            white-space: nowrap;
        }

        .page-tab.active {
            background: #007bff;
            color: white;
        }

        .page-tab .remove-page-tab {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 0;
        }

        .add-page-tab {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        .pages-container {
            position: relative;
        }

        .page-content {
            display: none;
            padding: 20px;
        }

        .page-content.active {
            display: block;
        }

        /* Åžablon SeÃ§ici Stilleri */
        .template-selector {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .template-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .template-item {
            cursor: pointer;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .template-item:hover {
            border-color: #007bff;
            box-shadow: 0 0 10px rgba(0,123,255,0.2);
        }

        .template-item img {
            width: 100%;
            height: auto;
            margin-bottom: 10px;
        }

        /* BileÅŸen Paneli Stilleri */
        .components-panel {
            position: fixed;
            right: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: #fff;
            border-left: 1px solid #ddd;
            padding: 20px;
            overflow-y: auto;
        }

        .components-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .component-item {
            cursor: move;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            transition: all 0.3s;
        }

        .component-item:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }

        .component-item i {
            font-size: 24px;
            margin-bottom: 5px;
        }

        /* Sayfa Ä°Ã§eriÄŸi Stilleri */
        .page-content {
            min-height: 500px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fff;
        }

        /* SÃ¼rÃ¼kle-BÄ±rak AlanÄ± */
        .drop-zone {
            min-height: 100px;
            border: 2px dashed #ddd;
            border-radius: 4px;
            margin: 10px 0;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .drop-zone.drag-over {
            border-color: #007bff;
            background: rgba(0,123,255,0.1);
        }

        /* BileÅŸen BoyutlandÄ±rma */
        .component-resize {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #007bff;
            border-radius: 50%;
        }

        .component-resize.nw { top: -5px; left: -5px; cursor: nw-resize; }
        .component-resize.ne { top: -5px; right: -5px; cursor: ne-resize; }
        .component-resize.sw { bottom: -5px; left: -5px; cursor: sw-resize; }
        .component-resize.se { bottom: -5px; right: -5px; cursor: se-resize; }

        /* Tablo Stilleri */
        .table-container {
            width: 100%;
            max-width: 100%;
            overflow-x: auto;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            background: #fff;
        }

        .table {
            width: 100%;
            margin-bottom: 0;
            border-collapse: collapse;
            font-size: 12px;
            table-layout: fixed;
        }

        .table th,
        .table td {
            padding: 3px;
            border: 1px solid #e9ecef;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
            min-width: 100px;
        }

        .table th {
            background-color: var(--light-color);
            color: var(--dark-color);
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .table tbody tr:nth-child(even) {
            background-color: var(--light-color);
        }

        .table tbody tr:hover {
            background-color: rgba(0, 123, 255, 0.05);
        }

        /* Ä°lerleme GrafiÄŸi */
        .progress-chart {
            width: 100%;
            height: 300px;
            margin-bottom: 20px;
        }

        /* GÃ¶rev Tablosu */
        .task-table .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .task-table .status.completed {
            background-color: #d4edda;
            color: #155724;
        }

        .task-table .status.in-progress {
            background-color: #fff3cd;
            color: #856404;
        }

        .task-table .status.pending {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Personel Listesi */
        .staff-table .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .staff-table .department {
            font-size: 11px;
            color: #6c757d;
        }

        /* Puantaj Tablosu */
        .time-sheet-table .date {
            min-width: 100px;
        }

        .time-sheet-table .hours {
            text-align: center;
            min-width: 80px;
        }

        /* Ä°zin Takibi */
        .leave-table .leave-type {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .leave-table .leave-type.annual {
            background-color: #cce5ff;
            color: #004085;
        }

        .leave-table .leave-type.sick {
            background-color: #fff3cd;
            color: #856404;
        }

        .leave-table .leave-type.other {
            background-color: #e2e3e5;
            color: #383d41;
        }

        /* YazdÄ±rma Stilleri */
        @media print {
            /* UI Elementlerini Gizle */
            .row-controls,
            .column-controls,
            .row-resize-handle,
            .component-resize,
            .ui-draggable-handle,
            .ui-droppable,
            .drop-zone,
            .drop-text,
            .remove-page-tab,
            .add-page-tab,
            .action-btn,
            .grid-settings,
            .report-sidebar {
                display: none !important;
            }

            /* SÃ¼rÃ¼kle-BÄ±rak GÃ¶stergelerini Temizle */
            .ui-draggable,
            .ui-droppable {
                cursor: default !important;
            }

            /* Tablo Stillerini DÃ¼zenle */
            .table-container {
                page-break-inside: avoid;
                width: 100% !important;
                max-width: 100% !important;
                border: none !important;
            }
            
            .table {
                font-size: 10px;
                width: 100% !important;
                border-collapse: collapse;
            }
            
            .table th,
            .table td {
                padding: 3px;
                max-width: none !important;
                border: 1px solid #000 !important;
            }

            /* Rapor Container Stillerini DÃ¼zenle */
            .report-container {
                display: block !important;
                height: auto !important;
                padding: 0 !important;
                background: none !important;
            }

            .report-main {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
            }

            /* BileÅŸen Stillerini DÃ¼zenle */
            .component {
                page-break-inside: avoid;
                border: none !important;
                box-shadow: none !important;
                margin-bottom: 20px !important;
            }

            /* Grid YapÄ±sÄ±nÄ± DÃ¼zenle */
            .report-row {
                page-break-inside: avoid;
                display: flex !important;
                margin-bottom: 20px !important;
            }

            .report-column {
                flex: 1 !important;
                page-break-inside: avoid;
            }

            /* Logo ve BaÅŸlÄ±k Stillerini DÃ¼zenle */
            .preview-header {
                margin-bottom: 20px !important;
            }

            .report-logo img {
                max-width: 200px !important;
            }

            .preview-title {
                font-size: 24px !important;
                margin-bottom: 10px !important;
            }

            .preview-subtitle {
                font-size: 14px !important;
                color: #000 !important;
            }
        }

        /* Header Stillerini DÃ¼zenle */
        .preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .report-logo {
            flex: 0 0 25%;
            text-align: left;
        }

        .report-logo img {
            max-height: 60px;
            max-width: 100%;
        }

        .report-info {
            flex: 0 0 50%;
            text-align: center;
        }

        .preview-title {
            font-size: 11px;
            font-weight: 600;
            color: #052941;
            margin-bottom: 5px;
            text-align: center;
            width: 100%;
        }

        .report-date-project {
            flex: 0 0 25%;
            text-align: right;
            font-size: 9px;
            color: #6c757d;
            display: flex;
            flex-direction: column;
        }

        .date-info, .project-info {
            margin-bottom: 3px;
        }

        /* YazdÄ±rma Stillerini DÃ¼zenle */
        @media print {
            .preview-header {
                padding-bottom: 5mm;
                margin-bottom: 10mm;
                display: flex !important;
                align-items: center !important;
                justify-content: space-between !important;
            }
            
            .report-logo {
                flex: 0 0 25% !important;
                text-align: left !important;
            }
            
            .report-logo img {
                max-height: 15mm !important;
                max-width: 100% !important;
            }
            
            .report-info {
                flex: 0 0 50% !important;
                text-align: center !important;
            }
            
            .preview-title {
                font-size: 11px !important;
                font-weight: 600 !important;
                color: #000 !important;
            }
            
            .report-date-project {
                flex: 0 0 25% !important;
                text-align: right !important;
                font-size: 9px !important;
                color: #000 !important;
                display: flex !important;
                flex-direction: column !important;
            }
        }

        .sidebar-section {
            padding: 15px;
            margin-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .section-header {
            margin-bottom: 15px;
        }

        .section-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: #052941;
            margin: 0;
        }

        /* DÃ¼zenlenebilir Metin Stili */
        .editable-text {
            width: 100%;
            min-height: 30px;
            padding: 10px;
            font-size: 11px;
            line-height: 1.5;
            color: #333;
            outline: none;
            border: none;
            background: transparent;
        }

        .editable-text:focus {
            background-color: rgba(0, 123, 255, 0.05);
        }

        .editable-text:empty:before {
            content: attr(data-placeholder);
            color: #999;
        }

        /* Minimal Tablo Stili */
        .minimal-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            margin-bottom: 0;
            table-layout: fixed; /* Tablo geniÅŸliÄŸini dÃ¼zenli tutar */
        }

        /* Resizable sÃ¼tun Ã¶zellikleri */
        .minimal-table th {
            position: relative;
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
            user-select: none; /* Metin seÃ§imini engeller */
        }

        .minimal-table th .resizer {
            position: absolute;
            top: 0;
            right: 0;
            width: 5px;
            height: 100%;
            background-color: transparent;
            cursor: col-resize;
            z-index: 10;
        }

        .minimal-table th .resizer:hover,
        .minimal-table th .resizing {
            background-color: #007bff;
        }

        /* div olarak kullanÄ±lan minimal-table */
        div.minimal-table {
            width: 100%;
            max-width: 100%;
            overflow-x: auto;
            font-size: 11px;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            background: #fff;
        }

        .minimal-table th,
        .minimal-table td {
            padding: 6px 8px;
            text-align: left;
            border: 1px solid #e9ecef;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%; /* HÃ¼cre geniÅŸliÄŸini sÄ±nÄ±rlar */
        }

        .minimal-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .minimal-table tr:hover {
            background-color: rgba(0, 123, 255, 0.05);
        }

        /* Metni Komponenti Stil DÃ¼zenlemeleri */
        .editable-text-container {
            padding: 8px;
            width: 100%;
            height: 100%;
        }

        .editable-text {
            width: 100%;
            min-height: 30px;
            padding: 0;
            font-size: 11px;
            line-height: 1.5;
            color: #333;
            outline: none;
            border: none;
            background: transparent;
        }

        .editable-text:focus {
            background-color: rgba(0, 123, 255, 0.05);
        }

        .editable-text:empty:before {
            content: attr(data-placeholder);
            color: #999;
        }

        .text-component {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 4px;
        }

        /* Tablo container stili */
        .table-container {
            width: 100%;
            max-width: 100%;
            overflow-x: auto; /* Ä°Ã§erik taÅŸarsa yatay kaydÄ±rma Ã§ubuÄŸu ekler */
            border: 1px solid #e9ecef;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        /* Åžablon seÃ§ici iÃ§in stiller */
        .template-item {
            cursor: pointer;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 4px;
            background-color: #f5f5f5;
            transition: all 0.3s ease;
            border: 1px solid #ddd;
        }

        .template-item:hover {
            background-color: #e9e9e9;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .template-item.active {
            background-color: #007bff;
            color: white;
            border-color: #0069d9;
        }

        /* Resizer iÃ§in stiller */
        .resizer {
            position: absolute;
            top: 0;
            right: 0;
            width: 5px;
            height: 100%;
            background: rgba(0, 0, 0, 0.1);
            cursor: col-resize;
            z-index: 10;
        }

        .resizer.resizing {
            background: rgba(0, 0, 0, 0.5);
        }

        th {
            position: relative;
            min-width: 50px;
        }

        .template-selector-container {
            margin-bottom: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
        }

        .template-selector-container h4 {
            margin-top: 0;
            margin-bottom: 15px;
        }

        .template-selector {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .template-item {
            width: 120px;
            border: 2px solid #eee;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .template-item:hover {
            border-color: #007bff;
        }

        .template-item.selected {
            border-color: #007bff;
            background-color: #e9f5ff;
        }

        .template-preview {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
        }

        .template-preview i {
            font-size: 32px;
            color: #666;
        }

        .template-title {
            font-size: 14px;
            font-weight: 500;
        }

        /* Report-charts stili */
        .report-charts {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            width: 100%;
        }
        
        .report-charts .report-card {
            grid-column: span 4; /* Her satÄ±rda 3 kart olacak ÅŸekilde */
        }
        
        /* Ä°Ã§ iÃ§e kartlar iÃ§in ek stil */
        .report-card .report-card {
            grid-column: span 4; /* Ä°Ã§ iÃ§e kartlarda da 3 sÃ¼tunlu dÃ¼zen */
            width: 100%;
            margin: 0;
        }
        
        /* 2 ve 3 sÃ¼tun seÃ§enekleri iÃ§in stiller */
        .report-charts[data-columns="2"] .report-card {
            grid-column: span 6 !important; /* 2 sÃ¼tunlu dÃ¼zen iÃ§in */
        }
        
        .report-charts[data-columns="3"] .report-card {
            grid-column: span 4 !important; /* 3 sÃ¼tunlu dÃ¼zen iÃ§in */
        }
        
        .card-body[data-columns="2"] > .report-card {
            grid-column: span 6 !important; /* 2 sÃ¼tunlu dÃ¼zen iÃ§in */
        }
        
        .card-body[data-columns="3"] > .report-card {
            grid-column: span 4 !important; /* 3 sÃ¼tunlu dÃ¼zen iÃ§in */
        }
        
        /* SÃ¼tun butonlarÄ± iÃ§in stil */
        .column-selector {
            display: flex;
            margin-right: 10px;
        }
        
        .column-btn {
            position: relative;
        }
        
        .column-btn span {
            font-size: 10px;
            position: absolute;
            bottom: 2px;
            right: 2px;
        }
        
        .two-col {
            margin-right: 5px;
        }
        
        /* Kart boyutlandÄ±rma iÃ§in stiller */
        .report-card {
            position: relative;
            transition: box-shadow 0.2s ease;
            min-height: 100px;
        }
        
        .report-card.resizing {
            box-shadow: 0 0 15px rgba(34, 214, 181, 0.5);
            z-index: 100;
        }
        
        .card-resize-handle {
            position: absolute;
            background-color: rgba(34, 214, 181, 0.1);
            transition: background-color 0.2s ease, opacity 0.2s ease;
            opacity: 0;
            z-index: 10;
        }
        
        .report-card:hover .card-resize-handle {
            opacity: 1;
        }
        
        .card-resize-right {
            top: 0;
            right: 0;
            width: 8px;
            height: 100%;
            cursor: ew-resize;
        }
        
        .card-resize-left {
            top: 0;
            left: 0;
            width: 8px;
            height: 100%;
            cursor: ew-resize;
        }
        
        .card-resize-bottom {
            left: 0;
            bottom: 0;
            width: 100%;
            height: 8px;
            cursor: ns-resize;
        }
        
        .card-resize-corner {
            right: 0;
            bottom: 0;
            width: 16px;
            height: 16px;
            cursor: nwse-resize;
            background-color: rgba(34, 214, 181, 0.2);
            border-radius: 0 0 4px 0;
        }
        
        .card-resize-handle:hover {
            background-color: rgba(34, 214, 181, 0.3);
        }
        
        .card-resize-corner:hover {
            background-color: rgba(34, 214, 181, 0.5);
        }
        
        /* Masonry Grid Stilleri */
        .masonry-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-auto-rows: 1px; /* Otomatik satÄ±r boyutlandÄ±rma iÃ§in */
            grid-auto-flow: dense; /* BoÅŸluklarÄ± doldur */
        }
        
        /* Masonry grid iÃ§indeki kartlarÄ±n yÃ¼ksekliÄŸi iÃ§in */
        .masonry-grid .report-card {
            overflow: hidden;
            min-height: 100px;
            /* KartÄ±n kenar boÅŸluklarÄ±yla birlikte yÃ¼ksekliÄŸini ayarla */
            margin-bottom: 15px;
        }
        
        /* Hide-in-pdf sÄ±nÄ±fÄ± iÃ§in stil */
        .report-card.hide-in-pdf {
            opacity: 0.6;
            border: 1px dashed #ccc;
        }
        
        /* PDF Ã§Ä±ktÄ±sÄ± iÃ§in gizleme */
        @media print {
            .hide-in-pdf {
                display: none !important;
            }
            
            .card-resize-handle, 
            .visibility-toggle {
                display: none !important;
            }
        }

        /* Kart boyutlandÄ±rma iÃ§in stiller */
        .card-resize-handle {
            position: absolute;
            background-color: rgba(0, 123, 255, 0.2);
            z-index: 100;
        }
        
        .card-resize-right {
            cursor: ew-resize;
            width: 8px;
            height: calc(100% - 16px);
            right: 0;
            top: 8px;
        }
        
        .card-resize-bottom {
            cursor: ns-resize;
            height: 8px;
            width: calc(100% - 16px);
            bottom: 0;
            left: 8px;
        }
        
        .card-resize-corner {
            cursor: nwse-resize;
            width: 14px;
            height: 14px;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 123, 255, 0.4);
            border-radius: 0 0 4px 0;
        }
        
        .report-card {
            position: relative;
            min-height: 100px;
            transition: box-shadow 0.3s ease;
        }
        
        .report-card.resizing {
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
            z-index: 200;
        }
        
        /* Masonry grid iÃ§in stiller */
        .report-charts, .preview-grid, .card-body[data-columns] {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            width: 100%;
        }
        
        /* Åžablon seÃ§ici iÃ§in stiller */
        .template-item {
            cursor: pointer;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }
        
        .template-item:hover {
            border-color: #007bff;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
        }
        
        .template-item.selected, .template-item.active {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.4);
        }
        
        .template-preview {
            min-height: 100px;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            border: 1px solid #ddd;
        }
        
        .template-name {
            text-align: center;
            font-weight: bold;
        }
        
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        /* Åžablon seÃ§ici iÃ§in stiller */
        .template-item {
            cursor: pointer;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 10px;
            transition: all 0.2s ease;
            background-color: #f9f9f9;
        }

        .template-item:hover {
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.2);
        }

        .template-item.selected, .template-item.active {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.05);
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
        }

        .template-preview {
            min-height: 80px;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            border: 1px solid #eee;
            border-radius: 3px;
            font-size: 0.9em;
            color: #666;
        }

        .template-name {
            text-align: center;
            font-weight: 500;
            font-size: 0.9em;
            color: #444;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        /* Åžablon seÃ§ici bÃ¶lÃ¼mÃ¼ */
        .sidebar-section.template-selector {
            padding: 10px;
            margin-bottom: 15px;
        }

        .sidebar-section.template-selector .section-header {
            margin-bottom: 10px;
        }

        .sidebar-section.template-selector .section-header h3 {
            font-size: 1rem;
            margin: 0;
            padding: 0;
        }

        /* Åžablon seÃ§ici iÃ§in stiller */
        .template-item {
            cursor: pointer;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 10px;
            transition: all 0.2s ease;
            background-color: #f9f9f9;
        }

        .dark-mode .template-item {
            border-color: #333;
            background-color: #202020;
            color: #e0e0e0;
        }

        .template-item:hover {
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.2);
        }

        .dark-mode .template-item:hover {
            border-color: #2196F3;
            box-shadow: 0 0 5px rgba(33, 150, 243, 0.3);
            background-color: #2d2d2d;
        }

        .template-item.selected, .template-item.active {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.05);
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
        }

        .dark-mode .template-item.selected, .dark-mode .template-item.active {
            border-color: #2196F3;
            background-color: rgba(33, 150, 243, 0.15);
            box-shadow: 0 0 5px rgba(33, 150, 243, 0.4);
        }

        .template-preview {
            min-height: 80px;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            border: 1px solid #eee;
            border-radius: 3px;
            font-size: 0.9em;
            color: #666;
        }

        .dark-mode .template-preview {
            background-color: #2d2d2d;
            border-color: #444;
            color: #bbb;
        }

        .template-name {
            text-align: center;
            font-weight: 500;
            font-size: 0.9em;
            color: #444;
        }

        .dark-mode .template-name {
            color: #ccc;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        /* Åžablon seÃ§ici bÃ¶lÃ¼mÃ¼ */
        .sidebar-section.template-selector {
            padding: 10px;
            margin-bottom: 15px;
        }

        .dark-mode .sidebar-section.template-selector {
            background-color: var(--card-bg-color);
            border-color: var(--general-border-color);
        }

        .sidebar-section.template-selector .section-header {
            margin-bottom: 10px;
        }

        .sidebar-section.template-selector .section-header h3 {
            font-size: 1rem;
            margin: 0;
            padding: 0;
        }

        .dark-mode .sidebar-section.template-selector .section-header h3 {
            color: #e0e0e0;
        }

        /* Masonry grid iÃ§in dark mode */
        .dark-mode .report-card {
            background-color: var(--card-bg-color);
            border-color: var(--card-border-color);
            box-shadow: 0 1px 3px var(--card-box-shadow-color);
        }

        .dark-mode .report-card.resizing {
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
        }

        .dark-mode .card-resize-handle {
            background-color: rgba(33, 150, 243, 0.3);
        }

        .dark-mode .card-resize-corner {
            background-color: rgba(33, 150, 243, 0.5);
        }

        /* DateRangePicker iÃ§in z-index dÃ¼zeltmesi */
        .daterangepicker.ltr.show-calendar.opensleft,
        .daterangepicker.ltr.show-calendar.opensright {
            z-index: 9999 !important; /* YÃ¼ksek z-index deÄŸeri menÃ¼nÃ¼n Ã¶nÃ¼nde gÃ¶rÃ¼nmesini saÄŸlar */
        }
        
        /* DateRangePicker iÃ§in dark mode uyumluluÄŸu */
        .dark-mode .daterangepicker {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border-color: #444;
        }
        
        .dark-mode .daterangepicker .calendar-table {
            background-color: #2d2d2d;
            border-color: #444;
        }
        
        .dark-mode .daterangepicker td.available:hover, 
        .dark-mode .daterangepicker th.available:hover {
            background-color: #444;
        }
        
        .dark-mode .daterangepicker td.in-range {
            background-color: rgba(34, 214, 181, 0.2);
            color: #e0e0e0;
        }
        
        .dark-mode .daterangepicker td.active, 
        .dark-mode .daterangepicker td.active:hover {
            background-color: #22D6B5;
            color: #fff;
        }
        
        .dark-mode .daterangepicker .drp-buttons {
            border-color: #444;
        }
        
        .dark-mode .daterangepicker .drp-selected {
            color: #e0e0e0;
        }
        
        .dark-mode .daterangepicker .btn {
            background-color: #3d3d3d;
            color: #e0e0e0;
            border-color: #555;
        }
        
        .dark-mode .daterangepicker .btn:hover {
            background-color: #4d4d4d;
        }
        
        .dark-mode .daterangepicker .btn-primary {
            background-color: #22D6B5;
            border-color: #22D6B5;
            color: #fff;
        }
        
        .dark-mode .daterangepicker .btn-primary:hover {
            background-color: #1fc0a2;
            border-color: #1fc0a2;
        }

        .template-selector {
            display: none !important;
        }
    </style>
{% endblock head %}
{% block sidebar %}
   <div class="report-container">
        <!-- Sol Panel -->
        <div class="report-sidebar">
            <div class="sidebar-scroll">
                <!-- Filtreler -->
                <div class="sidebar-section filters-section">
                    <div class="section-header">
                        <h3>{% trans 'Rapor AyarlarÄ±' %}</h3>
                    </div>
                    <div class="filter-group">
                        <label>{% trans 'Tarih AralÄ±ÄŸÄ±' %}</label>
                        <input type="text" id="dateRange" class="form-control " />
                    </div>
                    <div class="filter-group">
                        <label>{% trans 'Proje' %}</label>
                        <select id="projectSelect" onchange="getValue()" class="form-control">
                            <option value="0">{% trans 'TÃ¼m Projeler' %}</option>
                            {% for i in santiyeler %}
                                <option value="{{i.id}}">{{i.proje_adi}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- BileÅŸenler -->
                <div class="sidebar-section components-section">
                    <div class="section-header">
                        <h3>{% trans 'BileÅŸenler' %}</h3>
                    </div>
                    
                    <!-- Åžablon SeÃ§ici -->
                    <div class="sidebar-section template-selector" style="display:none;">
                        <div class="section-header">
                            <h3>{% trans 'Åžablon SeÃ§ici' %}</h3>
                        </div>
                        <div id="template-list" class="template-grid">
                            <div class="template-item" data-template="bos">
                                <div class="template-preview">
                                    <i class="fas fa-file"></i>
                                </div>
                                <div class="template-name">{% trans 'BoÅŸ Åžablon' %}</div>
                            </div>
                            <div class="template-item" data-template="finansal">
                                <div class="template-preview">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                                <div class="template-name">{% trans 'Finansal Rapor' %}</div>
                            </div>
                            <div class="template-item" data-template="proje">
                                <div class="template-preview">
                                    <i class="fas fa-project-diagram"></i>
                                </div>
                                <div class="template-name">{% trans 'Proje Raporu' %}</div>
                            </div>
                            <div class="template-item" data-template="personel">
                                <div class="template-preview">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="template-name">{% trans 'Personel Raporu' %}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="components-container">
                        <!-- Finansal BileÅŸenler -->
                        <div class="component-group">
                            <div class="group-title">{% trans 'Finansal' %}</div>
                            <div class="component-item" data-type="gelir-gider">
                                <div class="component-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="component-info">
                                    <div class="component-name">{% trans 'Gelir/Gider Analizi' %}</div>
                                    <div class="component-desc">{% trans 'AylÄ±k gelir ve gider karÅŸÄ±laÅŸtÄ±rmasÄ±' %}</div>
                                </div>
                            </div>
                            <div class="component-item" data-type="kasa-durumu">
                                <div class="component-icon">
                                    <i class="fas fa-wallet"></i>
                                </div>
                                <div class="component-info">
                                    <div class="component-name">{% trans 'Kasa Durumu' %}</div>
                                    <div class="component-desc">{% trans 'GÃ¼ncel kasa ve banka bakiyeleri' %}</div>
                                </div>
                            </div>
                            <div class="component-item" data-type="borc-alacak">
                                <div class="component-icon">
                                    <i class="fas fa-hand-holding-usd"></i>
                                </div>
                                <div class="component-info">
                                    <div class="component-name">{% trans 'BorÃ§/Alacak' %}</div>
                                    <div class="component-desc">{% trans 'BorÃ§ ve alacak takibi' %}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Proje BileÅŸenleri -->
                        <div class="component-group">
                            <div class="group-title">{% trans 'Proje' %}</div>
                            <div class="component-item" data-type="proje-ozeti">
                                <div class="component-icon">
                                    <i class="fas fa-clipboard-list"></i>
                                </div>
                                <div class="component-info">
                                    <div class="component-name">{% trans 'Proje Ã–zeti' %}</div>
                                    <div class="component-desc">{% trans 'Genel proje durumu ve Ã¶zet bilgiler' %}</div>
                                </div>
                            </div>
                            <div class="component-item" data-type="ilerleme-grafik">
                                <div class="component-icon">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <div class="component-info">
                                    <div class="component-name">{% trans 'Ä°lerleme GrafiÄŸi' %}</div>
                                    <div class="component-desc">{% trans 'Ä°ÅŸ paketleri ilerleme durumu' %}</div>
                                </div>
                            </div>
                            <div class="component-item" data-type="gorev-tablosu">
                                <div class="component-icon">
                                    <i class="fas fa-tasks"></i>
                                </div>
                                <div class="component-info">
                                    <div class="component-name">{% trans 'GÃ¶rev Tablosu' %}</div>
                                    <div class="component-desc">{% trans 'DetaylÄ± gÃ¶rev listesi' %}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Personel BileÅŸenleri -->
                        <div class="component-group">
                            <div class="group-title">{% trans 'Personel' %}</div>
                            <div class="component-item" data-type="personel-listesi">
                                <div class="component-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="component-info">
                                    <div class="component-name">{% trans 'Personel Listesi' %}</div>
                                    <div class="component-desc">{% trans 'Aktif personel listesi' %}</div>
                                </div>
                            </div>
                            <div class="component-item" data-type="puantaj">
                                <div class="component-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="component-info">
                                    <div class="component-name">{% trans 'Puantaj' %}</div>
                                    <div class="component-desc">{% trans 'Ã‡alÄ±ÅŸma sÃ¼releri ve mesailer' %}</div>
                                </div>
                            </div>
                            <div class="component-item" data-type="izin-takip">
                                <div class="component-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="component-info">
                                    <div class="component-name">{% trans 'Ä°zin Takibi' %}</div>
                                    <div class="component-desc">{% trans 'Ä°zin kullanÄ±mlarÄ± ve bakiyeler' %}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Metin BileÅŸeni -->
                        <div class="component-item" data-type="metin">
                            <div class="component-icon">
                                <i class="fas fa-font"></i>
                            </div>
                            <div class="component-info">
                                <div class="component-name">{% trans 'Metin' %}</div>
                                <div class="component-desc">{% trans 'Serbest metin ekleyin' %}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SaÄŸ Panel -->
        <div class="report-main">
            <!-- Ãœst Bar -->
            <div class="report-topbar">
                <!-- Sayfa Sekmeleri
                <div class="page-tabs-container">
                <div class="page-tabs">
                        <div class="page-tab active" data-page="page-1">
                        <span>Sayfa 1</span>
                            <button class="remove-page-tab"><i class="fas fa-times"></i></button>
                    </div>
                        <button class="add-page-tab"><i class="fas fa-plus"></i></button>
                </div>
                </div> -->
                
                <div class="report-actions">
                    <button class="action-btn" title="{% trans 'Temizle' %}">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                    <button class="action-btn" title="{% trans 'Kaydet' %}">
                        <i class="fas fa-save"></i>
                    </button>
                    <button class="action-btn" onclick="openPageSettings()" title="{% trans 'Sayfa AyarlarÄ±' %}">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button class="action-btn primary" onclick="window.reportManager.showPdfPreview()" title="{% trans 'PDF Ä°ndir' %}">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>

            <!-- Ã–nizleme -->
            <div class="preview-container">
                <div class="preview-header">
                        <div class="report-logo">
                        <img src="{{logo_islemi.gelir_makbuzu.url}}" alt="Logo" class="logo">
                        </div>
                        <div class="report-info">
                        <div class="preview-title" contenteditable="true" data-placeholder="Rapor BaÅŸlÄ±ÄŸÄ±">{% trans 'Proje Raporu' %}</div>
                            </div>
                    <div class="report-date-project">
                        <div class="date-info">{% trans 'Tarih:' %} <span id="reportDateRange">{% trans '01.03.2024 - 31.03.2024' %}</span></div>
                        <div class="project-info">{% trans 'Proje:' %} <span id="reportProject">{% trans 'TÃ¼m Projeler' %}</span></div>
                    </div>
                </div>

                <!-- Rapor iÃ§eriÄŸi -->
                <div id="reportPreview" class="report-grid">
                    <!-- Åžablon buraya yÃ¼klenecek -->
                </div>
            </div>
        </div>
    </div>

    <!-- Grid ayarlarÄ± butonu -->
    <div class="grid-settings">
        <button class="grid-settings-btn" title="Grid AyarlarÄ±" onclick="window.reportManager.showGridSettings()">
            <i class="fas fa-cog"></i>
        </button>
    </div>

    <!-- Sayfa AyarlarÄ± Modal -->
    <div id="pageSettingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>{% trans 'Sayfa AyarlarÄ±' %}</h3>
                <button class="modal-close" onclick="closePageSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4 class="settings-title">{% trans 'Kenar BoÅŸluklarÄ±' %}</h4>
                    <div class="margin-inputs">
                        <div class="margin-input">
                            <span>{% trans 'Ãœst' %}</span>
                            <input type="number" class="margin-control" data-margin="top" value="5" min="0" max="100">
                        </div>
                        <div class="margin-input">
                            <span>{% trans 'Alt' %}</span>
                            <input type="number" class="margin-control" data-margin="bottom" value="5" min="0" max="100">
                        </div>
                        <div class="margin-input">
                            <span>{% trans 'Sol' %}</span>
                            <input type="number" class="margin-control" data-margin="left" value="4" min="0" max="100">
                        </div>
                        <div class="margin-input">
                            <span>{% trans 'SaÄŸ' %}</span>
                            <input type="number" class="margin-control" data-margin="right" value="4" min="0" max="100">
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h4 class="settings-title">{% trans 'KaÄŸÄ±t Boyutu' %}</h4>
                    <select class="form-control" id="paperSize">
                        <option value="a4">A4</option>
                        <option value="a3">A3</option>
                        <option value="letter">{% trans 'Letter' %}</option>
                    </select>
                </div>
                <div class="settings-section">
                    <h4 class="settings-title">{% trans 'YÃ¶nlendirme' %}</h4>
                    <div class="orientation-options">
                        <label class="orientation-option">
                            <input type="radio" name="orientation" value="portrait" checked>
                            <span>{% trans 'Dikey' %}</span>
                        </label>
                        <label class="orientation-option">
                            <input type="radio" name="orientation" value="landscape">
                            <span>{% trans 'Yatay' %}</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="button" onclick="closePageSettings()">{% trans 'Ä°ptal' %}</button>
                <button class="button button-primary" onclick="savePageSettings()">{% trans 'Kaydet' %}</button>
            </div>
        </div>
    </div>

    <!-- PDF Ã–nizleme ModalÄ± -->
    <div id="pdfPreviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>{% trans 'PDF Ã–nizleme' %}</h3>
                <button class="modal-close" onclick="closePdfPreview()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <iframe id="pdfPreviewFrame" style="width: 100%; height: 500px;" frameborder="0"></iframe>
            </div>
            <div class="modal-footer">
                <button class="button" onclick="closePdfPreview()">{% trans 'Kapat' %}</button>
                <button class="button button-primary" onclick="window.reportManager.exportToPDF()">{% trans 'PDF Ä°ndir' %}</button>
            </div>
        </div>
    </div>

    <!-- Script sÄ±ralamasÄ± Ã¶nemli -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <div>
        <!--DATALAR-->
            {% if request.user.kullanicilar_db %}
        {% ozellikler request.user.kullanicilar_db as ozellikleri %}      
        {% else %}
        {% ozellikler request.user as ozellikleri %}                                            
        {% endif %}
    </div>
    
    
    
<script>
    var santiye = "0";
    function getValue() {
        let selectedValue = document.getElementById("projectSelect").value;
        santiye = selectedValue;
    }
var tarih = "01.03.2024 - 31.03.2024";
class ReportManager {
constructor() {
        this.currentReport = null;
        this.pdfMargins = [5, 4, 5, 4]; // VarsayÄ±lan deÄŸerler: Ãœst, SaÄŸ, Alt, Sol
    this.init();
    this.bindEvents();
}

init() {
    this.initDatePicker();
    this.initDragAndDrop();
        this.initGridSystem();
    }

    initGridSystem() {
        // Ä°lk row'u oluÅŸtur
        this.addRow();
    }

    addRow() {
        const row = $(`
            <div class="report-row">
                <div class="row-controls">
                    <button class="row-control-btn add-column" title="{% trans 'Kolon Ekle' %}">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="row-control-btn remove-row" title="{% trans 'SatÄ±rÄ± Sil' %}">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
                <div class="report-column">
                    <div class="column-controls">
                        <button class="column-control-btn remove-column" title="{% trans 'Kolonu Sil' %}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                    <div class="drop-zone">
                        <span class="drop-text">{% trans 'BileÅŸen eklemek iÃ§in sÃ¼rÃ¼kleyin' %}</span>
                    </div>
                </div>
                <div class="row-resize-handle"></div>
            </div>
        `);

        $('#reportPreview').append(row);
        this.initializeRowControls(row);
        this.initializeDropZones();
    }

    addColumn(row) {
        const column = $(`
            <div class="report-column">
                <div class="column-controls">
                    <button class="column-control-btn remove-column" title="{% trans 'Kolonu Sil' %}">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
                <div class="drop-zone">
                    <span class="drop-text">{% trans 'BileÅŸen eklemek iÃ§in sÃ¼rÃ¼kleyin' %}</span>
                </div>
                <div class="column-resize-handle"></div>
            </div>
        `);

        row.append(column);
        this.initializeColumnControls(column);
        this.initializeDropZones();
    }

    initializeRowControls(row) {
        // Kolon ekleme
        row.find('.add-column').click(() => {
            this.addColumn(row);
        });

        // Row silme
        row.find('.remove-row').click(() => {
            if ($('.report-row').length > 1) {
                row.remove();
            }
        });

        // Row sÃ¼rÃ¼kle-bÄ±rak
        row.draggable({
            handle: '.row-controls',
            cursor: 'move',
            revert: true,
            zIndex: 1000
        });

        row.droppable({
            accept: '.report-row',
            drop: (event, ui) => {
                const draggedRow = ui.draggable;
                const targetRow = $(event.target).closest('.report-row');
                
                if (draggedRow.index() < targetRow.index()) {
                    targetRow.after(draggedRow);
                } else {
                    targetRow.before(draggedRow);
                }
            }
        });

        // Row boyutlandÄ±rma
        const resizeHandle = row.find('.row-resize-handle');
        let startY, startHeight;

        resizeHandle.on('mousedown', (e) => {
            startY = e.clientY;
            startHeight = row.height();
            $(document).on('mousemove', resizeRow);
            $(document).on('mouseup', stopResize);
        });

        const resizeRow = (e) => {
            const newHeight = startHeight + (e.clientY - startY);
            const minHeight = 100; // Minimum yÃ¼kseklik
            const maxHeight = window.innerHeight - 200; // Maksimum yÃ¼kseklik
            
            if (newHeight >= minHeight && newHeight <= maxHeight) {
                row.height(newHeight);
                
                // Ä°Ã§indeki komponentleri yeniden boyutlandÄ±r
                row.find('.report-card').each((_, card) => {
                    const cardHeight = newHeight - 40; // Padding ve margin'leri Ã§Ä±kar
                    $(card).height(cardHeight);
                });
            }
        };

        const stopResize = () => {
            $(document).off('mousemove', resizeRow);
            $(document).off('mouseup', stopResize);
        };
    }

    initializeColumnControls(column) {
        // Kolon silme
        column.find('.remove-column').click(() => {
            const row = column.closest('.report-row');
            if (row.find('.report-column').length > 1) {
                column.remove();
            } else {
                // EÄŸer son kolon ise, satÄ±rÄ± da sil
                row.remove();
            }
        });

        // Kolon boyutlandÄ±rma
        const resizeHandle = column.find('.column-resize-handle');
        let startX, startWidth;

        resizeHandle.on('mousedown', (e) => {
            startX = e.clientX;
            startWidth = column.width();
            $(document).on('mousemove', resizeColumn);
            $(document).on('mouseup', stopResize);
        });

        const resizeColumn = (e) => {
            const newWidth = startWidth + (e.clientX - startX);
            const minWidth = 200; // Minimum geniÅŸlik
            const maxWidth = column.closest('.report-row').width() - 100; // Maksimum geniÅŸlik
            
            if (newWidth >= minWidth && newWidth <= maxWidth) {
                column.width(newWidth);
                
                // Ä°Ã§indeki komponentleri yeniden boyutlandÄ±r
                column.find('.report-card').each((_, card) => {
                    const cardWidth = newWidth - 20; // Padding'leri Ã§Ä±kar
                    $(card).width(cardWidth);
                });
            }
        };

        const stopResize = () => {
            $(document).off('mousemove', resizeColumn);
            $(document).off('mouseup', stopResize);
        };
    }

    bindEvents() {
        // Alt satÄ±r ekleme butonu
        $('.add-row-btn').click(() => {
            this.addRow();
        });

        // Grid ayarlarÄ± butonu
        $('.grid-settings-btn').click(() => {
            this.showGridSettings();
        });

        // Row kontrolleri
        $(document).on('click', '.add-column', (e) => {
            const row = $(e.target).closest('.report-row');
            this.addColumn(row);
        });

        $(document).on('click', '.remove-row', (e) => {
            const row = $(e.target).closest('.report-row');
            if ($('.report-row').length > 1) {
                row.remove();
            }
        });

        // Kolon kontrolleri
        $(document).on('click', '.remove-column', (e) => {
            const column = $(e.target).closest('.report-column');
            const row = column.closest('.report-row');
            if (row.find('.report-column').length > 1) {
                column.remove();
            }
        });
    }

    showGridSettings() {
        const modal = $(`
            <div class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>{% trans 'Grid AyarlarÄ±' %}</h3>
                        <button class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>{% trans 'Kolon SayÄ±sÄ±' %}</label>
                            <select class="form-control" id="columnCount">
                                <option value="1">{% trans '1 Kolon' %}</option>
                                <option value="2">{% trans '2 Kolon' %}</option>
                                <option value="3">{% trans '3 Kolon' %}</option>
                                <option value="4">{% trans '4 Kolo' %}n</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>{% trans 'BoÅŸluk (px)' %}</label>
                            <input type="number" class="form-control" id="gridGap" value="20">
                        </div>
                        <div class="form-group">
                            <label>{% trans 'SatÄ±r YÃ¼ksekliÄŸi (px)' %}</label>
                            <input type="number" class="form-control" id="rowHeight" value="100">
                        </div>
                        <div class="form-group">
                            <label>{% trans 'Kolon GeniÅŸliÄŸi (%)' %}</label>
                            <input type="number" class="form-control" id="columnWidth" value="100">
                        </div>
                        <div class="form-group">
                            <label>{% trans 'SatÄ±r Ekle' %}</label>
                            <div class="row-add-controls">
                                <button class="button" onclick="window.reportManager.addRow()">
                                    <i class="fas fa-plus"></i> {% trans 'Yeni SatÄ±r Ekle' %}
                                </button>
                                <button class="button" onclick="window.reportManager.addRowWithColumns()">
                                    <i class="fas fa-plus"></i> {% trans 'Yeni SatÄ±r (2 Kolon)' %}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="button" onclick="$(this).closest('.modal').remove()">{% trans 'Ä°ptal' %}</button>
                        <button class="button button-primary" onclick="window.reportManager.applyGridSettings()">{% trans 'Uygula' %}</button>
                    </div>
                </div>
            </div>
        `);

        $('body').append(modal);
        modal.addClass('active');

        // Modal kapatma butonu
        modal.find('.modal-close').click(() => {
            modal.remove();
        });
    }

    addRowWithColumns() {
        const row = $(`
            <div class="report-row">
                <div class="row-controls">
                    <button class="row-control-btn add-column" title="{% trans 'Kolon Ekle' %}">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="row-control-btn remove-row" title="{% trans 'SatÄ±rÄ± Sil' %}">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
                <div class="report-column">
                    <div class="column-controls">
                        <button class="column-control-btn remove-column" title="{% trans 'Kolonu Sil' %}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                    <div class="drop-zone">
                        <span class="drop-text">{% trans 'BileÅŸen eklemek iÃ§in sÃ¼rÃ¼kleyin' %}</span>
                    </div>
                </div>
                <div class="report-column">
                    <div class="column-controls">
                        <button class="column-control-btn remove-column" title="{% trans 'Kolonu Sil' %}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                    <div class="drop-zone">
                        <span class="drop-text">{% trans 'BileÅŸen eklemek iÃ§in sÃ¼rÃ¼kleyin' %}</span>
                    </div>
                </div>
                <div class="row-resize-handle"></div>
            </div>
        `);

        $('#reportPreview').append(row);
        this.initializeRowControls(row);
        this.initializeDropZones();
    }

    applyGridSettings() {
        const columnCount = $('#columnCount').val();
        const gap = $('#gridGap').val();
        const rowHeight = $('#rowHeight').val();
        const columnWidth = $('#columnWidth').val();

        // Grid ayarlarÄ±nÄ± uygula
        $('.report-row').css({
            'gap': gap + 'px',
            'min-height': rowHeight + 'px'
        });

        $('.report-column').css({
            'flex': `0 0 ${columnWidth / columnCount}%`
        });

        // ModalÄ± kapat
        $('.modal').remove();

        // Bildirim gÃ¶ster
        this.showNotification('{% trans 'Grid ayarlarÄ± gÃ¼ncellendi' %}');
}

initDatePicker() {
    $('#dateRange').daterangepicker({
        opens: 'left',
        locale: {
            format: 'DD.MM.YYYY',
            separator: ' - ',
                applyLabel: '{% trans 'Uygula' %}',
                cancelLabel: '{% trans 'Ä°ptal' %}',
                daysOfWeek: ['{% trans 'Pz' %}', '{% trans 'Pt' %}', '{% trans 'Sa' %}', '{% trans 'Ã‡a' %}', '{% trans 'Pe' %}', '{% trans 'Cu' %}', '{% trans 'Ct' %}'],
                monthNames: ['{% trans 'Ocak' %}', '{% trans 'Åžubat' %}', '{% trans 'Mart' %}', '{% trans 'Nisan' %}', '{% trans 'MayÄ±s' %}', '{% trans 'Haziran' %}',
                    '{% trans 'Temmuz' %}', '{% trans 'AÄŸustos' %}', '{% trans 'EylÃ¼l' %}', '{% trans 'Ekim' %}', '{% trans 'KasÄ±m' %}', '{% trans 'AralÄ±k' %}'],
            firstDay: 1
        },
        startDate: moment().startOf('month'),
        endDate: moment().endOf('month')
    }, (start, end) => {
        tarih = start.format('DD.MM.YYYY') + ' - ' + end.format('DD.MM.YYYY');
        $('#reportDateRange').text(start.format('DD.MM.YYYY') + ' - ' + end.format('DD.MM.YYYY'));
    });
}

initDragAndDrop() {
    $('.component-item').draggable({
        helper: 'clone',
        appendTo: 'body',
        zIndex: 1000,
        cursor: 'move'
    });

    this.initializeDropZones();
}

initializeDropZones() {
    $('.drop-zone').droppable({
        accept: '.component-item',
        hoverClass: 'drop-hover',
        drop: (event, ui) => {
            const type = $(ui.draggable).data('type');
            const component = this.createComponent(type);
            if (component) {
                $(event.target).replaceWith(component);
            }
        }
    });
}

initTemplates() {
        // Ä°ptal edildi - ÅŸablon olaylarÄ± baÅŸka bir yerde yÃ¶netiliyor
        console.log('Template olaylarÄ± ana jQuery bloÄŸunda yÃ¶netiliyor');
        // Buradaki eski event listener kaldÄ±rÄ±ldÄ±
}

loadTemplate(type) {
    let template = '';
    
    switch(type) {
        case 'bos':
            template = `
                    <div class="report-row">
                        <div class="report-column">
                <div class="report-card" data-size="full">
                                <div class="editable-text" contenteditable="true">
                                    <h2>{% trans 'Yeni Rapor' %}</h2>
                                    <p>{% trans 'Rapor iÃ§eriÄŸini dÃ¼zenlemek iÃ§in tÄ±klayÄ±n. Sol menÃ¼den bileÅŸenler ekleyebilirsiniz.' %}</p>
                                </div>
                            </div>
                    </div>
                </div>
            `;
            break;
            
        case 'finansal':
            template = `
                    <div class="report-row">
                        <div class="report-column">
                            <div class="report-card" data-size="full">
                                <div class="editable-text" contenteditable="true">
                                    <h2>{% trans 'Finansal Durum Raporu' %}</h2>
                                    <p>${$('#reportDateRange').text() || '{% trans 'Tarih aralÄ±ÄŸÄ± seÃ§ilmedi' %}'}</p>
                        </div>
                    </div>
                        </div>
                    </div>
                    <div class="report-row">
                        <div class="report-column">
                    <div class="report-card" data-size="medium">
                                <div class="editable-text" contenteditable="true">
                                    <h3>{% trans 'Gelir/Gider Ã–zeti' %}</h3>
                                </div>
                        <div class="drop-zone">
                                    <span class="drop-text">{% trans 'Gelir/gider grafiÄŸi eklemek iÃ§in sÃ¼rÃ¼kleyin' %}</span>
                        </div>
                    </div>
                        </div>
                        <div class="report-column">
                    <div class="report-card" data-size="medium">
                                <div class="editable-text" contenteditable="true">
                                    <h3>{% trans 'Kasa Durumu' %}</h3>
                                </div>
                        <div class="drop-zone">
                                    <span class="drop-text">{% trans 'Kasa durumu tablosu eklemek iÃ§in sÃ¼rÃ¼kleyin' %}</span>
                        </div>
                    </div>
                        </div>
                    </div>
                    <div class="report-row">
                        <div class="report-column">
                    <div class="report-card" data-size="full">
                                <div class="editable-text" contenteditable="true">
                                    <h3>{% trans 'Finansal Tablo' %}</h3>
                                </div>
                        <div class="drop-zone">
                                    <span class="drop-text">{% trans 'Finansal tablo eklemek iÃ§in sÃ¼rÃ¼kleyin' %}</span>
                                </div>
                        </div>
                    </div>
                </div>
            `;
            break;
            
        case 'proje':
            template = `
                    <div class="report-row">
                        <div class="report-column">
                            <div class="report-card" data-size="full">
                                <div class="editable-text" contenteditable="true">
                                    <h2>{% trans 'Proje Ä°lerleme Raporu' %}</h2>
                                    <p>${$('#reportDateRange').text() || '{% trans 'Tarih aralÄ±ÄŸÄ± seÃ§ilmedi' %}'}</p>
                        </div>
                    </div>
                        </div>
                    </div>
                    <div class="report-row">
                        <div class="report-column">
                            <div class="report-card" data-size="large">
                                <div class="editable-text" contenteditable="true">
                                    <h3>{% trans 'Proje Durumu' %}</h3>
                                </div>
                        <div class="drop-zone">
                                    <span class="drop-text">{% trans 'Proje durum grafiÄŸi eklemek iÃ§in sÃ¼rÃ¼kleyin' %}</span>
                        </div>
                    </div>
                        </div>
                        <div class="report-column">
                            <div class="report-card" data-size="small">
                                <div class="editable-text" contenteditable="true">
                                    <h3>{% trans 'GÃ¶rev DaÄŸÄ±lÄ±mÄ±' %}</h3>
                                </div>
                        <div class="drop-zone">
                                    <span class="drop-text">{% trans 'GÃ¶rev grafiÄŸi eklemek iÃ§in sÃ¼rÃ¼kleyin' %}</span>
                                </div>
                        </div>
                    </div>
                </div>
            `;
            break;
    }
    
    $('#reportPreview').html(template);
    this.initializeDropZones();
        this.setupComponentControls();
    }

    updatePdfMargins(margins) {
        this.pdfMargins = margins;
        console.log('{% trans 'PDF kenar boÅŸluklarÄ± gÃ¼ncellendi:' %}', this.pdfMargins);
}

showPdfPreview() {
    const modal = document.getElementById('pdfPreviewModal');
    const pdfPreviewFrame = document.getElementById('pdfPreviewFrame');
    modal.classList.add('active');

    // Loading gÃ¶ster
    const loadingEl = $('<div class="loading">PDF oluÅŸturuluyor...</div>');
    $(pdfPreviewFrame).parent().append(loadingEl);

    // PDF ayarlarÄ±
    const opt = {
            margin: this.pdfMargins, // GÃ¼ncellenmiÅŸ kenar boÅŸluklarÄ±nÄ± kullan
        filename: 'rapor.pdf',
        image: { type: 'jpeg', quality: 1 },
        html2canvas: { 
            scale: 2,
            useCORS: true,
            allowTaint: true,
                scrollY: 0,
                onclone: function(clonedDoc) {
                    // Hide-in-pdf sÄ±nÄ±fÄ±na sahip kartlarÄ± gizle
                    $(clonedDoc).find('.report-card.hide-in-pdf').css('display', 'none');
                    
                    // UI Elementlerini Gizle
                    $(clonedDoc).find('.row-controls, .column-controls, .row-resize-handle, .component-resize, .ui-draggable-handle, .drop-zone, .drop-text, .remove-page-tab, .add-page-tab, .action-btn, .grid-settings, .report-sidebar, .card-resize-handle, .card-visibility-toggle').hide();
                    
                    // SÃ¼rÃ¼kle bÄ±rak sÄ±nÄ±flarÄ±nÄ± kaldÄ±r
                    $(clonedDoc).find('.ui-draggable, .ui-droppable, .ui-resizable').removeClass('ui-draggable ui-droppable ui-resizable ui-draggable-handle');
                    
                    // SatÄ±r ve sÃ¼tun Ã§izgilerini kaldÄ±r
                    $(clonedDoc).find('.report-row').css({
                        'border': 'none',
                        'box-shadow': 'none',
                        'background': 'none',
                        'margin-bottom': '10px'
                    });
                    
                    $(clonedDoc).find('.report-column').css({
                        'border': 'none',
                        'box-shadow': 'none',
                        'background': 'none'
                    });
                    
                    // BileÅŸen stillerini dÃ¼zenle
                    $(clonedDoc).find('.component').css({
                        'border': 'none',
                        'box-shadow': 'none',
                        'margin-bottom': '10px'
                    });
                    
                    // DÃ¼zenlenebilir metin bileÅŸenlerini dÃ¼zenle
                    $(clonedDoc).find('.editable-text').css({
                        'font-size': '11px',
                        'line-height': '1.5',
                        'color': '#000',
                        'padding': '0',
                        'background': 'none'
                    }).attr('contenteditable', 'false');
                    
                    
                    // Minimal tablo stillerini uygula
                    $(clonedDoc).find('.minimal-table').css({
                        'width': '100%',
                        'border-collapse': 'collapse',
                        'font-size': '10px',
                        'table-layout': 'fixed'
                    });
                    
                    $(clonedDoc).find('.minimal-table th').css({
                        'background-color': '#f5f5f5',
                        'padding': '5px',
                        'text-align': 'left',
                        'font-weight': 'bold',
                        'border-bottom': '1px solid #ddd',
                        'overflow': 'hidden',
                        'text-overflow': 'ellipsis',
                        'white-space': 'nowrap'
                    });
                    
                    $(clonedDoc).find('.minimal-table td').css({
                        'padding': '4px',
                        'border-bottom': '1px solid #eee',
                        'overflow': 'hidden',
                        'text-overflow': 'ellipsis',
                        'white-space': 'nowrap'
                    });
                    
                    // Card elementlerini dÃ¼zenle
                    $(clonedDoc).find('.card-actions, .component-controls, .card-header').remove();
                    
                    // Header stillerini dÃ¼zenle
                    $(clonedDoc).find('.preview-header').css({
                        'display': 'flex',
                        'align-items': 'center',
                        'justify-content': 'space-between',
                        'margin-bottom': '20mm',
                        'padding-bottom': '5mm',
                        'border-bottom': '1px solid #000'
                    });

                    $(clonedDoc).find('.report-logo').css({
                        'flex': '0 0 25%',
                        'text-align': 'left'
                    });

                    $(clonedDoc).find('.report-logo img').css({
                        'max-height': '15mm',
                        'max-width': '100%'
                    });

                    $(clonedDoc).find('.report-info').css({
                        'flex': '0 0 50%',
                        'text-align': 'center'
                    });

                    $(clonedDoc).find('.preview-title').css({
                        'font-size': '11px',
                        'font-weight': 'bold',
                        'color': '#000',
                        'margin-bottom': '0',
                        'text-align': 'center',
                        'width': '100%'
                    });

                    $(clonedDoc).find('.report-date-project').css({
                        'flex': '0 0 25%',
                        'text-align': 'right',
                        'font-size': '9px',
                        'color': '#000',
                        'display': 'flex',
                        'flex-direction': 'column'
                    });
                    
                    // Proje Ã¶zeti komponentini Ã¶zel olarak dÃ¼zenle
                    $(clonedDoc).find('.report-card[data-type="proje-ozeti"]').each(function() {
                        // Proje Ã¶zeti kartÄ±nÄ± daha kÃ¼Ã§Ã¼k ve minimal hale getir
                        const projeOzeti = $(this);
                        
                        // Ä°Ã§ grid yapÄ±sÄ±nÄ± dÃ¼zenle
                        projeOzeti.find('.report-charts, .card-body[data-columns]').css({
                            'display': 'grid',
                            'grid-template-columns': 'repeat(12, 1fr)',
                            'gap': '10px', // Daha dar boÅŸluk
                            'padding': '5px', // Daha kÃ¼Ã§Ã¼k padding
                            'margin-bottom': '10px'
                        });
                        
                        // Chart kartlarÄ±nÄ± Ã¶lÃ§eklendir ve dÃ¼zenle
                        projeOzeti.find('.report-card').css({
                            'grid-column': 'span 4', // TÃ¼m kartlarÄ± 3 sÃ¼tunda (12/3 = 4) gÃ¶ster
                            'padding': '5px',
                            'margin-bottom': '5px',
                            'box-shadow': 'none',
                            'border': '1px solid #eaeaea'
                        });
                        
                        // Chart baÅŸlÄ±klarÄ±nÄ± daha kÃ¼Ã§Ã¼k ve Ã¶z hale getir
                        projeOzeti.find('.card-header').css({
                            'padding': '5px',
                            'font-size': '10px',
                            'font-weight': 'bold',
                            'border-bottom': '1px solid #eaeaea'
                        });
                        
                        // Chart Ã¶lÃ§eklerini dÃ¼ÅŸÃ¼r, boyutlarÄ± kÃ¼Ã§Ã¼lt
                        projeOzeti.find('.chart-container, .apexcharts-canvas').css({
                            'max-height': '150px', // Daha kÃ¼Ã§Ã¼k grafikler
                            'overflow': 'hidden'
                        });
                        
                        // ApexCharts kÃ¼Ã§Ã¼ltme
                        projeOzeti.find('.apexcharts-title-text').css('font-size', '10px');
                        projeOzeti.find('.apexcharts-legend-text').css('font-size', '8px');
                        projeOzeti.find('.apexcharts-yaxis-label, .apexcharts-xaxis-label').css('font-size', '8px');
                        
                        // Gereksiz bÃ¶lÃ¼mleri kaldÄ±r
                        projeOzeti.find('.apexcharts-toolbar, .apexcharts-menu-icon').hide();
                    });
                    
                    // Minimal tablo stillerini uygula
                }
        },
        jsPDF: { 
            unit: 'mm', 
            format: 'a4',
            orientation: 'portrait'
        }
    };

    // Gereksiz elementleri gizle
    $('.card-actions, .component-controls, .report-topbar, .report-sidebar').hide();

    // PDF oluÅŸtur
    html2pdf()
        .from(document.querySelector('.preview-container'))
        .set(opt)
        .outputPdf('datauristring')
        .then(uri => {
            // Gizlenen elementleri geri gÃ¶ster
            $('.card-actions, .component-controls, .report-topbar, .report-sidebar').show();
            
            pdfPreviewFrame.src = uri;
            loadingEl.remove();
        })
        .catch(err => {
            // Hata durumunda da gizlenen elementleri geri gÃ¶ster
            $('.card-actions, .component-controls, .report-topbar, .report-sidebar').show();
            
            console.error('PDF oluÅŸturma hatasÄ±:', err);
                loadingEl.text('{% trans "PDF oluÅŸturulurken bir hata oluÅŸtu" %}');
        });
}

exportToPDF() {
    const element = document.querySelector('.preview-container');
    const paperSize = $('#paperSize').val() || 'a4';
    const orientation = $('input[name="orientation"]:checked').val() || 'portrait';

    // PDF ayarlarÄ±
    const opt = {
            margin: this.pdfMargins, // GÃ¼ncellenmiÅŸ kenar boÅŸluklarÄ±nÄ± kullan
            filename: `${this.currentReport?.name || 'report'}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { 
            scale: 2,
            useCORS: true,
            logging: false,
            onclone: function(clonedDoc) {
                    // Hide-in-pdf sÄ±nÄ±fÄ±na sahip kartlarÄ± gizle
                    $(clonedDoc).find('.report-card.hide-in-pdf').css('display', 'none');
                    
                    // UI Elementlerini Gizle
                    $(clonedDoc).find('.row-controls, .column-controls, .row-resize-handle, .component-resize, .ui-draggable-handle, .drop-zone, .drop-text, .remove-page-tab, .add-page-tab, .action-btn, .grid-settings, .report-sidebar, .card-resize-handle, .card-visibility-toggle').hide();
                    
                    // SÃ¼rÃ¼kle bÄ±rak sÄ±nÄ±flarÄ±nÄ± kaldÄ±r
                    $(clonedDoc).find('.ui-draggable, .ui-droppable, .ui-resizable').removeClass('ui-draggable ui-droppable ui-resizable ui-draggable-handle');
                    
                    // SatÄ±r ve sÃ¼tun Ã§izgilerini kaldÄ±r
                    $(clonedDoc).find('.report-row').css({
                        'border': 'none',
                        'box-shadow': 'none',
                        'background': 'none',
                        'margin-bottom': '10px'
                    });
                    
                    $(clonedDoc).find('.report-column').css({
                        'border': 'none',
                        'box-shadow': 'none',
                        'background': 'none'
                    });
                    
                    // BileÅŸen stillerini dÃ¼zenle
                    $(clonedDoc).find('.component').css({
                        'border': 'none',
                        'box-shadow': 'none',
                        'margin-bottom': '10px'
                    });
                    
                    // DÃ¼zenlenebilir metin bileÅŸenlerini dÃ¼zenle
                    $(clonedDoc).find('.editable-text').css({
                        'font-size': '11px',
                        'line-height': '1.5',
                        'color': '#000',
                        'padding': '0',
                        'background': 'none'
                    }).attr('contenteditable', 'false');

                    // Minimal tablo stillerini uygula
                    $(clonedDoc).find('.minimal-table').css({
                        'width': '100%',
                        'border-collapse': 'collapse',
                        'font-size': '10px',
                        'table-layout': 'fixed'
                    });
                    
                    $(clonedDoc).find('.minimal-table th').css({
                        'background-color': '#f5f5f5',
                        'padding': '5px',
                        'text-align': 'left',
                        'font-weight': 'bold',
                        'border-bottom': '1px solid #ddd',
                        'overflow': 'hidden',
                        'text-overflow': 'ellipsis',
                        'white-space': 'nowrap'
                    });
                    
                    $(clonedDoc).find('.minimal-table td').css({
                        'padding': '4px',
                        'border-bottom': '1px solid #eee',
                        'overflow': 'hidden',
                        'text-overflow': 'ellipsis',
                        'white-space': 'nowrap'
                    });

                // Metin bileÅŸenlerini dÃ¼zenle
                $(clonedDoc).find('.report-card[data-type="metin"]').each(function() {
                    const cardBody = $(this).find('.card-body');
                    const textContent = cardBody.find('.text-content').html();
                    
                    // KartÄ± sadece iÃ§erik ile deÄŸiÅŸtir
                    $(this).replaceWith(`<div class="text-content">${textContent}</div>`);
                });

                // TÃ¼m kartlardan card-header'larÄ± kaldÄ±r
                    $(clonedDoc).find('.card-header, .card-actions, .component-controls').remove();

                    // Header stillerini dÃ¼zenle
                $(clonedDoc).find('.preview-header').css({
                        'display': 'flex',
                        'align-items': 'center',
                        'justify-content': 'space-between',
                    'margin-bottom': '20mm',
                        'padding-bottom': '5mm',
                        'border-bottom': '1px solid #000'
                    });

                    $(clonedDoc).find('.report-logo').css({
                        'flex': '0 0 25%',
                        'text-align': 'left'
                });

                $(clonedDoc).find('.report-logo img').css({
                        'max-height': '15mm',
                        'max-width': '100%'
                    });

                    $(clonedDoc).find('.report-info').css({
                        'flex': '0 0 50%',
                        'text-align': 'center'
                });

                $(clonedDoc).find('.preview-title').css({
                        'font-size': '11px',
                    'font-weight': 'bold',
                        'color': '#000',
                        'margin-bottom': '0',
                        'text-align': 'center',
                        'width': '100%'
                    });

                    $(clonedDoc).find('.report-date-project').css({
                        'flex': '0 0 25%',
                        'text-align': 'right',
                        'font-size': '9px',
                        'color': '#000',
                        'display': 'flex',
                        'flex-direction': 'column'
                });

                $(clonedDoc).find('.report-card').css({
                    'page-break-inside': 'avoid',
                        'margin-bottom': '15mm',
                        'border': 'none',
                        'box-shadow': 'none'
                });
            }
        },
        jsPDF: { 
            unit: 'mm', 
            format: paperSize,
            orientation: orientation
        }
    };

    // Loading gÃ¶ster
        const loadingEl = $('<div class="loading-overlay"><div class="loading">{% trans 'PDF indiriliyor...' %}</div></div>');
    $('body').append(loadingEl);

    // PDF'yi oluÅŸtur ve indir
    html2pdf().set(opt).from(element).save().then(() => {
        loadingEl.remove();
            this.showNotification('{% trans 'PDF baÅŸarÄ±yla indirildi' %}');
        closePdfPreview();
    }).catch(err => {
            console.error('{% trans 'PDF indirme hatasÄ±:' %}', err);
        loadingEl.remove();
            this.showNotification('{% trans 'PDF oluÅŸturulurken bir hata oluÅŸtu' %}', 'error');
    });
}

bindEvents() {
    // PDF export
    $('#exportPDFBtn').click(() => this.showPdfPreview());
    
    // Proje seÃ§imi
    $('#projectSelect').change(() => {
        const projectName = $('#projectSelect option:selected').text();
            $('#reportProject').text(projectName || '{% trans "TÃ¼m Projeler" %}');
    });

    // Yeni event'ler
        $('.action-btn[title="{% trans "Temizle" %}"]').click(() => this.showClearConfirm());
        $('.action-btn[title="{% trans "Kaydet" %}"]').click(() => this.showSaveForm());
}

showClearConfirm() {
    const modal = $(`
        <div class="modal confirm-modal">
            <div class="modal-content">
                <div class="modal-header">
                        <h3>{% trans 'Raporu Temizle' %}</h3>
                    <button class="modal-close" onclick="$(this).closest('.modal').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                        <p>{% trans 'Raporu temizlemek istediÄŸinize emin misiniz?' %}</p>
                        <p>{% trans 'Bu iÅŸlem geri alÄ±namaz.' %}</p>
                </div>
                <div class="modal-footer">
                        <button class="button" onclick="$(this).closest('.modal').remove()">{% trans 'Ä°ptal' %}</button>
                        <button class="button button-primary" onclick="window.reportManager.clearReport()">{% trans 'Temizle' %}</button>
                </div>
            </div>
        </div>
    `);

    $('body').append(modal);
    modal.addClass('active');
}

clearReport() {
    // Rapor iÃ§eriÄŸini temizle
    $('#reportPreview').html(`
        <div class="drop-zone" data-size="full">
                <span class="drop-text">{% trans 'BileÅŸen eklemek iÃ§in sÃ¼rÃ¼kleyin' %}</span>
        </div>
    `);

    // Drop zone'larÄ± yeniden aktifleÅŸtir
    this.initializeDropZones();

    // ModalÄ± kapat
    $('.confirm-modal').remove();

    // Bildirim gÃ¶ster
        this.showNotification('{% trans 'Rapor temizlendi' %}');
}

showSaveForm() {
    const modal = $(`
        <div class="modal">
            <div class="modal-content">
                <div class="modal-header">
                        <h3>{% trans 'Raporu Kaydet' %}</h3>
                    <button class="modal-close" onclick="$(this).closest('.modal').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                            <label>{% trans 'Rapor AdÄ±' %}</label>
                        <input type="text" class="form-control" maxlength="200"  id="reportNames" >
                    </div>
                    <div class="form-group">
                            <label>{% trans 'AÃ§Ä±klama' %}</label>
                        <textarea class="form-control" id="reportDescriptions"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                        <button class="button" onclick="$(this).closest('.modal').remove()">{% trans 'Ä°ptal' %}</button>
                        <button class="button button-primary" onclick="saveReport()">{% trans 'Kaydet' %}</button>
                </div>
            </div>
        </div>
    `);

    $('body').append(modal);
    modal.addClass('active');
}


showNotification(message) {
    const notification = $(`
        <div class="notification">
            <i class="icon icon-check"></i>
            <span>${message}</span>
        </div>
    `);

    $('body').append(notification);
    setTimeout(() => notification.remove(), 3000);
}

createComponent(type) {
    let component;
    
    switch(type) {
        case 'gelir-gider':
            component = $(`
                <div class="report-card" data-size="medium">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-chart-line"></i>
                                {% trans 'Gelir/Gider Analizi' %}
                        </div>
                        <div class="card-actions">
                                <button class="card-action-btn remove" title="{% trans 'Sil' %}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="gelirGiderChart"></div>
                    </div>
                    <div class="resize-handle resize-handle-e"></div>
                    <div class="resize-handle resize-handle-s"></div>
                    <div class="resize-handle resize-handle-se"></div>
                </div>
            `);
                setTimeout(() => {
                new ApexCharts(component.find('#gelirGiderChart')[0], {
                    series: [{
                        name: 'Gelir',
                        data: {{ozellikleri.gelir | safe }}
                    }, {
                        name: 'Gider',
                        data: {{ozellikleri.gider | safe }}
                    }],
                    chart: {
                        type: 'area',
                        height: 250,
                        toolbar: { show: false }
                    },
                    colors: ['#22D6B5', '#FF4560'],
                    fill: {
                        type: 'gradient',
                        gradient: {
                            shadeIntensity: 1,
                            opacityFrom: 0.7,
                            opacityTo: 0.2
                        }
                    },
                    dataLabels: { enabled: false },
                    stroke: { curve: 'smooth', width: 2 },
                    xaxis: {
                        categories: {{ozellikleri.aylar | safe }}
                    }
                }).render();
            }, 100);

            // BoyutlandÄ±rma iÅŸlevselliÄŸi
            this.initializeResizeHandles(component);
            
            // ... rest of the component code ...
            break;

        case 'kasa-durumu':
            component = $(`
                <div class="report-card" data-size="small">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-wallet"></i>
                                {% trans 'Kasa Durumu' %}
                        </div>
                        <div class="card-actions">
                                <button class="card-action-btn remove" title="{% trans 'Sil' %}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="kasa-select-wrapper">
                            <select class="kasa-select form-control">
                                    <option value="">{% trans 'Kasa SeÃ§in' %}</option>
                                {% for i in kasa %}
                                    <option value="{{i.id}}">{{i.kasa_adi}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="kasa-info-box">
                            <div class="info-box-content">
                                    <div class="info-box-title">{% trans 'Bakiye' %}</div>
                                <div class="info-box-value">$ <span class="bakiye-value">0</span></div>
                            </div>
                            <div class="info-box-footer">
                                <div class="son-islem">
                                        <small>{% trans 'Son Ä°ÅŸlem:' %} <span class="son-islem-text">-</span></small>
                                </div>
                                    <button class="info-box-btn toggle-movements" title="{% trans 'Hareketleri GÃ¶ster' %}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <div class="kasa-hareketleri" style="display: none;">
                            <div class="hareketler-header">
                                    <h5>{% trans 'Son Hareketler' %}</h5>
                            </div>
                            <div class="hareketler-list"></div>
                        </div>
                    </div>

                    <style>
                        .kasa-select-wrapper {
                            margin-bottom: 15px;
                        }
                        .kasa-info-box {
                            background: #fff;
                            border: 1px solid #e0e0e0;
                            border-radius: 8px;
                            padding: 15px;
                            transition: all 0.3s ease;
                        }
                        .kasa-info-box:hover {
                            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                        }
                        .info-box-title {
                            color: #666;
                            font-size: 14px;
                            margin-bottom: 5px;
                        }
                        .info-box-value {
                            color: #052941;
                            font-size: 24px;
                            font-weight: 600;
                        }
                        .info-box-footer {
                            margin-top: 10px;
                            padding-top: 10px;
                            border-top: 1px solid #e0e0e0;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                        }
                        .son-islem {
                            color: #666;
                            font-size: 12px;
                        }
                        .info-box-btn {
                            background: none;
                            border: none;
                            color: #666;
                            cursor: pointer;
                            padding: 5px;
                            border-radius: 4px;
                            transition: all 0.2s ease;
                        }
                        .info-box-btn:hover {
                            background: #f0f0f0;
                            color: #052941;
                        }
                        .kasa-hareketleri {
                            margin-top: 15px;
                            padding: 15px;
                            border: 1px solid #e0e0e0;
                            border-radius: 8px;
                        }
                        .hareketler-header {
                            margin-bottom: 10px;
                        }
                        .hareketler-header h5 {
                            color: #052941;
                            font-size: 14px;
                            margin: 0;
                        }
                        .hareket-item {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 8px 0;
                            border-bottom: 1px solid #e0e0e0;
                        }
                        .hareket-item:last-child {
                            border-bottom: none;
                        }
                        .hareket-aciklama {
                            flex: 1;
                            font-size: 13px;
                            color: #333;
                        }
                        .hareket-tutar {
                            font-weight: 500;
                            margin-left: 15px;
                        }
                        .hareket-tutar.gelir {
                            color: #22D6B5;
                        }
                        .hareket-tutar.gider {
                            color: #FF4560;
                        }
                    </style>
                    
                    <div class="component-controls">
                        <div class="resize-handle-e"></div>
                        <div class="resize-handle-s"></div>
                        <div class="resize-handle-se"></div>
                     </div>
                </div>
            `);

            // Tarih seÃ§ici baÅŸlat
            component.find('.date-filter').daterangepicker({
                opens: 'left',
                locale: {
                    format: 'DD.MM.YYYY',
                    separator: ' - ',
                        applyLabel: '{% trans 'Uygula' %}',
                        cancelLabel: '{% trans 'Ä°ptal' %}',
                        daysOfWeek: ['Pz', '{% trans 'Pt' %}', '{% trans 'Sa' %}', '{% trans 'Ã‡a' %}', '{% trans 'Pe' %}', '{% trans 'Cu' %}', '{% trans 'Ct' %}'],
                        monthNames: ['{% trans 'Ocak' %}', '{% trans 'Åžubat' %}', '{% trans 'Mart' %}', '{% trans 'Nisan' %}', '{% trans 'MayÄ±s' %}', '{% trans 'Haziran' %}',
                            '{% trans 'Temmuz' %}', '{% trans 'AÄŸustos' %}', '{% trans 'EylÃ¼l' %}', '{% trans 'Ekim' %}', '{% trans 'KasÄ±m' %}', '{% trans 'AralÄ±k' %}'],
                    firstDay: 1
                },
                startDate: moment().startOf('month'),
                endDate: moment().endOf('month')
            });

            // Kasa seÃ§imi deÄŸiÅŸtiÄŸinde
            component.find('.kasa-select').change(function() {
                const kasaId = $(this).val();
                if (!kasaId) return;

                // SeÃ§ilen kasanÄ±n bilgilerini getir
                $.get(`/tr/accounting/kasa_bilgileri/${kasaId}`, function(data) {
                    component.find('.bakiye-value').text(data.bakiye);
                    component.find('.son-islem-text').text(data.son_islem || '-');

                    // Hareketleri gÃ¼ncelle
                    const hareketlerList = component.find('.hareketler-list');
                    hareketlerList.empty();

                    data.hareketler.slice(0, 5).forEach(hareket => {
                        const hareketItem = $(`
                            <div class="hareket-item">
                                <div class="hareket-aciklama">${hareket.aciklama}</div>
                                <div class="hareket-tutar ${hareket.tip === 'gelir' ? 'gelir' : 'gider'}">
                                    ${hareket.tip === 'gelir' ? '+' : '-'} $${hareket.tutar}
                                </div>
                            </div>
                        `);
                        hareketlerList.append(hareketItem);
                    });
                }).fail(function() {
                        alert('{% trans 'Kasa bilgileri alÄ±nÄ±rken bir hata oluÅŸtu.' %}');
                });
            });

            // Hareketleri gÃ¶ster/gizle
            component.find('.toggle-movements').click(function() {
                const hareketler = component.find('.kasa-hareketleri');
                const icon = $(this).find('i');
                
                if (hareketler.is(':visible')) {
                    hareketler.slideUp();
                    icon.removeClass('fa-eye-slash').addClass('fa-eye');
                        $(this).attr('title', '{% trans 'Hareketleri GÃ¶ster' %}');
                } else {
                    hareketler.slideDown();
                    icon.removeClass('fa-eye').addClass('fa-eye-slash');
                        $(this).attr('title', '{% trans 'Hareketleri Gizle' %}');
                }
            });

            break;

        case 'borc-alacak':
            component = $(`
                <div class="report-card" data-size="medium">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-hand-holding-usd"></i>
                                {% trans 'BorÃ§/Alacak' %}
                        </div>
                        <div class="card-actions">
                                <button class="card-action-btn refresh" title="{% trans 'Yenile' %}">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                                <button class="card-action-btn remove" title="{% trans 'Sil' %}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="borc-alacak-filters">
                            <div class="filter-row">
                                <div class="filter-group">
                                        <label>{% trans 'Tarih AralÄ±ÄŸÄ±' %}</label>
                                    <input type="text" class="form-control date-filter" />
                                </div>

                            </div>
                            <div class="filter-row">
                                <div class="filter-group">
                                        <label>{% trans 'TÃ¼r' %}</label>
                                    <select class="form-control type-filter">
                                            <option value="all">{% trans 'TÃ¼mÃ¼' %}</option>
                                            <option value="borc">{% trans 'BorÃ§lar' %}</option>
                                            <option value="alacak">{% trans 'Alacaklar' %}</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                        <button class="apply-filters-btn">{% trans 'Uygula' %}</button>
                                </div>
                            </div>
                        </div>
                        <div class="borc-alacak-content">
                            <table class="minimal-table">
                                <thead>
                                    <tr>
                                        
                                            <th>{% trans 'Cari' %}</th>
                                            <th>{% trans 'AÃ§Ä±klama' %}</th>
                                            <th>{% trans 'Bakiye' %}</th>
                                            <th>{% trans 'Durum' %}</th>
                                    </tr>
                                </thead>
                                <tbody class="cari-data-tbody">
                                    
                                </tbody>
                            </table>
                        </div>
                        <div class="borc-alacak-summary">
                            <div class="summary-row">
                                    <div class="summary-label">{% trans 'Toplam BorÃ§:' %}</div>
                                <div class="summary-value borc" id="total-borc">0 â‚º</div>
                            </div>
                            <div class="summary-row">
                                <div class="summary-label">Toplam Alacak:</div>
                                <div class="summary-value alacak" id="total-alacak">0 â‚º</div>
                            </div>
                            <div class="summary-row total">
                                    <div class="summary-label">{% trans 'Net Durum:' %}</div>
                                <div class="summary-value" id="net-durum">0 â‚º</div>
                            </div>
                        </div>
                    </div>
                    <div class="component-controls">
                        <div class="resize-handle-e"></div>
                        <div class="resize-handle-s"></div>
                        <div class="resize-handle-se"></div>
                    </div>
                </div>
            `);
            
            // Tarih seÃ§ici baÅŸlat
            component.find('.date-filter').daterangepicker({
                opens: 'left',
                locale: {
                    format: 'DD.MM.YYYY',
                    separator: ' - ',
                        applyLabel: '{% trans 'Uygula' %}',
                        cancelLabel: '{% trans 'Ä°ptal' %}',
                        daysOfWeek: ['{% trans 'Pz' %}', '{% trans 'Pt' %}', '{% trans 'Sa' %}', '{% trans 'Ã‡a' %}', '{% trans 'Pe' %}', '{% trans 'Cu' %}', '{% trans 'Ct' %}'],
                        monthNames: ['{% trans 'Ocak' %}', '{% trans 'Åžubat' %}', '{% trans 'Mart' %}', '{% trans 'Nisan' %}', '{% trans 'MayÄ±s' %}', '{% trans 'Haziran' %}',
                            '{% trans 'Temmuz' %}', '{% trans 'AÄŸustos' %}', '{% trans 'EylÃ¼l' %}', '{% trans 'Ekim' %}', '{% trans 'KasÄ±m' %}', '{% trans 'AralÄ±k' %}'],
                    firstDay: 1
                },
                startDate: moment().startOf('month'),
                endDate: moment().endOf('month')
            });
            
            // Filtre uygulama butonu olayÄ±
            component.find('.apply-filters-btn').click(function() {
                // AJAX ile verileri filtrele
                const dateRange = component.find('.date-filter').val();
                const recordCount = component.find('.record-count').val();
                const type = component.find('.type-filter').val();
                
                component.find('.card-title').append('<span class="loading-spinner"></span>');
                
                // AJAX isteÄŸi
                $.ajax({
                    url: '/tr/accounting/cari_bilgileri_alma/',
                    type: 'GET',
                    data: {
                        date_range: dateRange,
                        record_count: recordCount,
                        type: type,
                        santiye: santiye
                    },
                    success: function(response) {
                        console.log(response);
                        // BaÅŸarÄ±lÄ± olursa tabloyu gÃ¼ncelle
                        component.find('.cari-data-tbody').html(response.html);
                        console.log(response.html);
                        // Toplam deÄŸerleri gÃ¼ncelle
                        $('#total-borc').text(response.total_borc + ' â‚º');
                        $('#total-alacak').text(response.total_alacak + ' â‚º');
                        
                        const netDurum = response.net_durum;
                        const netDurumEl = $('#net-durum');
                        
                        netDurumEl.text((netDurum >= 0 ? '+' : '') + netDurum + ' â‚º');
                        
                        if (netDurum >= 0) {
                            netDurumEl.removeClass('net-negative').addClass('net-positive');
                        } else {
                            netDurumEl.removeClass('net-positive').addClass('net-negative');
                        }
                        
                        component.find('.loading-spinner').remove();
                    },
                    error: function(error) {
                        console.error('Veri yÃ¼kleme hatasÄ±:', error);
                        component.find('.loading-spinner').remove();
                            alert('{% trans 'Veriler yÃ¼klenirken bir hata oluÅŸtu' %}');
                    }
                });
            });
            
            // Yenile butonu olayÄ±
            component.find('.refresh').click(function() {
                component.find('.apply-filters-btn').click();
            });
            
            // Sayfa yÃ¼klendiÄŸinde Ã¶zet bilgileri hesapla
            setTimeout(function() {
                let totalBorc = 0;
                let totalAlacak = 0;
                
                component.find('.cari-data-tbody tr').each(function() {
                    const amountText = $(this).find('.amount-col').text();
                    const amount = parseFloat(amountText.replace('â‚º', '').trim());
                    
                    if ($(this).hasClass('borc-row')) {
                        totalBorc += Math.abs(amount);
                    } else if ($(this).hasClass('alacak-row')) {
                        totalAlacak += amount;
                    }
                });
                
                $('#total-borc').text(totalBorc.toFixed(2) + ' â‚º');
                $('#total-alacak').text(totalAlacak.toFixed(2) + ' â‚º');
                
                const netDurum = totalAlacak - totalBorc;
                const netDurumEl = $('#net-durum');
                
                netDurumEl.text((netDurum >= 0 ? '+' : '') + netDurum.toFixed(2) + ' â‚º');
                
                if (netDurum >= 0) {
                    netDurumEl.removeClass('net-negative').addClass('net-positive');
                } else {
                    netDurumEl.removeClass('net-positive').addClass('net-negative');
                }
            }, 500);
            
            break;

      case 'proje-ozeti':

component = $(`
<style>
  .row {
    display: flex;
    justify-content: space-between;
    gap: 20px;
  }

  .card {
    flex: 1;
    background: #fff;
    box-shadow: 0 6px 16px rgba(0,0,0,0.08);
    margin-bottom: 30px;
    padding: 15px;
  }

  .card h2 {
    text-align:center;
    margin-bottom: 20px;
  }

  .scroll-box {
    padding: 10px;
    border-radius: 10px;
    max-height: 500px;
    overflow-y: auto;
  }
</style>

{% for santiye in bloklar %}
{%  bloglari_rapora_yansitma santiye.proje_santiye_Ait as blog %}
{% bloglar_daireleri_kalemleri_fiziksel_bilgileri santiye.id santiye as fiziksel_ilerleme  %}
<h3 style="text-align:center; margin-bottom: 30px;">{{ santiye.blog_adi }}</h3>
<hr style="margin-bottom: 30px;">

<div class="row">
  <div class="card">
    <h2>Donut 1</h2>
    <canvas class="donut1"
      data-completed="{{fiziksel_ilerleme |safe }}"
      data-remaining="{% basit_cikarma_duzenli 100 fiziksel_ilerleme  %}">
    </canvas>
  </div>

  <div class="card">
    <h2>Donut 2</h2>
    <canvas class="donut2"
      data-completed="{{ santiye.is_bitmis }}"
      data-remaining="{{ santiye.is_kalan }}">
    </canvas>
  </div>
</div>

<div class="row">
  <div class="card">
    <h2>Bar Grafik 1</h2>
    <canvas class="bar1"
      data-labels='{{ santiye.bar1_labels|safe }}'
      data-values='{{ santiye.bar1_values|safe }}'>
    </canvas>
  </div>

  <div class="card">
    <h2>Bar Grafik 2</h2>
    <canvas class="bar2"
      data-labels='{{ santiye.bar2_labels|safe }}'
      data-values='{{ santiye.bar2_values|safe }}'>
    </canvas>
  </div>
</div>

<div class="card">
  <h2>Yatay Bar Grafik</h2>
  <div class="scroll-box">
    <canvas class="bigBar"
      data-labels='{{ santiye.big_labels|safe }}'
      data-values='{{ santiye.big_values|safe }}'>
    </canvas>
  </div>
</div>

<hr style="margin: 40px 0;">
{% endfor %}
`);

setTimeout(() => {

const DONUT_SIZE = 200;

/* ================= DONUT 1 ================= */
document.querySelectorAll('.donut1').forEach(c => {

  const completed = Number(c.dataset.completed);
  const remaining = Number(c.dataset.remaining);

  c.width = DONUT_SIZE;
  c.height = DONUT_SIZE;

  new Chart(c, {
    type: 'doughnut',
    data: {
      labels: ['Tamamlanan', 'Kalan'],
      datasets: [{
        data: [completed, remaining],
        backgroundColor: ['#062941', '#dcdcdc'],
        borderWidth: 0
      }]
    },
    options: {
      responsive: false,
      cutout: '70%',
      plugins: { legend: { position: 'bottom' } }
    }
  });
});

/* ================= DONUT 2 ================= */
document.querySelectorAll('.donut2').forEach(c => {

  const completed = Number(c.dataset.completed);
  const remaining = Number(c.dataset.remaining);

  c.width = DONUT_SIZE;
  c.height = DONUT_SIZE;

  new Chart(c, {
    type: 'doughnut',
    data: {
      labels: ['Tamamlanan', 'Kalan'],
      datasets: [{
        data: [completed, remaining],
        backgroundColor: ['#d9ef33', '#dcdcdc'],
        borderWidth: 0
      }]
    },
    options: {
      responsive: false,
      cutout: '70%',
      plugins: { legend: { position: 'bottom' } }
    }
  });
});

/* ================= BAR 1 ================= */
document.querySelectorAll('.bar1').forEach(c => {

  const labels = JSON.parse(c.dataset.labels);
  const values = JSON.parse(c.dataset.values);

  new Chart(c, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        data: values,
        backgroundColor: '#d9ef33',
        borderRadius: 6
      }]
    },
    options: {
      scales: { y: { beginAtZero: true, max: 100 } },
      plugins: { legend: { display: false } }
    }
  });
});

/* ================= BAR 2 ================= */
document.querySelectorAll('.bar2').forEach(c => {

  const labels = JSON.parse(c.dataset.labels);
  const values = JSON.parse(c.dataset.values);

  new Chart(c, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        data: values,
        backgroundColor: '#062941',
        borderRadius: 6
      }]
    },
    options: {
      scales: { y: { beginAtZero: true, max: 100 } },
      plugins: { legend: { display: false } }
    }
  });
});

/* ================= BIG YATAY BAR ================= */
document.querySelectorAll('.bigBar').forEach(c => {

  const labels = JSON.parse(c.dataset.labels);
  const values = JSON.parse(c.dataset.values);

  new Chart(c, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        data: values,
        backgroundColor: '#062941',
        barThickness: 7,
        borderRadius: 5
      }]
    },
    options: {
      indexAxis: 'y',
      scales: {
        x: { beginAtZero: true, max: 100 },
        y: { ticks: { autoSkip: false } }
      },
      plugins: { legend: { display: false } }
    }
  });
});

}, 100);

break;


        case 'ilerleme-grafik':
            component = $(`
                <div class="report-card" data-size="medium">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-chart-bar"></i>
                            Ä°lerleme GrafiÄŸi
                        </div>
                        <div class="card-actions">
                            <button class="card-action-btn size-down" title="KÃ¼Ã§Ã¼lt">
                                <i class="icon icon-minus"></i>
                            </button>
                            <button class="card-action-btn size-up" title="BÃ¼yÃ¼lt">
                                <i class="icon icon-plus"></i>
                            </button>
                            <button class="card-action-btn remove" title="Sil">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                        <div class="minimal-table">
                        <table id="tumu-table">
                            <thead>
                                <tr>
                                          <th >{% trans 'Ä°ÅŸ Emri AdÄ±' %}</th>
                                            <th >{% trans 'AÃ§Ä±klama' %}</th>
                                            <th >{% trans 'Blok' %}</th>
                                            <th >{% trans 'Kat' %}</th>
                                            <th >{% trans 'BaÅŸlangÄ±Ã§' %}</th>
                                            <th >{% trans 'Hedef Tarih' %}</th>
                                            <th >{% trans 'Durum' %}</th>
                                            
                                </tr>
                            </thead>
                            <tbody>
                            {% for i in is_planlari %}
                            <tr>
                                    <td>
                                        <div class="task-check">
                                            
                                            {{i.title}}
                                        </div>
                                    </td>
                                    <td >{{ i.aciklama }}</td>
                                    <td >
                                    {% if i.blok %}
                                        {{i.blok.blog_adi}}
                                    {% else %}
                                    {% endif %}
                                    </td>
                                    <td >{% if i.blok %}
                                        {{i.kat}}
                                    {% else %}
                                    {% endif %}</td>

                                    <td>{{i.kayit_tarihi |date:'d.m.Y'}}</td>
                                    <td>{{i.teslim_tarihi|date:'d.m.Y'}}</td>
                                    <td>
                                    {% isplani_durumu_kontrol i.id as b %}
                                                
                                                {% if i.status == "Inprogress" %}
                                                    <span
                                                    class="status-inprogress stats-lg">{{i.status}}</span>
                                                {% elif i.status == "New" %}
                                                <div class="td-info"><span class="status-highlight stats-lg">{% trans 'Yeni' %}</span></div>
                                                {% elif i.status == "Pending" %}
                                                <div class="td-info"><span class="status-pending stats-lg">{% trans 'Beklemede' %}</span></div>
                                                 {% elif i.status == "Completed" %}
                                                <div class="td-info"><span class="status-success stats-lg">{% trans 'TamamlandÄ±' %}</span></div>
                                                    {% endif %}
                                                
                                        
                                    </td>
                                       
                                   
                               
                                </tr>
                                {% endfor %}
                                </tbody>
                        </table>
                    </div>
                </div>
            `);

            setTimeout(() => {
                new ApexCharts(component.find('#progressChart')[0], {
                    series: [75],
                    chart: {
                        type: 'radialBar',
                        height: 250
                    },
                    plotOptions: {
                        radialBar: {
                            hollow: { size: '70%' },
                            dataLabels: {
                                value: { fontSize: '22px' }
                            }
                        }
                    },
                    labels: ['Tamamlanma']
                }).render();
            }, 100);
            break;

        case 'gorev-tablosu':
            component = $(`
                <div class="report-card" data-size="medium">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-tasks"></i>
                            GÃ¶rev Tablosu
                        </div>
                        <div class="card-actions">
                            <button class="card-action-btn size-down" title="KÃ¼Ã§Ã¼lt">
                                <i class="icon icon-minus"></i>
                            </button>
                            <button class="card-action-btn size-up" title="BÃ¼yÃ¼lt">
                                <i class="icon icon-plus"></i>
                            </button>
                            <button class="card-action-btn remove" title="Sil">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                        <div class="minimal-table">
                        <table id="tumu-table">
                            <thead>
                                <tr>
                                          <th >{% trans 'Ä°ÅŸ Emri AdÄ±' %}</th>
                                            <th >{% trans 'AÃ§Ä±klama' %}</th>
                                            <th >{% trans 'Blok' %}</th>
                                            <th >{% trans 'Kat' %}</th>
                                      
                                            <th >{% trans 'BaÅŸlangÄ±Ã§' %}</th>
                                            <th >{% trans 'Hedef Tarih' %}</th>
                                            <th >{% trans 'Durum' %}</th>
                                            
                                </tr>
                            </thead>
                            <tbody>
                            {% for i in is_planlarii %}
                            <tr>
                                    <td>
                                        <div class="task-check">
                                            
                                            {{i.title}}
                                        </div>
                                    </td>
                                    <td >{{ i.aciklama }}</td>
                                    <td >
                                    {% if i.blok %}
                                        {{i.blok.blog_adi}}
                                    {% else %}
                                    {% endif %}
                                    </td>
                                    <td >{% if i.blok %}
                                        {{i.kat}}
                                    {% else %}
                                    {% endif %}</td>
                                        
                                    <td>{{i.kayit_tarihi |date:'d.m.Y'}}</td>
                                    <td>{{i.teslim_tarihi|date:'d.m.Y'}}</td>
                                    <td>
                                    {% isplani_durumu_kontrol i.id as b %}
                                                
                                                {% if i.status == "Inprogress" %}
                                                    <span
                                                    class="status-inprogress stats-lg">{{i.status}}</span>
                                                {% elif i.status == "New" %}
                                                <div class="td-info"><span class="status-highlight stats-lg">{% trans 'Yeni' %}</span></div>
                                                {% elif i.status == "Pending" %}
                                                <div class="td-info"><span class="status-pending stats-lg">{% trans 'Beklemede' %}</span></div>
                                                 {% elif i.status == "Completed" %}
                                                <div class="td-info"><span class="status-success stats-lg">{% trans 'TamamlandÄ±' %}</span></div>
                                                    {% endif %}
                                                
                                        
                                    </td>
                                        
                                   
                               
                                </tr>
                                {% endfor %}
                                </tbody>
                        </table>
                    </div>
                </div>
            `);
            break;

        case 'personel-listesi':
            component = $(`
                <div class="report-card" data-size="medium">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-users"></i>
                                {% trans 'Personel Listesi' %}
                        </div>
                        <div class="card-actions">
                                <button class="card-action-btn size-down" title="{% trans 'KÃ¼Ã§Ã¼lt' %}">
                                <i class="icon icon-minus"></i>
                            </button>
                                <button class="card-action-btn size-up" title="{% trans 'BÃ¼yÃ¼lt' %}">
                                <i class="icon icon-plus"></i>
                            </button>
                                <button class="card-action-btn remove" title="{% trans 'Sil' %}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                        <div class="minimal-table">
                      <table id="tumu-table">
                            <thead>
                                <tr>
                                          <th >{% trans 'AdÄ± SoyadÄ±' %}</th>
                                            <th >{% trans 'Ä°ÅŸe GiriÅŸ Tarihi' %}</th>
                                            <th >{% trans 'Pozisyon' %}</th>
                                            <th >{% trans 'Departman' %}</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for i in personeller_listesi %}
                            <tr>
                                    
                                    <td >{{ i.isim }} {{ i.soyisim }}</td>
                                    <td>
                                    {{ i.kayit_tarihi |date:'d.m.Y'}} 
                                    </td>
                                    <td >{{ i.calisan_pozisyonu.kategori_isimi }}</td>
                                    <td >{{ i.calisan_kategori.kategori_isimi }}</td>               
                                </tr>
                                {% endfor %}
                                </tbody>
                        </table>
                    </div>
                </div>
            `);
            break;

            case 'puantaj':
    component = $(`
        <div class="report-card" data-size="medium">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-clock"></i>
                    {% trans 'Puantaj' %}
                </div>
                <div class="card-actions">
                    <button class="card-action-btn size-down" title="{% trans 'KÃ¼Ã§Ã¼lt' %}">
                        <i class="icon icon-minus"></i>
                    </button>
                    <button class="card-action-btn size-up" title="{% trans 'BÃ¼yÃ¼lt' %}">
                        <i class="icon icon-plus"></i>
                    </button>
                    <button class="card-action-btn remove" title="{% trans 'Sil' %}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="minimal-table">
                <table id="tumu-table">
                    <thead>
                        <tr>
                            <th>{% trans 'AdÄ± SoyadÄ±' %}</th>
                            <th>{% trans 'Ä°ÅŸe GiriÅŸ Tarihi' %}</th>
                            <th>{% trans 'Pozisyon' %}</th>
                            <th>{% trans 'Ã‡alÄ±ÅŸma SÃ¼resi' %}</th>
                            <th>{% trans 'Ek Mesai SÃ¼resi' %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in personeller_listesi %}
                        <tr>
                            <td>{{ i.isim }} {{ i.soyisim }}</td>
                            <td>{{ i.kayit_tarihi |date:'d.m.Y' }}</td>
                            <td>{{ i.calisan_pozisyonu.kategori_isimi }}</td>
                            <td class="normal_calisma_suresi{{i.id}}">0 saat</td>
                            <td class="mesai_calisma_suresi{{i.id}}">0 saat</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    `);

    setTimeout(() => {
        console.log("Puantaj component initialized");
        alert(tarih);
        const [tarih_baslangic, tarih_bitis] = tarih.split(" - ");

        console.log("Selected Date Range:", tarih);

        {% for i in personeller_listesi %}
        console.log("Fetching data for personel ID:", "{{i.id}}");
        fetch(`/users/calisma/{{i.id}}?baslangic=${tarih_baslangic}&bitis=${tarih_bitis}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log("Data for personel ID {{i.id}}:", data);
                console.log("Response for personel ID {{i.id}}:", data);
                document.querySelector(`.normal_calisma_suresi{{i.id}}`).textContent = `${data.normal_saat} saat`;
                document.querySelector(`.mesai_calisma_suresi{{i.id}}`).textContent = `${data.mesai_saati} saat`;
            })
            .catch(err => console.error("Error fetching data for personel ID {{i.id}}:", err));
        {% endfor %}
    }, 100);
    break;

        case 'izin-takip':
        component = $(`
        <div class="report-card" data-size="medium">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-calendar-alt"></i>
                    {% trans 'Puantaj' %}
                </div>
                <div class="card-actions">
                    <button class="card-action-btn size-down" title="{% trans 'KÃ¼Ã§Ã¼lt' %}">
                        <i class="icon icon-minus"></i>
                    </button>
                    <button class="card-action-btn size-up" title="{% trans 'BÃ¼yÃ¼lt' %}">
                        <i class="icon icon-plus"></i>
                    </button>
                    <button class="card-action-btn remove" title="{% trans 'Sil' %}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="minimal-table">
                <table id="tumu-table">
                    <thead>
                        <tr>
                            <th>{% trans 'AdÄ± SoyadÄ±' %}</th>
                            <th>{% trans 'Pozisyon' %}</th>
                            <th>{% trans 'Ã‡alÄ±ÅŸma SÃ¼resi' %}</th>
                            <th>{% trans 'Ek Mesai SÃ¼resi' %}</th>
                            <th>{% trans 'Ä°zin GÃ¼n SÃ¼resi' %}</th>
                     
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in personeller_listesi %}
                        <tr>
                            <td>{{ i.isim }} {{ i.soyisim }}</td>
                            <td>{{ i.calisan_pozisyonu.kategori_isimi }}</td>
                            <td class="normal_calisma_suresi{{i.id}}">0 saat</td>
                            <td class="mesai_calisma_suresi{{i.id}}">0 saat</td>
                            <td class="izin_gun_sureleri{{i.id}}">0 GÃ¼n</td>
                            
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    `);

    setTimeout(() => {
        console.log("Puantaj component initialized");
        alert(tarih);
        const [tarih_baslangic, tarih_bitis] = tarih.split(" - ");

        console.log("Selected Date Range:", tarih);

        {% for i in personeller_listesi %}
        console.log("Fetching data for personel ID:", "{{i.id}}");
        fetch(`/users/calisma/{{i.id}}?baslangic=${tarih_baslangic}&bitis=${tarih_bitis}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log("Data for personel ID {{i.id}}:", data);
                console.log("Response for personel ID {{i.id}}:", data);
                document.querySelector(`.izin_gun_sureleri{{i.id}}`).textContent = `${data.izin_gunleri} GÃ¼n`;
                document.querySelector(`.normal_calisma_suresi{{i.id}}`).textContent = `${data.normal_saat} saat`;
                document.querySelector(`.mesai_calisma_suresi{{i.id}}`).textContent = `${data.mesai_saati} saat`;
            })
            .catch(err => console.error("Error fetching data for personel ID {{i.id}}:", err));
        {% endfor %}
    }, 100);
    break;

    case 'metin':
        component = $(`
            <div class="report-card" data-size="medium">
                <div class="card-header">
                    <div class="card-title">

                    <div class="card-actions">
                        <button class="card-action-btn edit-text" title="{% trans 'DÃ¼zenle' %}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="card-action-btn remove" title="{% trans 'Sil' %}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="text-content">
                        <p>{% trans 'Metninizi buraya yazÄ±n...' %}</p>
                    </div>
                </div>
                <div class="resize-handle resize-handle-e"></div>
                <div class="resize-handle resize-handle-s"></div>
                <div class="resize-handle resize-handle-se"></div>
            </div>
        `);

        // DÃ¼zenleme modalÄ±
        const editModal = $(`
            <div class="modal text-edit-modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>{% trans 'Metin DÃ¼zenle' %}</h3>
                        <button class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="text-editor">
                            <div class="editor-toolbar">
                                <button class="toolbar-btn" data-command="bold" title="{% trans 'KalÄ±n' %}">
                                    <i class="fas fa-bold"></i>
                                </button>
                                <button class="toolbar-btn" data-command="italic" title="{% trans 'Ä°talik' %}">
                                    <i class="fas fa-italic"></i>
                                </button>
                                <button class="toolbar-btn" data-command="underline" title="{% trans 'AltÄ± Ã‡izili' %}">
                                    <i class="fas fa-underline"></i>
                                </button>
                                <button class="toolbar-btn" data-command="justifyLeft" title="{% trans 'Sola Hizala' %}">
                                    <i class="fas fa-align-left"></i>
                                </button>
                                <button class="toolbar-btn" data-command="justifyCenter" title="{% trans 'Ortala' %}">
                                    <i class="fas fa-align-center"></i>
                                </button>
                                <button class="toolbar-btn" data-command="justifyRight" title="{% trans 'SaÄŸa Hizala' %}">
                                    <i class="fas fa-align-right"></i>
                                </button>
                            </div>
                            <div class="editor-content" contenteditable="true">
                                <p>{% trans 'Metninizi buraya yazÄ±n...' %}</p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="button" onclick="$(this).closest('.modal').remove()">{% trans 'Ä°ptal' %}</button>
                        <button class="button button-primary save-text">{% trans 'Kaydet' %}</button>
                    </div>
                </div>
            </div>
        `);

        // DÃ¼zenleme butonu tÄ±klandÄ±ÄŸÄ±nda
        component.find('.edit-text').click(function() {
            const currentContent = component.find('.text-content').html();
            editModal.find('.editor-content').html(currentContent);
            $('body').append(editModal);
            editModal.addClass('active');
        });

        // Modal kapatma
        editModal.find('.modal-close').click(function() {
            editModal.remove();
        });

        // Metin editÃ¶rÃ¼ iÅŸlevselliÄŸi
        editModal.find('.toolbar-btn').click(function() {
            const command = $(this).data('command');
            document.execCommand(command, false, null);
        });

        // Kaydet butonu
        editModal.find('.save-text').click(function() {
            const newContent = editModal.find('.editor-content').html();
            component.find('.text-content').html(newContent);
            editModal.remove();
        });

        // BoyutlandÄ±rma iÅŸlevselliÄŸi
        this.initializeResizeHandles(component);
        break;
    }
    
    if (component) {
        // Komponent boyutlandÄ±rma iÅŸlevselliÄŸi
        component.find('.size-up, .size-down').click(function() {
            const card = $(this).closest('.report-card');
            const column = card.closest('.report-column');
            const sizes = ['small', 'medium', 'large', 'full'];
            const currentSize = card.attr('data-size') || 'medium';
            const currentIndex = sizes.indexOf(currentSize);
            
            if ($(this).hasClass('size-up') && currentIndex < sizes.length - 1) {
                card.attr('data-size', sizes[currentIndex + 1]);
                // Komponenti kolon geniÅŸliÄŸine gÃ¶re ayarla
                const columnWidth = column.width();
                card.width(columnWidth - 20); // Padding'leri Ã§Ä±kar
            } else if ($(this).hasClass('size-down') && currentIndex > 0) {
                card.attr('data-size', sizes[currentIndex - 1]);
                // Komponenti kolon geniÅŸliÄŸine gÃ¶re ayarla
                const columnWidth = column.width();
                card.width(columnWidth - 20); // Padding'leri Ã§Ä±kar
            }
        });

        // Silme iÅŸlevselliÄŸi
        component.find('.remove').click(function() {
            const card = $(this).closest('.report-card');
            const column = card.closest('.report-column');
            card.remove();
            
            // EÄŸer kolon boÅŸsa, drop zone'u geri ekle
            if (column.find('.report-card').length === 0) {
                column.append('<div class="drop-zone"><span class="drop-text">{% trans 'BileÅŸen eklemek iÃ§in sÃ¼rÃ¼kleyin' %}</span></div>');
                window.reportManager.initializeDropZones();
            }
        });
    }
    
    return component;
}

initializeResizeHandles(component) {
    const card = component;
    let startX, startY, startWidth, startHeight;
    
    // DoÄŸu (saÄŸ) tutamaÃ§
    card.find('.resize-handle-e').on('mousedown', function(e) {
        startX = e.pageX;
        startWidth = card.width();
        
        $(document).on('mousemove', resizeE);
        $(document).on('mouseup', stopResize);
        
        e.preventDefault();
    });
    
    // GÃ¼ney (alt) tutamaÃ§
    card.find('.resize-handle-s').on('mousedown', function(e) {
        startY = e.pageY;
        startHeight = card.height();
        
        $(document).on('mousemove', resizeS);
        $(document).on('mouseup', stopResize);
        
        e.preventDefault();
    });
    
    // GÃ¼neydoÄŸu (saÄŸ alt kÃ¶ÅŸe) tutamaÃ§
    card.find('.resize-handle-se').on('mousedown', function(e) {
        startX = e.pageX;
        startY = e.pageY;
        startWidth = card.width();
        startHeight = card.height();
        
        $(document).on('mousemove', resizeSE);
        $(document).on('mouseup', stopResize);
        
        e.preventDefault();
    });
    
    function resizeE(e) {
        const width = startWidth + (e.pageX - startX);
        if (width > 200) { // Minimum geniÅŸlik
            card.width(width);
            card.trigger('resize');
        }
    }
    
    function resizeS(e) {
        const height = startHeight + (e.pageY - startY);
        if (height > 100) { // Minimum yÃ¼kseklik
            card.height(height);
            card.trigger('resize');
        }
    }
    
    function resizeSE(e) {
        const width = startWidth + (e.pageX - startX);
        const height = startHeight + (e.pageY - startY);
        if (width > 200 && height > 100) {
            card.width(width);
            card.height(height);
            card.trigger('resize');
        }
    }
    
    function stopResize() {
        $(document).off('mousemove', resizeE);
        $(document).off('mousemove', resizeS);
        $(document).off('mousemove', resizeSE);
        $(document).off('mouseup', stopResize);
    }
    
    // Grafik yeniden boyutlandÄ±rma
    card.on('resize', function() {
        if (card.find('#gelirGiderChart').length) {
            ApexCharts.exec('gelirGiderChart', 'updateOptions', {
                chart: {
                    width: '100%',
                    height: card.height() - 100 // Header yÃ¼ksekliÄŸini Ã§Ä±kar
                }
            });
        }
    });
}

initResizeHandles() {
    $(document).on('mousedown', '.component-resize', (e) => {
        e.preventDefault();
        const component = $(e.target).closest('.component');
        const startX = e.pageX;
        const startY = e.pageY;
        const startWidth = component.outerWidth();
        const startHeight = component.outerHeight();
        const direction = $(e.target).data('direction');
        const minWidth = 200;
        const minHeight = 100;

        const handleMouseMove = (e) => {
            e.preventDefault();
            const deltaX = e.pageX - startX;
            const deltaY = e.pageY - startY;
            let newWidth = startWidth;
            let newHeight = startHeight;

            switch(direction) {
                case 'nw':
                    newWidth = Math.max(minWidth, startWidth - deltaX);
                    newHeight = Math.max(minHeight, startHeight - deltaY);
                    component.css({
                        width: newWidth,
                        height: newHeight,
                        left: startX - e.pageX + component.offset().left,
                        top: startY - e.pageY + component.offset().top
                    });
                    break;
                case 'ne':
                    newWidth = Math.max(minWidth, startWidth + deltaX);
                    newHeight = Math.max(minHeight, startHeight - deltaY);
                    component.css({
                        width: newWidth,
                        height: newHeight,
                        top: startY - e.pageY + component.offset().top
                    });
                    break;
                case 'sw':
                    newWidth = Math.max(minWidth, startWidth - deltaX);
                    newHeight = Math.max(minHeight, startHeight + deltaY);
                    component.css({
                        width: newWidth,
                        height: newHeight,
                        left: startX - e.pageX + component.offset().left
                    });
                    break;
                case 'se':
                    newWidth = Math.max(minWidth, startWidth + deltaX);
                    newHeight = Math.max(minHeight, startHeight + deltaY);
                    component.css({
                        width: newWidth,
                        height: newHeight
                    });
                    break;
            }

            const tableContainer = component.find('.table-container');
            if (tableContainer.length) {
                tableContainer.css({
                    width: '100%',
                    maxWidth: '100%'
                });
            }
        };

        const handleMouseUp = () => {
            $(document).off('mousemove', handleMouseMove);
            $(document).off('mouseup', handleMouseUp);
        };

        $(document).on('mousemove', handleMouseMove);
        $(document).on('mouseup', handleMouseUp);
    });
}
}

// Sayfa yÃ¼klendiÄŸinde baÅŸlat
$(document).ready(() => {
window.reportManager = new ReportManager();
});

// Modal fonksiyonlarÄ±
function closePdfPreview() {
document.getElementById('pdfPreviewModal').classList.remove('active');
}

function openPageSettings() {
document.getElementById('pageSettingsModal').classList.add('active');
}

function closePageSettings() {
document.getElementById('pageSettingsModal').classList.remove('active');
}

function savePageSettings() {
// Kenar boÅŸluklarÄ±
const margins = {
    top: $('.margin-control[data-margin="top"]').val(),
    right: $('.margin-control[data-margin="right"]').val(),
    bottom: $('.margin-control[data-margin="bottom"]').val(),
    left: $('.margin-control[data-margin="left"]').val()
};

// KaÄŸÄ±t ayarlarÄ±
const paperSize = $('#paperSize').val();
const orientation = $('input[name="orientation"]:checked').val();

// AyarlarÄ± uygula
Object.entries(margins).forEach(([margin, value]) => {
    $('.preview-container').css(`padding-${margin}`, value + 'mm');
});

    // AyrÄ±ca PDF oluÅŸturma fonksiyonlarÄ±nÄ±n kenar boÅŸluklarÄ±nÄ± gÃ¼ncelle
    window.reportManager.updatePdfMargins([
        parseInt(margins.top), 
        parseInt(margins.right), 
        parseInt(margins.bottom), 
        parseInt(margins.left)
    ]);

closePageSettings();
}


</script>

<script>
function saveReport() {
    const name = $('#reportNames').val();
    const description = $('#reportDescriptions').val();

    if (!name) {
        alert('LÃ¼tfen rapor adÄ± giriniz');
        return;
    }

    // PDF oluÅŸturma ayarlarÄ±
    const pdfOptions = {
        margin: [10, 10, 10, 10],
        filename: `${name}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    // PDF oluÅŸtur ve deÄŸiÅŸken olarak kaydet
    html2pdf()
        .from(document.querySelector('#reportPreview'))
        .set(pdfOptions)
        .outputPdf('datauristring')
        .then((pdfDataUri) => {
            const pdfBase64 = pdfDataUri.split(',')[1]; // Base64 formatÄ±nda PDF verisi

            // Rapor verilerini hazÄ±rla
            const reportData = {
                name,
                description,
                dateRange: {
                    start: $('#dateRange').data('daterangepicker').startDate.format('YYYY-MM-DD'),
                    end: $('#dateRange').data('daterangepicker').endDate.format('YYYY-MM-DD')
                },
                content: $('#reportPreview').html(),
                
                project: $('#projectSelect').val(),
                pdf: pdfBase64
            };

            // CSRF token al
            //const csrfToken = $('input[name="csrfmiddlewaretoken"]').val();
            console.log(reportData);
            // AJAX ile API'ye gÃ¶nder
            $.ajax({
                url: '/rapor_kaydedici/', // API endpoint
                method: 'POST',
                contentType: 'application/json',
                 headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                data: JSON.stringify(reportData),
                success: function (response) {
                    alert('Rapor baÅŸarÄ±yla kaydedildi');
                    console.log('API yanÄ±tÄ±:', response);
                },
                error: function (xhr, status, error) {
                    console.error('Rapor kaydetme hatasÄ±:', error);
                    alert('Rapor kaydedilirken bir hata oluÅŸtu');
                }
            });
        })
        .catch((error) => {
            console.error('PDF oluÅŸturma hatasÄ±:', error);
            alert('PDF oluÅŸturulurken bir hata oluÅŸtu');
        });
}

/**
 * Tablo sÃ¼tunlarÄ±nÄ±n geniÅŸliklerini ayarlamak iÃ§in fonksiyon
 */
function initTableResizing() {
    // TÃ¼m minimal-table sÄ±nÄ±fÄ±na sahip tablolardaki th elementleri iÃ§in
    const tables = document.querySelectorAll('table.minimal-table');
    
    tables.forEach(table => {
        const headers = table.querySelectorAll('th');
        
        // Her baÅŸlÄ±k iÃ§in resizer elementi ekleyelim
        headers.forEach(header => {
            // EÄŸer zaten resizer varsa eklemiyoruz
            if (!header.querySelector('.resizer')) {
                const resizer = document.createElement('div');
                resizer.classList.add('resizer');
                header.appendChild(resizer);
                
                let startX, startWidth;
                
                // Resize iÅŸlemini baÅŸlat
                resizer.addEventListener('mousedown', function(e) {
                    startX = e.pageX;
                    startWidth = header.offsetWidth;
                    resizer.classList.add('resizing');
                    
                    // MouseMove ve MouseUp eventlerini document'a ekle
                    document.addEventListener('mousemove', resize);
                    document.addEventListener('mouseup', stopResize);
                    
                    // Event yayÄ±lÄ±mÄ±nÄ± durdur
                    e.preventDefault();
                    e.stopPropagation();
                });
                
                // Resize iÅŸlemi
                function resize(e) {
                    const width = startWidth + (e.pageX - startX);
                    if (width > 50) { // Minimum geniÅŸlik
                        header.style.width = width + 'px';
                        // TÃ¼m satÄ±rlardaki aynÄ± indexteki hÃ¼crelere de geniÅŸlik ayarla
                        const colIndex = Array.from(header.parentNode.children).indexOf(header);
                        const rows = table.querySelectorAll('tbody tr');
                        rows.forEach(row => {
                            const cell = row.children[colIndex];
                            if (cell) {
                                cell.style.width = width + 'px';
                            }
                        });
                    }
                }
                
                // Resize iÅŸlemini sonlandÄ±r
                function stopResize() {
                    resizer.classList.remove('resizing');
                    document.removeEventListener('mousemove', resize);
                    document.removeEventListener('mouseup', stopResize);
                }
            }
        });
    });
}

// Manuel olarak tÃ¼m tablolarÄ± hazÄ±rla
function prepareAllTables() {
    // TÃ¼m mevcut tablolarÄ± bul
    const allTables = document.querySelectorAll('table');
    
    allTables.forEach(table => {
        // EÄŸer minimal-table sÄ±nÄ±fÄ±na sahip deÄŸilse ekle
        if (!table.classList.contains('minimal-table')) {
            table.classList.add('minimal-table');
        }
        
        // Tablo henÃ¼z hazÄ±r deÄŸilse iÅŸaretle
        if (!table.hasAttribute('data-resizable')) {
            table.setAttribute('data-resizable', 'true');
        }
    });
    
    // Resizing fonksiyonunu baÅŸlat
    initTableResizing();
    
    console.log(`Toplam ${allTables.length} tablo hazÄ±rlandÄ±.`);
}

// DOM iÃ§indeki tÃ¼m tablolarÄ± iÅŸaretleme ve resizing iÅŸlemini Ã§alÄ±ÅŸtÄ±rma
jQuery(document).ready(function($) {
    // Åžablon SeÃ§icileri dÃ¼zeltme - (Tek bir olay dinleyicisi olacak)
    console.log('Åžablon olaylarÄ± yÃ¼kleniyor...');
    
    // Ã–nce tÃ¼m eski event listener'larÄ± temizle
    $('.template-item').off('click');
    
    // Yeni tÄ±klama olayÄ±nÄ± ekle
    $('.template-item').on('click', function(e) {
        e.preventDefault();
        const templateId = $(this).data('template');
        console.log('Åžablon seÃ§ildi:', templateId);
        
        // TÃ¼m ÅŸablonlardan active/selected sÄ±nÄ±flarÄ±nÄ± kaldÄ±r
        $('.template-item').removeClass('active').removeClass('selected');
        
        // SeÃ§ilen ÅŸablona active/selected sÄ±nÄ±fÄ± ekle
        $(this).addClass('active').addClass('selected');
        
        // Åžablonu yÃ¼kle - reportManager olabilir veya global loadTemplate olabilir
        if (window.reportManager && typeof window.reportManager.loadTemplate === 'function') {
            // reportManager sÄ±nÄ±fÄ± iÃ§indeki metodu Ã§aÄŸÄ±r
            console.log('reportManager.loadTemplate Ã§aÄŸrÄ±lÄ±yor:', templateId);
            window.reportManager.loadTemplate(templateId);
        } else if (typeof loadTemplate === 'function') {
            // global fonksiyonu Ã§aÄŸÄ±r
            console.log('global loadTemplate fonksiyonu Ã§aÄŸrÄ±lÄ±yor:', templateId);
            loadTemplate(templateId);
        } else {
            console.error('loadTemplate fonksiyonu bulunamadÄ±');
        }
        
        // Masonry grid dÃ¼zenini gÃ¼ncelle
        setTimeout(function() {
            if (typeof initializeMasonryLayout === 'function') {
                initializeMasonryLayout();
            }
            if (typeof organizeReportCards === 'function') {
                organizeReportCards();
            }
        }, 500);
        
        // Ã–zel olay tetikle
        document.dispatchEvent(new CustomEvent('templateSelected', { 
            detail: { templateId: templateId } 
        }));
    });
    
    // Sayfa yÃ¼klendikten 500ms sonra tablolarÄ± hazÄ±rla
    setTimeout(function() {
        if (typeof prepareAllTables === 'function') {
            prepareAllTables();
        }
        
        // Masonry grid dÃ¼zenini uygula
        if (typeof initializeMasonryLayout === 'function') {
            initializeMasonryLayout();
        }
        if (typeof organizeReportCards === 'function') {
            organizeReportCards();
        }
        
        // 2 saniye daha sonra bir kez daha kontrol et
        setTimeout(function() {
            if (typeof prepareAllTables === 'function') {
                prepareAllTables();
            }
            
            // Masonry grid dÃ¼zenini tekrar uygula
            if (typeof initializeMasonryLayout === 'function') {
                initializeMasonryLayout();
            }
            if (typeof organizeReportCards === 'function') {
                organizeReportCards();
            }
        }, 2000);
    }, 500);
    
    // MutationObserver ile DOM deÄŸiÅŸikliklerini takip et
    const observer = new MutationObserver(function(mutations) {
        let shouldPrepare = false;
        
        mutations.forEach(function(mutation) {
            if (mutation.addedNodes.length) {
                // DOM'a yeni bir element eklendiÄŸinde
                shouldPrepare = true;
            }
        });
        
        if (shouldPrepare && typeof prepareAllTables === 'function') {
            // DeÄŸiÅŸiklik olduÄŸunda tablolarÄ± tekrar hazÄ±rla
            setTimeout(prepareAllTables, 200);
        }
    });
    
    // TÃ¼m document'Ä± gÃ¶zlemle
    observer.observe(document.body, { childList: true, subtree: true });
});

/**
 * Component Manager'da onclone fonksiyonlarÄ±nda sÃ¼tun geniÅŸliklerini koru
 */
$(document).ready(function() {
    // PDF oluÅŸturma fonksiyonlarÄ±nda minimal-table stillerini gÃ¼ncelle
    const originalShowPdfPreview = window.reportManager?.showPdfPreview;
    if (originalShowPdfPreview) {
        window.reportManager.showPdfPreview = function() {
            // Orijinal fonksiyonu Ã§alÄ±ÅŸtÄ±r
            originalShowPdfPreview.call(this);
            
            // Tablo geniÅŸliklerini koru
            const tables = document.querySelectorAll('table.minimal-table');
            tables.forEach(table => {
                const headers = table.querySelectorAll('th');
                headers.forEach(header => {
                    const width = header.style.width;
                    if (width) {
                        const colIndex = Array.from(header.parentNode.children).indexOf(header);
                        const rows = table.querySelectorAll('tbody tr');
                        rows.forEach(row => {
                            const cell = row.children[colIndex];
                            if (cell) {
                                cell.style.width = width;
                            }
                        });
                    }
                });
            });
        };
    }
});
</script>
{% endblock sidebar %}

<!-- Åžablon SeÃ§ici -->
<div class="sidebar-section template-selector" style="display:none;">
    <div class="section-header">
        <h3>{% trans 'Åžablon SeÃ§ici' %}</h3>
    </div>
    <div id="template-list" class="template-grid">
        <!-- Åžablonlar buraya yÃ¼klenecek -->
        <div class="template-item" data-template="bos">
            <div class="template-preview">{% trans 'BoÅŸ Åžablon' %}</div>
            <div class="template-name">{% trans 'BoÅŸ Åžablon' %}</div>
        </div>
        <div class="template-item" data-template="finansal">
            <div class="template-preview">{% trans 'Finansal Åžablon' %}</div>
            <div class="template-name">{% trans 'Finansal Rapor' %}</div>
        </div>
    </div>
</div>

<!-- Åžablon SeÃ§ici iÃ§in JavaScript dosyasÄ±nÄ± ekle -->
<script src="{% static 'src/js/pages/template-selector.js' %}"></script>

<script>
// Åžablon seÃ§ici scriptini yÃ¼kleme kontrolÃ¼
document.addEventListener('DOMContentLoaded', function() {
    console.log('Sayfa yÃ¼klendi, report-card dÃ¼zenleniyor...');
    
    // Report-card'larÄ± dÃ¼zenle
    organizeReportCards();
    
    // Yeni bir kart eklendiÄŸinde ya da bir kart silindiÄŸinde kartlarÄ± yeniden dÃ¼zenle
    // Event delegation kullanarak bu olaylarÄ± dinle
    document.addEventListener('componentAdded', function() {
        setTimeout(function() {
            organizeReportCards();
            if (typeof initializeMasonryLayout === 'function') {
                initializeMasonryLayout();
            }
        }, 300);
    });
    
    document.addEventListener('componentRemoved', function() {
        setTimeout(function() {
            organizeReportCards();
            if (typeof initializeMasonryLayout === 'function') {
                initializeMasonryLayout();
            }
        }, 300);
    });
});

// ... existing code ...
</script>

<script>
$(document).ready(function() {
    // ControlManager'Ä± baÅŸlat
    window.controlManager = new ControlManager();
    
    // TinyMCE'yi baÅŸlat
    if (typeof tinymce !== 'undefined') {
        tinymce.init({
            selector: '.tinymce-editor',
            height: 300,
            menubar: false,
            plugins: [
                'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
                'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
                'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount'
            ],
            toolbar: 'undo redo | formatselect | ' +
                'bold italic backcolor | alignleft aligncenter ' +
                'alignright alignjustify | bullist numlist outdent indent | ' +
                'removeformat | help',
            content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }'
        });
    }
});
</script>

// TablolarÄ± dÃ¼zenleyin
function prepareMinimalTables() {
    // div.minimal-table iÃ§indeki tablolarÄ± dÃ¼zenle
    $('div.minimal-table').each(function() {
        const div = $(this);
        const table = div.find('table');
        
        // Tabloyu minimal-table sÄ±nÄ±fÄ± ile iÅŸaretle
        if (table.length && !table.hasClass('minimal-table')) {
            table.addClass('minimal-table');
        }
        
        // Tabloyu table-container ile sar
        if (table.length && !table.parent('.table-container').length) {
            table.wrap('<div class="table-container"></div>');
            
            // Table container stillerini ayarla
            div.find('.table-container').css({
                'width': '100%',
                'max-width': '100%',
                'overflow-x': 'auto',
                'border': '1px solid #e9ecef',
                'border-radius': '4px'
            });
        }
    });
    
    // Yeni hazÄ±rlanan tablolara resize iÅŸlevselliÄŸi ekle
    initTableResizing();
}

// Sayfa yÃ¼klendiÄŸinde veya DOM gÃ¼ncellendiÄŸinde tablolarÄ± hazÄ±rla
$(document).ready(function() {
    prepareMinimalTables();
    
    // MutationObserver ile DOM deÄŸiÅŸikliklerini takip et
    const observer = new MutationObserver(function(mutations) {
        let shouldPrepare = false;
        
        mutations.forEach(function(mutation) {
            if (mutation.addedNodes.length) {
                mutation.addedNodes.forEach(function(node) {
                    // EÄŸer eklenen node bir div.minimal-table veya onun iÃ§inde bir ÅŸey ise
                    if (node.classList && node.classList.contains('minimal-table') || 
                        $(node).find('.minimal-table').length) {
                        shouldPrepare = true;
                    }
                });
            }
        });
        
        if (shouldPrepare) {
            prepareMinimalTables();
        }
    });
    
    // TÃ¼m document'Ä± gÃ¶zlemle
    observer.observe(document.body, { childList: true, subtree: true });
});

// PDF oluÅŸturma fonksiyonlarÄ±na tablo geniÅŸliÄŸi kopyalama kodu ekleyin
$(document).ready(function() {
    // Orijinal showPdfPreview fonksiyonunu sakla
    const originalShowPdfPreview = window.reportManager && window.reportManager.showPdfPreview;
    
    if (originalShowPdfPreview) {
        window.reportManager.showPdfPreview = function() {
            // Ã–nce orijinal fonksiyonu Ã§aÄŸÄ±r
            const result = originalShowPdfPreview.apply(this, arguments);
            
            // PDF oluÅŸturulduktan sonra sÃ¼tun geniÅŸliklerini kopyala
            setTimeout(() => {
                const iframe = document.getElementById('pdfPreviewFrame');
                if (iframe && iframe.contentDocument) {
                    const clonedDoc = iframe.contentDocument;
                    
                    // Orijinal tablodan stil kopyalama
                    const originalTables = document.querySelectorAll('table.minimal-table');
                    originalTables.forEach(originalTable => {
                        const originalId = originalTable.id || '';
                        const clonedTables = clonedDoc.querySelectorAll('table.minimal-table');
                        
                        clonedTables.forEach(clonedTable => {
                            if (clonedTable.id === originalId || !originalId) {
                                // TÃ¼m sÃ¼tun geniÅŸliklerini kopyala
                                const originalHeaders = originalTable.querySelectorAll('th');
                                const clonedHeaders = clonedTable.querySelectorAll('th');
                                
                                for (let i = 0; i < originalHeaders.length && i < clonedHeaders.length; i++) {
                                    const originalWidth = originalHeaders[i].style.width;
                                    if (originalWidth) {
                                        clonedHeaders[i].style.width = originalWidth;
                                        
                                        // AynÄ± indeksteki tÃ¼m hÃ¼creleri de gÃ¼ncelle
                                        const clonedRows = clonedTable.querySelectorAll('tbody tr');
                                        clonedRows.forEach(row => {
                                            const cell = row.children[i];
                                            if (cell) {
                                                cell.style.width = originalWidth;
                                            }
                                        });
                                    }
                                }
                            }
                        });
                    });
                }
            }, 1000); // Ä°frame yÃ¼klendikten sonra
            
            return result;
        };
    }
    
    // Orijinal exportToPDF fonksiyonunu da gÃ¼ncelle
    const originalExportToPDF = window.reportManager && window.reportManager.exportToPDF;
    
    if (originalExportToPDF) {
        window.reportManager.exportToPDF = function() {
            // Ã–nce tÃ¼m tablolarÄ±n geniÅŸlik bilgisini inline stil olarak ekle
            const tables = document.querySelectorAll('table.minimal-table');
            tables.forEach(table => {
                const headers = table.querySelectorAll('th');
                headers.forEach((header, index) => {
                    if (header.style.width) {
                        // AynÄ± indeksteki tÃ¼m hÃ¼creleri de gÃ¼ncelle
                        const rows = table.querySelectorAll('tbody tr');
                        rows.forEach(row => {
                            const cell = row.children[index];
                            if (cell) {
                                cell.style.width = header.style.width;
                            }
                        });
                    }
                });
            });
            
            // Orijinal fonksiyonu Ã§aÄŸÄ±r
            return originalExportToPDF.apply(this, arguments);
        };
    }
});

/**
 * Åžablon yÃ¼klemek iÃ§in fonksiyon 
 */
function loadTemplate(templateId) {
    console.log(`Åžablon yÃ¼kleniyor: ${templateId}`);
    
    // Aktif ÅŸablon stilini temizle
    $('.template-item').removeClass('active');
    
    // SeÃ§ilen ÅŸablonu aktif olarak iÅŸaretle
    $(`.template-item[data-template="${templateId}"]`).addClass('active');
    
    // Åžablon iÃ§eriÄŸini temizle ve yeniden yÃ¼kle
    const reportContainer = document.querySelector('#report-container');
    
    if (reportContainer) {
        // Åžablona gÃ¶re iÃ§eriÄŸi temizle veya hazÄ±rla
        
        switch(templateId) {
            case 'bos':
            case 'empty':
                // BoÅŸ ÅŸablon - sadece bir baÅŸlÄ±k iÃ§erir
                reportContainer.innerHTML = `
                    <div class="report-row">
                        <div class="report-column">
                            <div class="report-component">
                                <h1 class="editable" contenteditable="true">{% trans 'Yeni Rapor' %}</h1>
                            </div>
                        </div>
                    </div>
                `;
                break;
                
            case 'finansal':
            case 'invoice':
                // Fatura ÅŸablonu
                reportContainer.innerHTML = `
                    <div class="report-row">
                        <div class="report-column" style="width: 60%;">
                            <div class="report-component">
                                <h1 class="editable" contenteditable="true">{% trans 'FATURA' %}</h1>
                                <p class="editable" contenteditable="true">{% trans 'Tarih:' %} ${new Date().toLocaleDateString()}</p>
                            </div>
                        </div>
                        <div class="report-column" style="width: 40%;">
                            <div class="report-component">
                                <div class="logo-container">
                                    <img src="/static/go/images/logo.png" alt="Logo" class="logo-image">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="report-row">
                        <div class="report-column">
                            <div class="report-component">
                                <table class="minimal-table">
                                    <thead>
                                        <tr>
                                            <th>{% trans 'ÃœrÃ¼n/Hizmet' %}</th>
                                            <th>{% trans 'Miktar' %}</th>
                                            <th>{% trans 'Birim Fiyat' %}</th>
                                            <th>{% trans 'Toplam' %}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td contenteditable="true">{% trans 'ÃœrÃ¼n AdÄ±' %}</td>
                                            <td contenteditable="true">1</td>
                                            <td contenteditable="true">â‚º100.00</td>
                                            <td contenteditable="true">â‚º100.00</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
                break;
                
            case 'proje':
            case 'report':
                // Standart rapor ÅŸablonu
                reportContainer.innerHTML = `
                    <div class="report-row">
                        <div class="report-column">
                            <div class="report-component">
                                <h1 class="editable" contenteditable="true">{% trans 'Proje Raporu' %}</h1>
                                <h3 class="editable" contenteditable="true">{% trans 'Ã–zet' %}</h3>
                                <p class="editable" contenteditable="true">{% trans 'Bu rapor, projenin mevcut durumunu ve geleceÄŸe yÃ¶nelik planlarÄ± iÃ§ermektedir.' %}</p>
                            </div>
                        </div>
                    </div>
                    <div class="report-row">
                        <div class="report-column">
                            <div class="report-component">
                                <h3 class="editable" contenteditable="true">{% trans 'Proje DetaylarÄ±' %}</h3>
                                <table class="minimal-table">
                                    <thead>
                                        <tr>
                                            <th>{% trans 'BaÅŸlÄ±k' %}</th>
                                            <th>{% trans 'AÃ§Ä±klama' %}</th>
                                            <th>{% trans 'Durum' %}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td contenteditable="true">{% trans 'Ä°ÅŸ Paketi 1' %}</td>
                                            <td contenteditable="true">{% trans 'DetaylÄ± aÃ§Ä±klama' %}</td>
                                            <td contenteditable="true">{% trans 'TamamlandÄ±' %}</td>
                                        </tr>
                                        <tr>
                                            <td contenteditable="true">{% trans 'Ä°ÅŸ Paketi 2' %}</td>
                                            <td contenteditable="true">{% trans 'DetaylÄ± aÃ§Ä±klama' %}</td>
                                            <td contenteditable="true">{% trans 'Devam Ediyor' %}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
                break;
                
            case 'checklist':
                // Kontrol listesi ÅŸablonu
                reportContainer.innerHTML = `
                    <div class="report-row">
                        <div class="report-column">
                            <div class="report-component">
                                <h1 class="editable" contenteditable="true">{% trans 'Kontrol Listesi' %}</h1>
                                <table class="minimal-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 50px;">#</th>
                                            <th>{% trans 'Kontrol Maddesi' %}</th>
                                            <th style="width: 100px;">{% trans 'Durum' %}</th>
                                            <th style="width: 150px;">{% trans 'Sorumlu' %}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td contenteditable="true">1</td>
                                            <td contenteditable="true">{% trans 'Temel gÃ¼venlik kontrolÃ¼' %}</td>
                                            <td contenteditable="true">{% trans 'TamamlandÄ±' %}</td>
                                            <td contenteditable="true">Ahmet YÄ±lmaz</td>
                                        </tr>
                                        <tr>
                                            <td contenteditable="true">2</td>
                                            <td contenteditable="true">{% trans 'Elektrik tesisatÄ± kontrolÃ¼' %}</td>
                                            <td contenteditable="true">{% trans 'Beklemede' %}</td>
                                            <td contenteditable="true">Mehmet Demir</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
                break;
                
            default:
                console.error(`Bilinmeyen ÅŸablon: ${templateId}`);
                return;
        }
        
        // Yeni eklenen tablolarÄ± hazÄ±rla
        setTimeout(prepareAllTables, 100);
        
        // Olay tetikle
        document.dispatchEvent(new CustomEvent('templateLoaded', { 
            detail: { templateId: templateId } 
        }));
    } else {
        console.error('Report container bulunamadÄ±');
    }
}

// Masonry yapÄ±sÄ±nÄ± Ã¶lÃ§Ã¼lendirme iÃ§in gerekli yardÄ±mcÄ± fonksiyonlar
function updateMasonryLayout() {
    console.log('Masonry dÃ¼zeni gÃ¼ncelleniyor...');
    
    // TÃ¼m report-charts ve card-body konteynerlerini bul
    const gridContainers = document.querySelectorAll('.report-charts, .card-body[data-columns], .preview-grid');
    
    if (gridContainers.length === 0) {
        console.log('Masonry dÃ¼zeni iÃ§in konteyner bulunamadÄ±');
        return;
    }
    
    console.log('Masonry dÃ¼zeni iÃ§in konteyner sayÄ±sÄ±:', gridContainers.length);
    
    gridContainers.forEach(function(grid) {
        const cardElements = grid.querySelectorAll('.report-card');
        
        if (cardElements.length === 0) {
            console.log('Grid iÃ§inde card bulunamadÄ±:', grid);
            return;
        }
        
        console.log('Grid iÃ§indeki card sayÄ±sÄ±:', cardElements.length);
        
        // Masonry dÃ¼zenini temizle
        cardElements.forEach(function(card) {
            // Grid column ve row deÄŸerlerini sakla
            const gridCol = card.style.gridColumn;
            const gridRow = card.style.gridRow;
            
            // EÄŸer pozisyon absolute ise geri al
            if (card.style.position === 'absolute') {
                card.style.position = 'relative';
            }
            
            // Boyutunu hesapla
            const cardSize = card.getAttribute('data-size') || 'medium';
            
            // Grid sÃ¼tun deÄŸerini ayarla
            if (cardSize === 'small') {
                card.style.gridColumn = 'span 4';
            } else if (cardSize === 'medium') {
                card.style.gridColumn = 'span 4';
            } else if (cardSize === 'large') {
                card.style.gridColumn = 'span 8';
            } else if (cardSize === 'full') {
                card.style.gridColumn = 'span 12';
            } else if (!card.style.gridColumn) {
                card.style.gridColumn = 'span 4'; // VarsayÄ±lan deÄŸer
            }
        });
        
        // CSS grid'i dÃ¼zeltme
        grid.style.display = 'grid';
        grid.style.gridTemplateColumns = 'repeat(12, 1fr)';
        grid.style.gap = '20px';
    });
    
    console.log('Masonry dÃ¼zeni gÃ¼ncellendi');
}

// Yeniden boyutlandÄ±rma iÅŸlevselliÄŸi
function enableCardResizing() {
    console.log('Kart boyutlandÄ±rma etkinleÅŸtiriliyor...');
    
    // TÃ¼m kartlarÄ± bul
    const cards = document.querySelectorAll('.report-card:not(.resizable-initialized)');
    
    if (cards.length === 0) {
        console.log('BoyutlandÄ±rÄ±lacak kart bulunamadÄ±');
        return;
    }
    
    console.log('BoyutlandÄ±rÄ±lacak kart sayÄ±sÄ±:', cards.length);
    
    cards.forEach(function(card) {
        // KartÄ±n zaten boyutlandÄ±rÄ±labilir olup olmadÄ±ÄŸÄ±nÄ± kontrol et
        if (card.classList.contains('resizable-initialized')) {
            return;
        }
        
        // Kenar tutamaÃ§larÄ±nÄ± ekle
        const rightHandle = document.createElement('div');
        rightHandle.className = 'card-resize-handle card-resize-right';
        rightHandle.title = 'GeniÅŸliÄŸi deÄŸiÅŸtirmek iÃ§in sÃ¼rÃ¼kleyin';
        
        const bottomHandle = document.createElement('div');
        bottomHandle.className = 'card-resize-handle card-resize-bottom';
        bottomHandle.title = 'YÃ¼ksekliÄŸi deÄŸiÅŸtirmek iÃ§in sÃ¼rÃ¼kleyin';
        
        const cornerHandle = document.createElement('div');
        cornerHandle.className = 'card-resize-handle card-resize-corner';
        cornerHandle.title = 'Boyutu deÄŸiÅŸtirmek iÃ§in sÃ¼rÃ¼kleyin';
        
        // TutamaÃ§larÄ± karta ekle
        card.appendChild(rightHandle);
        card.appendChild(bottomHandle);
        card.appendChild(cornerHandle);
        
        // jQuery ile boyutlandÄ±rma iÅŸlemleri
        
        // SaÄŸ kenar boyutlandÄ±rma
        $(rightHandle).on('mousedown', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const startX = e.pageX;
            const startWidth = $(card).width();
            const parent = $(card).parent();
            const parentWidth = parent.width();
            
            // Grid uyumu iÃ§in
            const minWidth = Math.floor(parentWidth / 12);
            
            // TaÅŸÄ±ma iÅŸlemi
            $(document).on('mousemove.resize', function(e) {
                const newWidth = startWidth + (e.pageX - startX);
                
                // GeniÅŸliÄŸi gÃ¼ncelle
                if (newWidth >= minWidth) {
                    $(card).width(newWidth + 'px');
                    
                    // Span deÄŸerini hesapla
                    const span = Math.max(1, Math.min(12, Math.round((newWidth / parentWidth) * 12)));
                    card.style.gridColumn = `span ${span}`;
                    
                    // data-size Ã¶zniteliÄŸini gÃ¼ncelle
                    if (span <= 3) {
                        card.setAttribute('data-size', 'small');
                    } else if (span <= 6) {
                        card.setAttribute('data-size', 'medium');
                    } else if (span <= 9) {
                        card.setAttribute('data-size', 'large');
                    } else {
                        card.setAttribute('data-size', 'full');
                    }
                }
            });
            
            // TaÅŸÄ±ma bitti
            $(document).on('mouseup.resize', function() {
                $(document).off('mousemove.resize mouseup.resize');
                
                // Masonry dÃ¼zenini gÃ¼ncelle
                setTimeout(function() {
                    updateMasonryLayout();
                    if (typeof initializeMasonryLayout === 'function') {
                        initializeMasonryLayout();
                    }
                    if (typeof organizeReportCards === 'function') {
                        organizeReportCards();
                    }
                }, 100);
            });
            
            $(card).addClass('resizing');
            $('body').css('cursor', 'ew-resize');
        });
        
        // Alt kenar boyutlandÄ±rma
        $(bottomHandle).on('mousedown', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const startY = e.pageY;
            const startHeight = $(card).height();
            
            // TaÅŸÄ±ma iÅŸlemi
            $(document).on('mousemove.resize', function(e) {
                const newHeight = startHeight + (e.pageY - startY);
                
                // YÃ¼ksekliÄŸi gÃ¼ncelle
                if (newHeight >= 100) {
                    $(card).height(newHeight + 'px');
                }
            });
            
            // TaÅŸÄ±ma bitti
            $(document).on('mouseup.resize', function() {
                $(document).off('mousemove.resize mouseup.resize');
                
                // Masonry dÃ¼zenini gÃ¼ncelle
                setTimeout(function() {
                    updateMasonryLayout();
                    if (typeof initializeMasonryLayout === 'function') {
                        initializeMasonryLayout();
                    }
                    if (typeof organizeReportCards === 'function') {
                        organizeReportCards();
                    }
                }, 100);
            });
            
            $(card).addClass('resizing');
            $('body').css('cursor', 'ns-resize');
        });
        
        // KÃ¶ÅŸe boyutlandÄ±rma
        $(cornerHandle).on('mousedown', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const startX = e.pageX;
            const startY = e.pageY;
            const startWidth = $(card).width();
            const startHeight = $(card).height();
            const parent = $(card).parent();
            const parentWidth = parent.width();
            
            // Grid uyumu iÃ§in
            const minWidth = Math.floor(parentWidth / 12);
            
            // TaÅŸÄ±ma iÅŸlemi
            $(document).on('mousemove.resize', function(e) {
                const newWidth = startWidth + (e.pageX - startX);
                const newHeight = startHeight + (e.pageY - startY);
                
                // GeniÅŸlik ve yÃ¼ksekliÄŸi gÃ¼ncelle
                if (newWidth >= minWidth) {
                    $(card).width(newWidth + 'px');
                    
                    // Span deÄŸerini hesapla
                    const span = Math.max(1, Math.min(12, Math.round((newWidth / parentWidth) * 12)));
                    card.style.gridColumn = `span ${span}`;
                    
                    // data-size Ã¶zniteliÄŸini gÃ¼ncelle
                    if (span <= 3) {
                        card.setAttribute('data-size', 'small');
                    } else if (span <= 6) {
                        card.setAttribute('data-size', 'medium');
                    } else if (span <= 9) {
                        card.setAttribute('data-size', 'large');
                    } else {
                        card.setAttribute('data-size', 'full');
                    }
                }
                
                if (newHeight >= 100) {
                    $(card).height(newHeight + 'px');
                }
            });
            
            // TaÅŸÄ±ma bitti
            $(document).on('mouseup.resize', function() {
                $(document).off('mousemove.resize mouseup.resize');
                
                // Masonry dÃ¼zenini gÃ¼ncelle
                setTimeout(function() {
                    updateMasonryLayout();
                    if (typeof initializeMasonryLayout === 'function') {
                        initializeMasonryLayout();
                    }
                    if (typeof organizeReportCards === 'function') {
                        organizeReportCards();
                    }
                }, 100);
            });
            
            $(card).addClass('resizing');
            $('body').css('cursor', 'nwse-resize');
        });
        
        // BoyutlandÄ±rma tamamlandÄ±ÄŸÄ±nda resizing sÄ±nÄ±fÄ±nÄ± kaldÄ±r
        $(document).on('mouseup', function() {
            $(card).removeClass('resizing');
            $('body').css('cursor', '');
        });
        
        // KartÄ± baÅŸlatÄ±ldÄ± olarak iÅŸaretle
        card.classList.add('resizable-initialized');
        
        // Konum iÃ§in relative ekle
        if (getComputedStyle(card).position === 'static') {
            card.style.position = 'relative';
        }
    });
    
    console.log('Kart boyutlandÄ±rma etkinleÅŸtirildi');
}

document.addEventListener('DOMContentLoaded', function() {
// ... existing code ...

    // Sayfa yÃ¼klendikten sonra dÃ¼zenleri uygula
    setTimeout(function() {
        // KartlarÄ± Ã¶lÃ§Ã¼lendirilebilir yap
        enableCardResizing();
        
        // Masonry dÃ¼zenini uygula
        updateMasonryLayout();
        
        // Global fonksiyonlarÄ± Ã§aÄŸÄ±r
        if (typeof initializeMasonryLayout === 'function') {
            initializeMasonryLayout();
        }
        
        if (typeof organizeReportCards === 'function') {
            organizeReportCards();
        }
    }, 1000);
    
    // Pencere boyutu deÄŸiÅŸtiÄŸinde masonry dÃ¼zenini gÃ¼ncelle
    window.addEventListener('resize', function() {
        updateMasonryLayout();
        
        if (typeof initializeMasonryLayout === 'function') {
            initializeMasonryLayout();
        }
    });
    
    // Åžablon deÄŸiÅŸtiÄŸinde kartlarÄ± yeniden dÃ¼zenle
    document.addEventListener('templateSelected', function(e) {
        console.log('Åžablon deÄŸiÅŸti, kartlar yeniden dÃ¼zenleniyor:', e.detail.templateId);
        setTimeout(function() {
            // KartlarÄ± Ã¶lÃ§Ã¼lendirilebilir yap
            enableCardResizing();
            
            // Masonry dÃ¼zenini uygula
            updateMasonryLayout();
            
            // Global fonksiyonlarÄ± Ã§aÄŸÄ±r
            if (typeof initializeMasonryLayout === 'function') {
                initializeMasonryLayout();
            }
            
            if (typeof organizeReportCards === 'function') {
                organizeReportCards();
            }
        }, 500);
    });
});
// ... existing code ...
</script>

{% block extra_styles %}
<style>
    /* Rapor bileÅŸenleri ve masonry grid iÃ§in dark mode stiller */
    .dark-mode .report-card {
        background-color: var(--card-bg-color);
        border-color: var(--card-border-color);
        box-shadow: 0 1px 3px var(--card-box-shadow-color);
    }

    .dark-mode .report-card.resizing {
        box-shadow: 0 0 10px rgba(33, 150, 243, 0.5);
    }

    .dark-mode .card-resize-handle {
        background-color: rgba(33, 150, 243, 0.3);
    }

    .dark-mode .card-resize-corner {
        background-color: rgba(33, 150, 243, 0.5);
    }
    
    /* Dark mode iÃ§in arabirim Ã¶ÄŸeleri */
    .dark-mode .report-container {
        background-color: var(--body-bg-color);
    }
    
    .dark-mode .report-sidebar {
        background-color: var(--sidebar-bg-color);
        border-color: var(--general-border-color);
    }
    
    .dark-mode .sidebar-header {
        border-color: var(--general-border-color);
    }
    
    .dark-mode .sidebar-title {
        color: #e0e0e0;
    }
    
    .dark-mode .sidebar-filters {
        border-color: var(--general-border-color);
    }
    
    .dark-mode .filter-label {
        color: #bbb;
    }
    
    .dark-mode .component-category {
        color: #e0e0e0;
    }
    
    .dark-mode .category-title {
        color: #e0e0e0;
    }
    
    .dark-mode .component-item {
        background-color: #2d2d2d;
        border-color: #444;
        color: #e0e0e0;
    }
    
    .dark-mode .component-item:hover {
        background-color: #3d3d3d;
        border-color: #22D6B5;
    }
    
    .dark-mode .component-item.selected {
        background-color: rgba(34, 214, 181, 0.2);
        border-color: #22D6B5;
        color: #22D6B5;
    }
    
    .dark-mode .component-icon {
        background-color: #222;
    }
    
    .dark-mode .component-desc {
        color: #bbb;
    }
    
    /* AraÃ§ Ã§ubuklarÄ± ve dÃ¼ÄŸmeler iÃ§in dark mode */
    .dark-mode .editor-toolbar {
        background-color: #2d2d2d;
        border-color: var(--general-border-color);
    }
    
    .dark-mode .toolbar-btn {
        color: #e0e0e0;
    }
    
    .dark-mode .toolbar-btn:hover {
        background-color: #444;
    }
    
    .dark-mode .card-action-btn {
        color: #bbb;
    }
    
    .dark-mode .card-action-btn:hover {
        background-color: #444;
        color: #fff;
    }
    
    /* Ã–nemli: A4 Ã§Ä±ktÄ± alanÄ± dark mode dÄ±ÅŸÄ±nda kalmalÄ± */
    .dark-mode .preview-container,
    .dark-mode .preview-container * {
        background-color: #fff !important;
        color: initial !important;
        border-color: initial !important;
    }
    
    .dark-mode .preview-container .minimal-table {
        color: initial !important;
        border-color: #ddd !important;
    }
    
    .dark-mode .preview-container .minimal-table th {
        background-color: #f5f5f5 !important;
        color: #333 !important;
        border-color: #ddd !important;
    }
    
    .dark-mode .preview-container .minimal-table td {
        border-color: #ddd !important;
        color: #333 !important;
    }
    
    .dark-mode .preview-container .editable {
        color: #333 !important;
        background-color: transparent !important;
    }
    
    .dark-mode .preview-container .editable:focus {
        background-color: rgba(0, 0, 0, 0.05) !important;
    }
    
    .dark-mode .preview-container .report-component {
        background-color: #fff !important;
        border-color: #ddd !important;
    }
    
    .dark-mode .preview-container .report-row {
        border-color: #ddd !important;
    }
    
    .dark-mode .preview-container .report-column {
        border-color: #ddd !important;
    }
    
    /* PDF Ã¶nizleme alanÄ± ve butonlar */
    .dark-mode .preview-actions {
        background-color: var(--card-bg-color);
        border-color: var(--general-border-color);
    }
    
    .dark-mode .preview-actions button {
        background-color: #2d2d2d;
        color: #e0e0e0;
        border-color: #444;
    }
    
    .dark-mode .preview-actions button:hover {
        background-color: #3d3d3d;
    }
    
    .dark-mode .preview-actions button.active {
        background-color: #22D6B5;
        color: #fff;
    }

    /* DateRangePicker iÃ§in z-index dÃ¼zeltmesi ve dark mode stilleri... */
    
    /* Minimal proje Ã¶zeti komponenti iÃ§in stiller */
    .minimal-project-summary {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .summary-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
    }
    
    .dark-mode .summary-header {
        border-color: #444;
    }

    .summary-title {
        font-size: 16px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .summary-subtitle {
        font-size: 12px;
        color: #666;
    }
    
    .dark-mode .summary-subtitle {
        color: #aaa;
    }

    .summary-stats {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .stat-card {
        flex: 1;
        min-width: 100px;
        background: #f9f9f9;
        border-radius: 5px;
        padding: 10px;
        border: 1px solid #eee;
        display: flex;
        flex-direction: column;
    }
    
    .dark-mode .stat-card {
        background: #2a2a2a;
        border-color: #444;
    }

    .stat-header {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .dark-mode .stat-header {
        color: #bbb;
    }

    .stat-value {
        font-size: 18px;
        font-weight: 600;
    }
    
    .dark-mode .stat-value {
        color: #e0e0e0;
    }

    .chart-row {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }

    .mini-chart {
        flex: 1;
        min-width: 220px;
        height: 180px;
        background: #fff;
        border-radius: 5px;
        border: 1px solid #eee;
        padding: 10px;
    }
    
    .dark-mode .mini-chart {
        background: #2a2a2a;
        border-color: #444;
    }

    .progress-info {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: #666;
        margin-top: 5px;
    }
    
    .dark-mode .progress-info {
        color: #bbb;
    }
    
    /* SÃ¼rÃ¼kle bÄ±rak iÃ§in stil geliÅŸtirmeleri */
    .report-card {
        cursor: grab;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .report-card:active {
        cursor: grabbing;
    }

    .report-card.dragging {
        opacity: 0.8;
        z-index: 1000;
        box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        transform: scale(1.02);
    }

    .dropzone {
        border: 2px dashed #aaa;
        background-color: rgba(0,0,0,0.05);
        min-height: 50px;
        border-radius: 5px;
        margin: 5px 0;
    }
    
    /* YazdÄ±rma optimizasyonlarÄ± */
    @media print {
        @page {
            size: A4;
            margin: 10mm;
        }
        
        body {
            background: #fff !important;
        }

        .report-sidebar,
        .preview-actions,
        .card-actions,
        .sidebar-toggle,
        .modal,
        header,
        .card-resize-handle {
            display: none !important;
        }

        .report-container {
            padding: 0 !important;
            height: auto !important;
            background: none !important;
        }

        .report-main {
            margin: 0 !important;
            padding: 0 !important;
            box-shadow: none !important;
            width: 100% !important;
            background: none !important;
        }

        .preview-container {
            padding: 0 !important;
            margin: 0 !important;
            background: none !important;
        }

        /* Komponentler arasÄ± boÅŸluklarÄ± azalt */
        .preview-grid {
            gap: 5mm !important;
            background: none !important;
        }

        /* Her komponent iÃ§in sayfa kesme kontrolÃ¼ */
        .report-card {
            page-break-inside: avoid !important;
            margin-bottom: 8mm !important;
            border: 1px solid #ddd !important;
            box-shadow: none !important;
            break-inside: avoid !important;
        }

        /* Sayfa iÃ§i boÅŸluklarÄ± azalt */
        .card-header {
            margin-bottom: 5px !important;
            padding-bottom: 3px !important;
        }

        .card-body {
            padding: 0 !important;
        }

        /* Grafik boyutlarÄ±nÄ± optimize et */
        .chart-container, 
        .mini-chart {
            height: auto !important;
            max-height: 150px !important;
        }
        
        /* Minimal proje Ã¶zeti komponentlerini yazdÄ±rma iÃ§in optimize et */
        .minimal-project-summary {
            gap: 5px !important;
        }
        
        .stat-card {
            padding: 5px !important;
        }
        
        .chart-row {
            gap: 5px !important;
        }
        
        /* Gereksiz boÅŸluklarÄ± Ã¶nle */
        .summary-header {
            margin-bottom: 5px !important;
            padding-bottom: 3px !important;
        }
        
        /* ApexCharts iÃ§in yazdÄ±rma optimizasyonlarÄ± */
        .apexcharts-legend {
            font-size: 8px !important;
        }
        
        .apexcharts-text, .apexcharts-datalabel {
            font-size: 8px !important;
        }
        
        .apexcharts-gridline, .apexcharts-grid-stroke {
            stroke-width: 0.5 !important;
        }
    }
    
    /* Mobil iÃ§in iyileÅŸtirmeler */
    @media (max-width: 768px) {
        .chart-row {
            flex-direction: column;
        }
        
        .mini-chart {
            width: 100%;
            height: 150px;
        }
        
        .summary-stats {
            flex-direction: column;
        }
        
        .stat-card {
            width: 100%;
        }
    }
</style>
{% endblock extra_styles %}

{% block javascriptcode %}
{{ block.super }}
<script>
// Dark Mode kontrolÃ¼ iÃ§in JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // Dark mode kontrolÃ¼
    function checkDarkMode() {
        if (localStorage.getItem('dark-mode') === 'true') {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }
    }
    
    // Sayfa yÃ¼klendiÄŸinde dark mode kontrolÃ¼
    checkDarkMode();
    
    // Dark mode deÄŸiÅŸtiÄŸinde olay dinleyici
    window.addEventListener('storage', function(e) {
        if (e.key === 'dark-mode') {
            checkDarkMode();
        }
    });
    
    // Header'daki dark mode butonunu dinle
    const darkModeButton = document.querySelector('.header-actions [data-toggle="dark-mode"]');
    if (darkModeButton) {
        darkModeButton.addEventListener('click', function() {
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('dark-mode', 'false');
                document.body.classList.remove('dark-mode');
            } else {
                localStorage.setItem('dark-mode', 'true');
                document.body.classList.add('dark-mode');
            }
        });
    }
    
    // SÃ¼rÃ¼kle-bÄ±rak iyileÅŸtirmeleri
    initializeDragDrop();
    
    // Sayfa yazdÄ±rma optimizasyonlarÄ±
    optimizePrintLayout();
    
    // 'proje-ozeti' iÃ§in yeni minimal tasarÄ±m
    updateProjectSummaryComponent();
});

// SÃ¼rÃ¼kle-bÄ±rak Ã¶zelliÄŸi
function initializeDragDrop() {
    const containers = document.querySelectorAll('.report-charts, .preview-grid');
    
    containers.forEach(container => {
        new Sortable(container, {
            animation: 150,
            handle: '.card-header', // Sadece baÅŸlÄ±ktan tutulduÄŸunda sÃ¼rÃ¼klensin
            ghostClass: 'dragging',
            onStart: function(e) {
                // SÃ¼rÃ¼kleme baÅŸladÄ±ÄŸÄ±nda
                e.item.classList.add('dragging');
                // BoyutlandÄ±rma iÅŸlemini geÃ§ici olarak devre dÄ±ÅŸÄ± bÄ±rak
                const resizeHandles = e.item.querySelectorAll('.card-resize-handle');
                resizeHandles.forEach(handle => {
                    handle.style.pointerEvents = 'none';
                });
            },
            onEnd: function(e) {
                // SÃ¼rÃ¼kleme bittiÄŸinde
                e.item.classList.remove('dragging');
                // BoyutlandÄ±rma iÅŸlemini tekrar etkinleÅŸtir
                const resizeHandles = e.item.querySelectorAll('.card-resize-handle');
                resizeHandles.forEach(handle => {
                    handle.style.pointerEvents = 'auto';
                });
                
                // Grid dÃ¼zenini gÃ¼ncelle
                if (typeof updateMasonryLayout === 'function') {
                    updateMasonryLayout();
                }
                if (typeof organizeReportCards === 'function') {
                    organizeReportCards();
                }
                
                // Konum deÄŸiÅŸikliÄŸini lokal storage'a kaydet
                saveLayoutState();
            }
        });
    });
}

// Layout durumunu kaydetme
function saveLayoutState() {
    const layout = [];
    const reportCards = document.querySelectorAll('.report-card[data-type]');
    
    reportCards.forEach((card, index) => {
        layout.push({
            id: card.id || `card-${index}`,
            type: card.getAttribute('data-type'),
            size: card.getAttribute('data-size'),
            order: index,
            parentId: card.parentElement.id || null
        });
    });
    
    localStorage.setItem('report-layout', JSON.stringify(layout));
}

// Layout durumunu yÃ¼kleme
function loadLayoutState() {
    const savedLayout = localStorage.getItem('report-layout');
    if (!savedLayout) return;
    
    try {
        const layout = JSON.parse(savedLayout);
        
        layout.forEach(item => {
            const card = document.getElementById(item.id) || document.querySelector(`.report-card[data-type="${item.type}"]`);
            if (!card) return;
            
            // Kart boyutunu ayarla
            if (item.size) {
                card.setAttribute('data-size', item.size);
                updateCardSize(card, item.size);
            }
            
            // Kart konumunu ayarla
            const targetParent = item.parentId ? document.getElementById(item.parentId) : document.querySelector('.preview-grid');
            if (targetParent && card.parentElement !== targetParent) {
                targetParent.appendChild(card);
            }
        });
        
        // SÄ±ralama
        layout.forEach(item => {
            const card = document.getElementById(item.id) || document.querySelector(`.report-card[data-type="${item.type}"]`);
            if (!card || !card.parentElement) return;
            
            const siblings = Array.from(card.parentElement.children);
            const targetIndex = item.order;
            const currentIndex = siblings.indexOf(card);
            
            if (targetIndex !== currentIndex && targetIndex < siblings.length) {
                card.parentElement.insertBefore(card, siblings[targetIndex]);
            }
        });
        
        // Layout'u gÃ¼ncelle
        if (typeof updateMasonryLayout === 'function') {
            updateMasonryLayout();
        }
        if (typeof organizeReportCards === 'function') {
            organizeReportCards();
        }
    } catch (error) {
        console.error('Layout yÃ¼klenirken hata oluÅŸtu:', error);
    }
}

// YazdÄ±rma optimizasyonlarÄ±
function optimizePrintLayout() {
    // YazdÄ±rma Ã¶ncesi olayÄ±nÄ± dinle
    window.addEventListener('beforeprint', function() {
        // Komponenetler arasÄ± boÅŸluklarÄ± azalt
        const grid = document.querySelector('.preview-grid');
        if (grid) {
            grid.style.gap = '5mm';
            // Sayfa kesmeleri iÃ§in kontrol et
            addPageBreakHints();
        }
        
        // Chart boyutlarÄ±nÄ± optimize et
        const charts = document.querySelectorAll('.chart-container');
        charts.forEach(chart => {
            chart.style.height = '180px';
        });
    });
    
    // YazdÄ±rma sonrasÄ± olayÄ±nÄ± dinle
    window.addEventListener('afterprint', function() {
        // Eski ayarlara geri dÃ¶n
        const grid = document.querySelector('.preview-grid');
        if (grid) {
            grid.style.gap = '15mm';
            // Sayfa kesme ipuÃ§larÄ±nÄ± kaldÄ±r
            removePageBreakHints();
        }
        
        // Chart boyutlarÄ±nÄ± eski haline getir
        const charts = document.querySelectorAll('.chart-container');
        charts.forEach(chart => {
            chart.style.height = '';
        });
    });
}

// Sayfa kesme ipuÃ§larÄ± ekleme
function addPageBreakHints() {
    const reportCards = document.querySelectorAll('.report-card');
    const pageHeight = 297 - 20; // A4 yÃ¼ksekliÄŸi (mm) - kenar boÅŸluklarÄ±
    let currentPagePosition = 0;
    
    reportCards.forEach(card => {
        // KartÄ±n yÃ¼ksekliÄŸini mm cinsinden hesapla
        const cardHeightPx = card.offsetHeight;
        const cardHeightMm = cardHeightPx * 0.264583; // px -> mm dÃ¶nÃ¼ÅŸÃ¼mÃ¼
        
        // KartÄ±n bir sonraki sayfaya kayacaÄŸÄ±nÄ± tespit et
        if (currentPagePosition + cardHeightMm > pageHeight) {
            // Bir Ã¶nceki karta sayfa kesme ekle
            if (card.previousElementSibling && card.previousElementSibling.classList.contains('report-card')) {
                card.previousElementSibling.style.pageBreakAfter = 'always';
            }
            
            // Yeni sayfa pozisyonunu gÃ¼ncelle
            currentPagePosition = cardHeightMm;
        } else {
            // Mevcut sayfada devam et
            currentPagePosition += cardHeightMm;
        }
    });
}

// Sayfa kesme ipuÃ§larÄ±nÄ± kaldÄ±rma
function removePageBreakHints() {
    const reportCards = document.querySelectorAll('.report-card');
    reportCards.forEach(card => {
        card.style.pageBreakAfter = '';
    });
}

// Proje Ã–zeti Komponentini GÃ¼ncelleme
function updateProjectSummaryComponent() {
    // Proje Ã¶zeti kartlarÄ± iÃ§in seÃ§iciler
    const projectSummaryCards = document.querySelectorAll('.report-card[data-type="project-summary"]');
    
    if (!projectSummaryCards.length) return;
    
    // TÃ¼m Ã¶zet kartlarÄ±nÄ± dÃ¶nÃ¼ÅŸtÃ¼r
    projectSummaryCards.forEach(card => {
        const cardBody = card.querySelector('.card-body');
        if (!cardBody) return;
        
        // Åžu anki iÃ§eriÄŸi yedekle
        const currentContent = cardBody.innerHTML;
        
        // Mevcut parasal deÄŸerleri ve ilerleme bilgilerini al
        let borc = 0, alacak = 0, net = 0, tamamlanan = 0, planSuresi = 0, gecenSure = 0;
        
        try {
            // DeÄŸerleri mevcut iÃ§erikten Ã§Ä±kar
            const borcMatch = currentContent.match(/BorÃ§\s*:\s*([0-9.,]+)/);
            const alacakMatch = currentContent.match(/Alacak\s*:\s*([0-9.,]+)/);
            const tamamlananMatch = currentContent.match(/Tamamlanan\s*:\s*([0-9.,]+)/);
            const planSuresiMatch = currentContent.match(/Plan SÃ¼resi\s*:\s*([0-9.,]+)/);
            const gecenSureMatch = currentContent.match(/GeÃ§en SÃ¼re\s*:\s*([0-9.,]+)/);
            
            if (borcMatch && borcMatch[1]) borc = parseFloat(borcMatch[1].replace(/[.,]/g, ''));
            if (alacakMatch && alacakMatch[1]) alacak = parseFloat(alacakMatch[1].replace(/[.,]/g, ''));
            
            if (tamamlananMatch && tamamlananMatch[1]) tamamlanan = parseFloat(tamamlananMatch[1]);
            if (planSuresiMatch && planSuresiMatch[1]) planSuresi = parseFloat(planSuresiMatch[1]);
            if (gecenSureMatch && gecenSureMatch[1]) gecenSure = parseFloat(gecenSureMatch[1]);
            
            net = alacak - borc;
        } catch(e) {
            console.error("DeÄŸerler alÄ±nÄ±rken hata oluÅŸtu:", e);
        }
        
        // DÃ¶nÃ¼ÅŸtÃ¼rÃ¼lmÃ¼ÅŸ minimal tasarÄ±mÄ± oluÅŸtur
        const minimalDesign = `
            <div class="minimal-project-summary">
                <div class="summary-header">
                    <div class="summary-title">
                        <i class="fas fa-project-diagram"></i> Proje Ã–zeti
                    </div>
                    <div class="summary-subtitle">
                        <i class="far fa-calendar-alt"></i> ${new Date().toLocaleDateString('tr-TR')}
                    </div>
                </div>
                
                <div class="summary-stats">
                    <div class="stat-card">
                        <div class="stat-header">
                            <i class="fas fa-money-bill-wave"></i> BorÃ§
                        </div>
                        <div class="stat-value text-danger">${formatCurrency(borc)} â‚º</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <i class="fas fa-hand-holding-usd"></i> Alacak
                        </div>
                        <div class="stat-value text-success">${formatCurrency(alacak)} â‚º</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <i class="fas fa-balance-scale"></i> Net Durum
                        </div>
                        <div class="stat-value ${net >= 0 ? 'text-success' : 'text-danger'}">${formatCurrency(Math.abs(net))} â‚º</div>
                    </div>
                </div>
                
                <div class="chart-row">
                    <div class="mini-chart">
                        <div id="progress-chart-${card.id}" style="width:100%; height:150px;"></div>
                        <div class="progress-info">
                            <span>Tamamlanan: %${tamamlanan}</span>
                            <span>Kalan: %${(100 - tamamlanan).toFixed(1)}</span>
                        </div>
                    </div>
                    
                    <div class="mini-chart">
                        <div id="finance-chart-${card.id}" style="width:100%; height:150px;"></div>
                        <div class="progress-info">
                            <span>BorÃ§/Alacak OranÄ±</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Ä°Ã§eriÄŸi gÃ¼ncelle
        cardBody.innerHTML = minimalDesign;
        
        // Ä°lerleme grafiÄŸini oluÅŸtur
        createProgressChart(`progress-chart-${card.id}`, tamamlanan, gecenSure, planSuresi);
        
        // Finansal grafiÄŸi oluÅŸtur
        createFinanceChart(`finance-chart-${card.id}`, borc, alacak);
    });
    
    // TÃ¼m grafikleri yeniden boyutlandÄ±r
    if (typeof ApexCharts !== 'undefined') {
        ApexCharts.exec('progressCharts', 'render');
        ApexCharts.exec('financeCharts', 'render');
    }
}

// Para birimi formatÄ±
function formatCurrency(value) {
    return new Intl.NumberFormat('tr-TR').format(value);
}

// Ä°lerleme grafiÄŸini oluÅŸtur (Radyal progress chart)
function createProgressChart(elementId, tamamlanan, gecenSure, planSuresi) {
    if (typeof ApexCharts === 'undefined') {
        console.error('ApexCharts yÃ¼klenmedi');
        return;
    }
    
    // Tamamlanan yÃ¼zde ve sÃ¼re yÃ¼zdesi
    const progressPercent = Math.min(tamamlanan, 100);
    const timePercent = Math.min((gecenSure / planSuresi) * 100, 100).toFixed(1);
    
    // Zaman ve ilerleme karÅŸÄ±laÅŸtÄ±rmasÄ±
    let performanceStatus = 'Normal';
    let performanceColor = '#22D6B5'; // BiadaGO Turkuaz
    
    if (progressPercent < parseFloat(timePercent) - 10) {
        performanceStatus = 'Geride';
        performanceColor = '#FF4560'; // KÄ±rmÄ±zÄ±
    } else if (progressPercent > parseFloat(timePercent) + 10) {
        performanceStatus = 'Ä°leride';
        performanceColor = '#00E396'; // YeÅŸil
    }
    
    // Grafik seÃ§enekleri
    const options = {
        series: [progressPercent, parseFloat(timePercent)],
        chart: {
            height: 150,
            type: 'radialBar',
            id: 'progressCharts',
            toolbar: {
                show: false
            }
        },
        plotOptions: {
            radialBar: {
                startAngle: -135,
                endAngle: 135,
                hollow: {
                    margin: 0,
                    size: '30%',
                    background: 'transparent',
                },
                track: {
                    background: '#e7e7e7',
                    strokeWidth: '97%',
                    margin: 5,
                    dropShadow: {
                        enabled: false,
                    }
                },
                dataLabels: {
                    name: {
                        fontSize: '10px',
                        offsetY: -5,
                    },
                    value: {
                        fontSize: '14px',
                        fontWeight: 'bold',
                        formatter: function(val) {
                            return val + '%';
                        }
                    },
                    total: {
                        show: true,
                        label: performanceStatus,
                        color: performanceColor,
                        fontWeight: 600,
                        fontSize: '12px',
                        formatter: function() {
                            return '';
                        }
                    }
                }
            }
        },
        colors: [performanceColor, '#ddd'],
        stroke: {
            lineCap: 'round'
        },
        labels: ['Ä°lerleme', 'SÃ¼re'],
    };

    // Grafik elementinin var olduÄŸundan emin ol
    const element = document.getElementById(elementId);
    if (!element) {
        console.error(`Element bulunamadÄ±: ${elementId}`);
        return;
    }
    
    // Ã–nceki grafiÄŸi temizle
    element.innerHTML = '';
    
    // Yeni grafiÄŸi oluÅŸtur
    const chart = new ApexCharts(element, options);
    chart.render();
}

// Finansal grafiÄŸi oluÅŸtur (BorÃ§/Alacak pie chart)
function createFinanceChart(elementId, borc, alacak) {
    if (typeof ApexCharts === 'undefined') {
        console.error('ApexCharts yÃ¼klenmedi');
        return;
    }
    
    // Grafik seÃ§enekleri
    const options = {
        series: [borc, alacak],
        chart: {
            type: 'donut',
            height: 150,
            id: 'financeCharts',
            toolbar: {
                show: false
            }
        },
        labels: ['BorÃ§', 'Alacak'],
        colors: ['#FF4560', '#00E396'],
        legend: {
            position: 'bottom',
            fontSize: '10px',
            offsetY: 0,
            itemMargin: {
                horizontal: 5,
                vertical: 0
            }
        },
        dataLabels: {
            enabled: false
        },
        plotOptions: {
            pie: {
                donut: {
                    size: '60%',
                    labels: {
                        show: true,
                        name: {
                            show: true,
                            fontSize: '10px',
                            offsetY: -5
                        },
                        value: {
                            show: true,
                            fontSize: '14px',
                            fontWeight: 'bold',
                            formatter: function(val) {
                                return formatCurrency(val) + ' â‚º';
                            }
                        },
                        total: {
                            show: true,
                            label: 'Toplam',
                            fontSize: '12px',
                            formatter: function(w) {
                                const total = w.globals.seriesTotals.reduce((a, b) => a + b, 0);
                                return formatCurrency(total) + ' â‚º';
                            }
                        }
                    }
                }
            }
        },
        responsive: [{
            breakpoint: 480,
            options: {
                chart: {
                    height: 120
                },
                legend: {
                    position: 'bottom'
                }
            }
        }]
    };
    
    // Grafik elementinin var olduÄŸundan emin ol
    const element = document.getElementById(elementId);
    if (!element) {
        console.error(`Element bulunamadÄ±: ${elementId}`);
        return;
    }
    
    // Ã–nceki grafiÄŸi temizle
    element.innerHTML = '';
    
    // Yeni grafiÄŸi oluÅŸtur
    const chart = new ApexCharts(element, options);
    chart.render();
}

// ... existing code ...
</script>
{% endblock javascriptcode %}