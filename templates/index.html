{% extends "homebase.html" %}
{% load i18n %}
{% load static %}
{% load custom_tags %}
{% block sidebar %}
{% if hash_bilgi %}
<style>@media (max-width: 768px) {
    .building-container {
        width: 58%;
        height: 70vh;
        /* Mobilde yükseklik %70 olacak */
        padding-top: 20px;
        box-sizing: border-box;
    }}</style>
<main>

    <div class="quick-actions">
        <div class="quick-actions-header">
            <div class="quick-actions-title">{% trans 'Hızlı Menü' %}</div>
            <div class="quick-actions-right">
                <button class="quick-actions-add" onclick="showHiddenActions()">
                    <i class="icon icon-add"></i> {% trans 'Gizli Öğeler' %}
                </button>
                <div class="quick-actions-toggle">
                    <i class="icon icon-arrow-circle-up"></i>
                    <i class="icon icon-arrow-circle-down"></i>
                </div>
            </div>
        </div>
        <div class="quick-actions-body close">
            <div class="quick-actions-inner">
                <div class="quick-actions-grid" id="quick-actions-grid">
                    <a href="/{{dil}}{% url 'main:santiye_kalem_ve_blog' %}" class="quick-action" data-id="1" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-document"></i> {% trans 'Raporlar' %}</a>
                    <a href="/{{dil}}{% url 'main:santiye_kalem_ve_blog'  %}" class="quick-action" data-id="2" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-ilerleme-takibi"></i>{% trans 'İlerleme Takibi' %} </a>
                    <a href="/{{dil}}{% url 'accounting:giderler_ozeti' %}" class="quick-action" data-id="3" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-giderler"></i> {% trans 'Giderler' %}</a>
                    <a href="/{{dil}}{% url 'accounting:gelirler_ozeti' %}" class="quick-action" data-id="4" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-gelirler"></i>{% trans 'Gelirler' %} </a>
                    <a href="/{{dil}}{% url 'accounting:giderler_sayfasi_borc'  %}" class="quick-action" data-id="5" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-muhasebe"></i>{% trans 'Borçlar' %} </a>
                    <a href="/{{dil}}{% url 'users:personeller_puantaj_sayfasi'  %}" class="quick-action" data-id="6" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-puantaj-girisi"></i>{% trans 'Puantaj Girişi' %}</a>
                    <a href="/{{dil}}{% url 'accounting:satin_alma_talabi' %}" class="quick-action" data-id="7" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-satin-alma"></i>{% trans 'Satın Alma' %}</a>
                    <a href="/{{dil}}{% url 'users:personeller_sayfasi'  %}" class="quick-action" data-id="8" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-yeni-personel"></i>{% trans 'Personel Ekle' %} </a>
                    <a href="/{{dil}}{% url 'users:kullanicilarim'  %}" class="quick-action" data-id="9" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-yeni-kullanici"></i> {% trans 'Kullanıcı Ekle' %}</a>
                    <a href="/{{dil}}{% url 'main:depolama_sistemim' %}" class="quick-action" data-id="10" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-dosya-yoneticisi"></i>{% trans 'Dosya Yöneticisi' %} </a>
                    <a href="/{{dil}}{% url 'main:taseron_sayfasi'  %}" class="quick-action" data-id="11" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-taseronlar"></i> {% trans 'Taşeronlar' %}</a>
                    <a href="/{{dil}}{% url 'main:sozlesmler_sayfasi'  %}"  class="quick-action" data-id="12" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-sozlesmeler"></i> {% trans 'Sözleşmeler' %}</a>
                    <a href="/{{dil}}{% url 'main:hakedis_sayfasi'  %}" class="quick-action" data-id="13" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-hakedisler"></i> {% trans 'Hakedişler' %}</a>
                    <a href="/{{dil}}{% url 'main:yapilacaklar'  %}" class="quick-action" data-id="14" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-gorevler"></i> {% trans 'İş Emirleri' %}</a>
                    <a href="/{{dil}}{% url 'accounting:kasa'  %}" class="quick-action" data-id="15" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-kasa"></i> {% trans 'Kasa' %}</a>
                    <a href="/{{dil}}{% url 'accounting:cari'  %}" class="quick-action" data-id="16" oncontextmenu="hideQuickLink(event, this)"><i
                            class="icon icon-users"></i> {% trans 'Cari Hesapları' %}</a>
                </div>
            </div>
        </div>
    </div>


    <div class="quick-action-modal " id="hiddenLinksModal">
        <div class="quick-action-modal-content">
            <div class="quick-action-modal-header">
                <span>{% trans 'Gizli Öğeler' %}</span>
                <button onclick="hideHiddenActions()"><i class="icon icon-close"></i></button>
            </div>
            <div class="quick-actions-grid modal-body">
            </div>
        </div>
    </div>

    <script>

        const hiddenLinksModalBody = document.querySelector('#hiddenLinksModal .modal-body');
        document.addEventListener('DOMContentLoaded', function () {
            const quickLinks = document.getElementById('quick-actions-grid');
            const hiddenLinksModalBody = document.querySelector('#hiddenLinksModal .modal-body');

            // Hızlı linkleri sürükle-bırak düzenleme
            new Sortable(quickLinks, {
                animation: 150,
                handle: '.quick-action',
                onEnd: function (evt) {
                    const items = Array.from(quickLinks.children);
                    const order = items.map(item => item.dataset.id);
                    sessionStorage.setItem('quickLinksOrder', JSON.stringify(order));
                }
            });


            // Gizli linkleri modalda geri getirme
            hiddenLinksModalBody.addEventListener('click', function (event) {
                const link = event.target.closest('.hidden-link');
                if (link) {
                    const id = link.dataset.id;
                    const hiddenItem = document.querySelector(`[data-id="${id}"]`);
                    if (hiddenItem) {
                        hiddenItem.style.display = "flex"; // Linki geri görünür yap
                        quickLinks.appendChild(hiddenItem); // Sayfaya geri ekle
                        link.remove(); // Modaldan kaldır
                        saveHiddenLinks(); // Gizli linklerin durumunu kaydet
                    }
                }
            });

            // Oturum açıldığında kullanıcı düzenini yükle
            const savedQuickLinksOrder = JSON.parse(sessionStorage.getItem('quickLinksOrder'));
            if (savedQuickLinksOrder) {
                savedQuickLinksOrder.forEach(id => {
                    const item = quickLinks.querySelector(`[data-id='${id}']`);
                    if (item) {
                        quickLinks.appendChild(item);
                    }
                });
            }

            // Gizli linklerin durumunu kaydet
            function saveHiddenLinks() {
                const hiddenLinks = Array.from(hiddenLinksModalBody.querySelectorAll('.hidden-link')).map(link => link.dataset.id);
                sessionStorage.setItem('hiddenLinks', JSON.stringify(hiddenLinks));
            }

            // Gizli linkleri yükleme
            function loadHiddenLinks() {
                const hiddenLinks = JSON.parse(sessionStorage.getItem('hiddenLinks'));
                if (hiddenLinks) {
                    hiddenLinks.forEach(id => {
                        const item = quickLinks.querySelector(`[data-id='${id}']`);
                        if (item) {
                            item.style.display = "none"; // Linki gizle
                            const hiddenLink = document.createElement('div');
                            hiddenLink.className = 'hidden-link';
                            hiddenLink.dataset.id = id;
                            hiddenLink.innerHTML = item.innerHTML;
                            hiddenLinksModalBody.appendChild(hiddenLink);
                        }
                    });
                }
            }

            loadHiddenLinks(); // Gizli linkleri sayfa yüklendiğinde çağır
        });

        // Gizli linklerin durumunu kaydet
        function saveHiddenLinks() {
            const hiddenLinks = Array.from(hiddenLinksModalBody.querySelectorAll('.hidden-link')).map(link => link.dataset.id);
            sessionStorage.setItem('hiddenLinks', JSON.stringify(hiddenLinks));
        }

        // Hızlı linki gizleme
        function hideQuickLink(event, element) {
            event.preventDefault();
            const id = element.dataset.id;
            element.style.display = "none"; // Sayfadan gizle
            const hiddenLink = document.createElement('div');
            hiddenLink.className = 'hidden-link';
            hiddenLink.dataset.id = id;
            hiddenLink.innerHTML = element.innerHTML;
            document.querySelector('#hiddenLinksModal .modal-body').appendChild(hiddenLink);
            saveHiddenLinks(); // Gizli linklerin durumunu kaydet
        }

        function showHiddenActions() {
            $(".quick-action-modal").css("display", "flex").hide().fadeIn();
        }

        function hideHiddenActions() {
            $(".quick-action-modal").fadeOut();
        }

        let quickActionModal = document.querySelector(".quick-action-modal");
        $(".quick-action-modal").on("click", function (e) {
            if (e.target == quickActionModal) {
                hideHiddenActions();
            }
        })

        let quickActionsToggle = document.querySelector(".quick-actions-toggle");
        let quickActionsBody = document.querySelector(".quick-actions-body");

        quickActionsToggle.addEventListener("click", function () {
            quickActionsBody.classList.toggle("open");
        });







    </script>



    <div class="main-cards">
        <div class="profile-card">
            <div class="profile-avatar-dash">
            {% if hash_bilgi.image %}
                    <img src="{{hash_bilgi.image.url}}" style="max-width: 80px; max-height: 80px;" alt="Profile">

                    {% else %}
                    <img src="{% static 'go/images/profile.png' %}" alt="Profile">
                    {% endif %}
                
            </div>
            <div class="profile-info">
                <div class="profile-title">{{hash_bilgi.last_name}} <span> {% if hash_bilgi.gorevi %}
                    {{hash_bilgi.gorevi}}
                {% else %}
                {% endif %} </span></div>
                <div class="profile-date"><i class="icon icon-calendar"></i> 

<span id="day-name"> </span><span id="fds">-</span>
<span id="full-date"></span>
</div>
                
            </div>
        </div>
    
    <div class="stats-card">
            <div class="stats-title">{% trans 'GELİR' %}</div>
            {% if request.user.kullanicilar_db %}
            {% gelirler_tutari request.user.kullanicilar_db as gelir_bilgisi_cek %}
            {% else %}
            {% gelirler_tutari hash_bilgi as gelir_bilgisi_cek %}
            {% endif %}
            <div class="stats-content">
                <div class="stats-value"> $ {{gelir_bilgisi_cek.tutar}}</div>
                <div class="stats-rease">

                    {% if request.user.kullanicilar_db %}
                    {% gelir_yuzde_farki request.user.kullanicilar_db  as gelirhaftafarki %}
                    {% else %}
                    {% gelir_yuzde_farki hash_bilgi as gelirhaftafarki %}
                    {% endif %}
                    {% if request.user.kullanicilar_db %}
                    {% son_dort_ay_tutar request.user.kullanicilar_db  as aylik_gelir %}
                    {% else %}
                    {% son_dort_ay_tutar hash_bilgi as aylik_gelir %}
                    {% endif %}
                    {% if gelirhaftafarki.arti  %}
                <div class="stats-rease-icon"><i class="icon icon-increment"></i></div>
                {% blocktrans with fark=gelirhaftafarki.fark %}
                    <b>{{ fark }}%</b> haftalık değişim
                {% endblocktrans %}
            </div>
            {% else %}
                <div class="stats-rease-icon"><i class="icon icon-decrement"></i></div>
                {% blocktrans with fark=gelirhaftafarki.fark %}
                    <b>{{ fark }}%</b> haftalık değişim
                {% endblocktrans %}
            </div>
            {% endif %}

                    
            </div>
            <div class="stats-img">


                <div id="stats-gelir"></div>

                <script>
                    var options = {
                        series: [{
                            name: "{% trans 'Gelir' %}",
                            data: {{aylik_gelir.tutarlar | safe}}
                        }],
                        chart: {
                            width: 120,
                            height: 120,
                            type: 'line',
                            toolbar: {
                                show: false
                            },
                            zoom: {
                                enabled: false
                            },
                        },
                        dataLabels: {
                            enabled: false
                        },
                        stroke: {
                            curve: 'smooth',
                            colors: ['#22B076']
                        },
                        xaxis: {
                            labels: {
                                show: false
                            },
                            axisBorder: {
                                show: false
                            },
                            axisTicks: {
                                show: false
                            },
                            tickAmount: 0,
                            categories: {{aylik_gelir.aylar | safe}}
                        },
                        yaxis: {
                            labels: {
                                show: false
                            },
                            axisBorder: {
                                show: false
                            },
                            axisTicks: {
                                show: false
                            },
                            tickAmount: 0
                        },
                        grid: {
                            show: false
                        }
                    };


                    var chart = new ApexCharts(document.querySelector("#stats-gelir"), options);
                    chart.render();


                </script>




            </div>
        </div>
        <div class="stats-card">
            <div class="stats-title">{% trans 'GİDER' %}</div>
            {% if request.user.kullanicilar_db %}
            {% giderler_tutari request.user.kullanicilar_db  as gider_bilgisicekeme %}
            {% else %}
            {% giderler_tutari hash_bilgi  as gider_bilgisicekeme %}
            {% endif %}
            <div class="stats-content">
                <div class="stats-value">$ {{gider_bilgisicekeme.genel_odeme2}}</div>
                <div class="stats-rease">
                {% if request.user.kullanicilar_db %}
                    {% gider_yuzde_farki request.user.kullanicilar_db  as gelirhaftafarki %}
                    {% else %}
                    {% gider_yuzde_farki hash_bilgi as gelirhaftafarki %}
                    {% endif %}
                    {% if request.user.kullanicilar_db %}
                    {% son_dort_ay_tutar_gider request.user.kullanicilar_db  as aylik_gelir %}
                    {% else %}
                    {% son_dort_ay_tutar_gider hash_bilgi as aylik_gelir %}
                    {% endif %}
                    {% if gelirhaftafarki.arti  %}
                <div class="stats-rease-icon"><i class="icon icon-increment"></i></div>
                {% blocktrans with fark=gelirhaftafarki.fark %}
                    <b>{{ fark }}%</b> haftalık değişim
                {% endblocktrans %}
            </div>
            {% else %}
                <div class="stats-rease-icon"><i class="icon icon-decrement"></i></div>
                {% blocktrans with fark=gelirhaftafarki.fark %}
                    <b>{{ fark }}%</b> haftalık değişim
                {% endblocktrans %}
            </div>
            {% endif %}
                    
            </div>
            <div class="stats-img">

                <div id="stats-gider"></div>

                <script>
                    var options = {
                        series: [{
                            name: "{% trans 'Gider' %}",
                            data: {{aylik_gelir.tutarlar | safe}}
                        }],
                        chart: {
                            width: 120,
                            height: 120,
                            type: 'line',
                            toolbar: {
                                show: false
                            },
                            zoom: {
                                enabled: false
                            },
                        },
                        dataLabels: {
                            enabled: false
                        },
                        stroke: {
                            curve: 'smooth',
                            colors: ['#26CFE3']
                        },
                        xaxis: {
                            labels: {
                                show: false
                            },
                            axisBorder: {
                                show: false
                            },
                            axisTicks: {
                                show: false
                            },
                            tickAmount: 0,
                            categories: {{aylik_gelir.aylar | safe}}
                        },
                        yaxis: {
                            labels: {
                                show: false
                            },
                            axisBorder: {
                                show: false
                            },
                            axisTicks: {
                                show: false
                            },
                            tickAmount: 0
                        },
                        grid: {
                            show: false
                        }
                    };


                    var chart = new ApexCharts(document.querySelector("#stats-gider"), options);
                    chart.render();


                </script>


            </div>
        </div>
        <div class="weather-card">
            <div class="weather-location">
            {{sehir}}
            <span id="day-names"></span>
            <span id="time-date"></span>
            </div>
            <div class="weather-content">
                <div class="weather-wind">
                    <span>{{weather_data.wind.speed}} km/s</span>
                    <div class="wind-direction" style="transform: rotate({{weather_data.wind.deg}}deg);">
                        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L15 8H9L12 2ZM12 22V8" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>
                <div class="weather-temp">
                    <span>{{weather_data.main.temp |stringformat:'.f'}}°</span>
                    <img src="http://openweathermap.org/img/wn/{{icon}}@2x.png" alt="">
                </div>
            </div>
        </div>
        <div class="stats-card">
            <div class="stats-title">{% trans 'BORÇ' %}</div>
            {% basit_cikarma  gelir_bilgisi_cek.tutar gelir_bilgisi_cek.genel_odeme as gelir_islem_sonucu  %}
                                                {% basit_cikarma  gider_bilgisicekeme.tutar gider_bilgisicekeme.genel_odeme as gider_islem_sonucu  %}
                                                {% basit_cikarma  gelir_islem_sonucu gider_islem_sonucu as sonuc_Bilgisi  %}
            <div class="stats-content">
                <div class="stats-value">${% mutlak_deger  sonuc_Bilgisi %}</div>
                <div class="stats-rease">
                    {% if request.user.kullanicilar_db %}
                    {% borc_yuzde_farki request.user.kullanicilar_db  as gelirhaftafarki %}
                    {% else %}
                    {% borc_yuzde_farki hash_bilgi as gelirhaftafarki %}
                    {% endif %}
                    {% if request.user.kullanicilar_db %}
                    {% borc_son_dort_ay_tutar request.user.kullanicilar_db  as aylik_gelir %}
                    {% else %}
                    {% borc_son_dort_ay_tutar hash_bilgi as aylik_gelir %}
                    {% endif %}
                    {% if gelirhaftafarki.arti  %}
                <div class="stats-rease-icon"><i class="icon icon-increment"></i></div>
                {% blocktrans with fark=gelirhaftafarki.fark %}
                    <b>{{ fark }}%</b> haftalık değişim
                {% endblocktrans %}
            </div>
            {% else %}
                <div class="stats-rease-icon"><i class="icon icon-decrement"></i></div>
                {% blocktrans with fark=gelirhaftafarki.fark %}
                    <b>{{ fark }}%</b> haftalık değişim
                {% endblocktrans %}
            </div>
            {% endif %}
            </div>
            <div class="stats-img">

                <div id="stats-borc"></div>

                <script>
                    var options = {
                        series: [{
                            name: "{% trans 'Borç' %}",
                            data: {{aylik_gelir.tutarlar | safe}}
                        }],
                        chart: {
                            width: 120,
                            height: 120,
                            type: 'line',
                            toolbar: {
                                show: false
                            },
                            zoom: {
                                enabled: false
                            },
                        },
                        dataLabels: {
                            enabled: false
                        },
                        stroke: {
                            curve: 'smooth',
                            colors: ['#26CFE3']
                        },
                        xaxis: {
                            labels: {
                                show: false
                            },
                            axisBorder: {
                                show: false
                            },
                            axisTicks: {
                                show: false
                            },
                            tickAmount: 0,
                            categories: {{aylik_gelir.aylar | safe}}
                        },
                        yaxis: {
                            labels: {
                                show: false
                            },
                            axisBorder: {
                                show: false
                            },
                            axisTicks: {
                                show: false
                            },
                            tickAmount: 0
                        },
                        grid: {
                            show: false
                        }
                    };


                    var chart = new ApexCharts(document.querySelector("#stats-borc"), options);
                    chart.render();


                </script>


            </div>
        </div>
        <div class="register-card">
            <div class="register-card-title">
                {% if kasa %}
                    {{ kasa|length }}
                {% else %}
                    0
                {% endif %}
                <span>{% trans 'Kasa' %}</span>
            </div>
            <div class="register-card-registers">
            {% for i in kasa %}

                <div class="register-card-register"><i class="icon icon-register"></i> {{i.kasa_adi}} <span>$
                        {% kasa_toplam i %}</span></div>
            {% endfor %}
            </div>
        </div>                                     

      
    </div>
    {% if request.user.kullanicilar_db %}
     {% ozellikler request.user.kullanicilar_db as ozellikleri %}      
    {% else %}
    {% ozellikler hash_bilgi as ozellikleri %}                                            
    {% endif %}
    {% if request.user.is_authenticated %}
    {% if request.user.kullanicilar_db %}
     {% kategori_bilgi_ver request.user.kullanicilar_db as bilgi_cagir %}    
    {% else %}
    {% kategori_bilgi_ver hash_bilgi as bilgi_cagir %}                                           
    {% endif %}
        
        {% endif %}
    {% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.hesap_ekstra_gorme %}   
    <div class="large-cards">
        <div class="large-stats-card">
            <div class="stats-header">
                <div class="stats-title">{% trans 'Gelir - Gider Grafiği' %}</div>
                <div class="stats-period-dropdown">
                    <div class="stats-period">{% trans 'Aylık' %}</div>
                    <div class="stats-period-content">
                        <a href="#">{% trans 'Aylık' %}</a>
                        <a href="#">{% trans 'Yıllık' %}</a>
                    </div>
                </div>
            </div>
            <div id="gelirgider"></div>
        </div>
        <div class="large-stats-card expenses-by-category">
            <div class="stats-header">
    <div class="stats-title">{% trans 'Kategorilere Göre Giderler' %}</div>
   
</div>
            <div id="expenses-by-category"></div>
            <span>
                {% trans 'En yüksek değere sahip 10 kategori listelenmiştir.' %}
            </span>
            <div class="stats-footer">
                <div class="stats-footer-part">
                    <span>{% trans 'Kategori Sayısı' %}</span>
                    {{bilgi_cagir.isimleri | length}}
                </div>
                <div class="stats-footer-part">
                    <span>{% trans 'Toplam Gider' %}</span>
                    ${{bilgi_cagir.tutar}}
                </div>
            </div>
        </div>
    </div>
    
    <script>
        var options = {
            series: [{
                name: '{% trans "Gelir" %}',
                data: {{ozellikleri.gelir | safe }}
            }, {
                name: '{% trans "Gider" %}',
                data: {{ozellikleri.gider | safe }}
            }],
            chart: {
                height: 350,
                type: 'area',
                zoom: {
                    enabled: false
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth'
            },
            xaxis: {
                type: 'category',
                categories:  {{ozellikleri.aylar | safe }}
            },
            colors: ['#5FC396', '#FFAB00'],
            tooltip: {
                x: {
                    format: 'MMM'
                }
            }
        };

        var chart = new ApexCharts(document.querySelector("#gelirgider"), options);
        chart.render();




        // Örnek veriler
let seriesData = {{bilgi_cagir.a}}; // Gider değerleri
let labelsData = {{bilgi_cagir.isimleri |safe}}; // Gider kategorileri

// Giderleri sıralayıp en büyük 10'u seçiyoruz
let combinedData = seriesData.map((value, index) => ({ value, label: labelsData[index] }));
combinedData.sort((a, b) => b.value - a.value); // Büyükten küçüğe sıralama
let top10Data = combinedData.slice(0, 10);

// Yeni series ve labels oluşturuyoruz
let top10Series = top10Data.map(item => item.value);
let top10Labels = top10Data.map(item => item.label);

// ApexCharts için ayarlar
var options = {
    series: top10Series,
    labels: top10Labels,
    chart: {
        type: 'polarArea',
    },
    stroke: {
        colors: ['#fff']
    },
    fill: {
        opacity: 0.8
    },
    tooltip: {
        y: {
            formatter: function (value) {
                return value.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            }
        }
    },
};

var chart = new ApexCharts(document.querySelector("#expenses-by-category"), options);
chart.render();





    </script>                                                                                                     
{% endif %}
                                
{% else %}
           <div class="large-cards">
        <div class="large-stats-card">
            <div class="stats-header">
                <div class="stats-title">{% trans 'Gelir - Gider Grafiği' %}</div>
                <div class="stats-period-dropdown">
                    <div class="stats-period">{% trans 'Aylık' %}</div>
                    <div class="stats-period-content">
                        <a href="#">{% trans 'Aylık' %}</a>
                        <a href="#">{% trans 'Yıllık' %}</a>
                    </div>
                </div>
            </div>
            <div id="gelirgider"></div>
        </div>
        <div class="large-stats-card expenses-by-category">
           <div class="stats-header">
    <div class="stats-title">{% trans 'Kategorilere Göre Giderler' %}</div>
    
</div>
            <div id="expenses-by-category"></div>
            <span>
                {% trans 'En yüksek değere sahip 10 kategori listelenmiştir.' %}
            </span>
            <div class="stats-footer">
                <div class="stats-footer-part">
                    <span>{% trans 'Kategori Sayısı' %}</span>
                    {{bilgi_cagir.isimleri | length}}
                </div>
                <div class="stats-footer-part">
                    <span>{% trans 'Toplam Gider' %}</span>
                    ${{bilgi_cagir.tutar}}
                </div>
            </div>
        </div>
    </div>
    
    <script>
        var options = {
            series: [{
                name: '{% trans "Gelir" %}',
                data: {{ozellikleri.gelir | safe }}
            }, {
                name: '{% trans "Gider" %}',
                data: {{ozellikleri.gider | safe }}
            }],
            chart: {
                height: 350,
                type: 'area',
                zoom: {
                    enabled: false
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth'
            },
            xaxis: {
                type: 'category',
                categories:  {{ozellikleri.aylar | safe }}
            },
            colors: ['#5FC396', '#FFAB00'],
            tooltip: {
                x: {
                    format: 'MMM'
                }
            }
        };

        var chart = new ApexCharts(document.querySelector("#gelirgider"), options);
        chart.render();




       // Örnek veriler
let seriesData = {{bilgi_cagir.a}}; // Gider değerleri
let labelsData = {{bilgi_cagir.isimleri |safe}}; // Gider kategorileri

// Giderleri sıralayıp en büyük 10'u seçiyoruz
let combinedData = seriesData.map((value, index) => ({ value, label: labelsData[index] }));
combinedData.sort((a, b) => b.value - a.value); // Büyükten küçüğe sıralama
let top10Data = combinedData.slice(0, 10);

// Yeni series ve labels oluşturuyoruz
let top10Series = top10Data.map(item => item.value);
let top10Labels = top10Data.map(item => item.label);

// ApexCharts için ayarlar
var options = {
    series: top10Series,
    labels: top10Labels,
    chart: {
        type: 'polarArea',
    },
    stroke: {
        colors: ['#fff']
    },
    fill: {
        opacity: 0.8
    },
    tooltip: {
        y: {
            formatter: function (value) {
                return value.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            }
        }
    },
};

var chart = new ApexCharts(document.querySelector("#expenses-by-category"), options);
chart.render();





    </script>                                    
{% endif %}



    <div class="large-cards">
        {% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.gelir_ozeti_gorme %}      
<div class="large-cards-main-row">
            <div class="large-stats-card table-card">
                <div class="stats-header">
                    <div class="stats-title">{% trans 'Faturalar' %}</div>
                    <div class="stats-period-dropdown">
                        <div class="stats-period">{% trans 'Aylık' %}</div>
                        <div class="stats-period-content">
                            <a href="#">{% trans 'Aylık' %}</a>
                            <a href="#">{% trans 'Yıllık' %}</a>
                        </div>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table id="faturalar">
                        <thead>
                            <tr>
                                <th>{% trans 'Fatura No' %}</th>
                                <th>{% trans 'Ünvan' %}</th>
                                <th> {% trans 'Açıklama' %}</th>
                                <th>{% trans 'Fatura Tarihi' %}</th>
                                <th>{% trans 'Fatura Tutarı' %}</th>
                                <th>{% trans 'Kalan Tutarı' %}</th>
                                <th>{% trans 'Durum' %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in  bilgi %}
                            <tr>
                                {% toplam_odenme_tutari i as odeme %}
                                {% toplam_tutar_cikarmai i as tutar %}
                                <td><h5 class="fs-13 my-1"><a  href="/{{dil}}{% url 'accounting:fatura_goster2' i.id %}"  class="faturano-link">{{i.fatura_no}}</a>
                                </h5></td>
                                <td>{{i.cari_bilgisi.cari_adi}}</td>
                                <td>{{i.aciklama}}</td>
                                <td>{{i.fatura_tarihi| date:'d.m.Y'}} <span class="time"></span></td>
                                <td> {% toplam_tutar_cikarmai i as fiyat %} $ {% fiyat_duzelt_html fiyat %}</td>
                                <td>
                                    {% kalan_tutuari i as fiyat %}$ {% fiyat_duzelt_html fiyat %}
                                </td>
                                {% if  odeme == tutar %}
                                <td><span class="status-success">{% trans "Ödendi" %}</span></td>
                                {% elif odeme > 0 %}
                                <td><span class="status-pending">{% trans "Beklemede" %}</span></td>
                                {% elif odeme == 0 %}
                                <td><span class="status-cancel">{% trans "Ödenmedi" %}</span></td>
                                {% endif %}
                                
                                </tr>
                                {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="table-footer">
                    <a href="/{{dil}}{% url 'accounting:giderler_sayfasi'  %}">{% trans 'Tümünü Gör <i class="icon icon-chevron-right"></i>' %}</a>
                </div>

            </div>

            <div class="large-stats-card table-card">
                <div class="stats-header">
                    <div class="stats-title">{% trans 'Borç Faturaları' %}</div>
                    <div class="stats-period-dropdown">
                        <div class="stats-period">{% trans 'Aylık' %}</div>
                        <div class="stats-period-content">
                            <a href="#">{% trans 'Aylık' %}</a>
                            <a href="#">{% trans 'Yıllık' %}</a>
                        </div>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table id="borc-faturalar">
                        <thead>
                            <tr>
                                <th>{% trans 'Fatura No' %}</th>
                                <th>{% trans 'Ünvan' %}</th>
                                <th> {% trans 'Açıklama' %}</th>
                                <th>{% trans 'Fatura Tarihi' %}</th>
                                <th>{% trans 'Fatura Tutarı' %}</th>
                                <th>{% trans 'Kalan Tutarı' %}</th>
                                <th>{% trans 'Durum' %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in  gider  %}
                            <tr>
                                {% toplam_odenme_tutari i as odeme %}
                                {% toplam_tutar_cikarmai i as tutar %}
                                <td><h5 class="fs-13 my-1"><a  href="/{{dil}}{% url 'accounting:fatura_goster2' i.id %}"  class="faturano-link">{{i.fatura_no}}</a>
                                </h5></td>
                                <td>{{i.cari_bilgisi.cari_adi}}</td>
                                <td>{{i.aciklama}}</td>
                                <td>{{i.fatura_tarihi| date:'d.m.Y'}} <span class="time"></span></td>
                                <td>{% toplam_tutar_cikarmai i as fiyat %} ${% fiyat_duzelt_html fiyat %}</td>
                                <td>
                                    {% kalan_tutuari i as fiyat %} ${% fiyat_duzelt_html fiyat %}
                                </td>
                                {% if  odeme == tutar %}
                                <td><span class="status-success">{% trans "Ödendi" %}</span></td>
                                {% elif odeme > 0 %}
                                <td><span class="status-pending">{% trans "Beklemede" %}</span></td>
                                {% elif odeme == 0 %}
                                <td><span class="status-cancel">{% trans "Ödenmedi" %}</span></td>
                                {% endif %}
                                
                                </tr>
                                {% endfor %}

                        </tbody>
                    </table>
                </div>

                <div class="table-footer">
                <a href="/{{dil}}{% url 'accounting:giderler_sayfasi_borc'  %}">{% trans 'Tümünü Gör <i class="icon icon-chevron-right"></i>' %}</a>
                    
                </div>

            </div>

            <div class="large-stats-card table-card">
                <div class="stats-header">
                    <div class="stats-title">{% trans 'İş Emirleri' %}</div>
                    <div class="stats-period-dropdown">
                        <div class="stats-period">{% trans 'Tüm İş Emirleri' %}</div>
                        <div class="stats-period-content">
                            <a href="/{{dil}}{% url 'main:yapilacaklar' %}">{% trans 'Tüm İş Emirleri' %}</a>
                        </div>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table id="gorevler">
                        <thead>
                            <tr>
                                <th>{% trans 'İş Emri Adı' %}</th>
                                <th>{% trans 'Açıklama' %}</th>
                                
                                <th>{% trans 'Bitiş Tarihi' %}</th>
                                <th>{% trans 'Öncelik' %}</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for i in son_gorevler %}
                            <tr>
                                <td>{{i.title}}</td>
                                <td>{{i.aciklama}}</td>
                            
                                <td>{{i.teslim_tarihi|date:"d.m.Y"}}</td>
                                <td>
                                {% if i.oncelik_durumu == "High" %}
                                    <span class="status-danger">{{i.oncelik_durumu}}</span>
                                        {% elif i.oncelik_durumu == "Medium" %}
                                        
                                         <span class="status-warning">{{i.oncelik_durumu}}</span>
                                        {% elif i.oncelik_durumu == "Low" %}
                                        <span class="status-success">{{i.oncelik_durumu}}</span>
                                        {% endif %}</td>
                            </tr>
                            {% endfor %}
                            

                        </tbody>
                    </table>
                </div>


                <div class="table-footer">
                   <a href="/{{dil}}{% url 'main:yapilacaklar' %}">{% trans 'Tümünü Gör <i class="icon icon-chevron-right"></i>' %}</a> 
                </div>

            </div>
        </div>

        <script>
            let faturalar = new DataTable('#faturalar', {
                paging: false,
                searching: false,
                info: false,
                // responsive: true
            });

            let borcfaturalar = new DataTable('#borc-faturalar', {
                paging: false,
                searching: false,
                info: false,
                // responsive: true
            });

            let gorevler = new DataTable('#gorevler', {
                paging: false,
                searching: false,
                info: false,
                // responsive: true
            });
        </script>                                                                                                  
{% endif %}
                                
{% else %}
 <div class="large-cards-main-row">
            <div class="large-stats-card table-card">
                <div class="stats-header">
                    <div class="stats-title">{% trans 'Faturalar' %}</div>
                    <div class="stats-period-dropdown">
                        <div class="stats-period">{% trans 'Aylık' %}</div>
                        <div class="stats-period-content">
                            <a href="#">{% trans 'Aylık' %}</a>
                            <a href="#">{% trans 'Yıllık' %}</a>
                        </div>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table id="faturalar">
                        <thead>
                            <tr>
                                <th>{% trans 'Fatura No' %}</th>
                                <th>{% trans 'Ünvan' %}</th>
                                <th> {% trans 'Açıklama' %}</th>
                                <th>{% trans 'Fatura Tarihi' %}</th>
                                <th>{% trans 'Fatura Tutarı' %}</th>
                                <th>{% trans 'Kalan Tutarı' %}</th>
                                <th>{% trans 'Durum' %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in  bilgi %}
                            <tr>
                                {% toplam_odenme_tutari i as odeme %}
                                {% toplam_tutar_cikarmai i as tutar %}
                                <td><h5 class="fs-13 my-1"><a  href="/{{dil}}{% url 'accounting:fatura_goster2' i.id %}"  class="faturano-link">{{i.fatura_no}}</a>
                                </h5></td>
                                <td>{{i.cari_bilgisi.cari_adi}}</td>
                                <td>{{i.aciklama}}</td>
                                <td>{{i.fatura_tarihi| date:'d.m.Y'}} <span class="time"></span></td>
                                <td> {% toplam_tutar_cikarmai i as fiyat %} $ {% fiyat_duzelt_html fiyat %}</td>
                                <td>
                                    {% kalan_tutuari i as fiyat %}$ {% fiyat_duzelt_html fiyat %}
                                </td>
                                {% if  odeme == tutar %}
                                <td><span class="status-success">{% trans "Ödendi" %}</span></td>
                                {% elif odeme > 0 %}
                                <td><span class="status-pending">{% trans "Beklemede" %}</span></td>
                                {% elif odeme == 0 %}
                                <td><span class="status-cancel">{% trans "Ödenmedi" %}</span></td>
                                {% endif %}
                                
                                </tr>
                                {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="table-footer">
                    <a href="/{{dil}}{% url 'accounting:giderler_sayfasi_2' hashler %}">{% trans 'Tümünü Gör <i class="icon icon-chevron-right"></i>' %}</a>
                </div>

            </div>

            <div class="large-stats-card table-card">
                <div class="stats-header">
                    <div class="stats-title">{% trans 'Borç Faturaları' %}</div>
                    <div class="stats-period-dropdown">
                        <div class="stats-period">{% trans 'Aylık' %}</div>
                        <div class="stats-period-content">
                            <a href="#">{% trans 'Aylık' %}</a>
                            <a href="#">{% trans 'Yıllık' %}</a>
                        </div>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table id="borc-faturalar">
                        <thead>
                            <tr>
                                <th>{% trans 'Fatura No' %}</th>
                                <th>{% trans 'Ünvan' %}</th>
                                <th> {% trans 'Açıklama' %}</th>
                                <th>{% trans 'Fatura Tarihi' %}</th>
                                <th>{% trans 'Fatura Tutarı' %}</th>
                                <th>{% trans 'Kalan Tutarı' %}</th>
                                <th>{% trans 'Durum' %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in  gider  %}
                            <tr>
                                {% toplam_odenme_tutari i as odeme %}
                                {% toplam_tutar_cikarmai i as tutar %}
                                <td><h5 class="fs-13 my-1"><a  href="/{{dil}}{% url 'accounting:fatura_goster2' i.id %}"  class="faturano-link">{{i.fatura_no}}</a>
                                </h5></td>
                                <td>{{i.cari_bilgisi.cari_adi}}</td>
                                <td>{{i.aciklama}}</td>
                                <td>{{i.fatura_tarihi| date:'d.m.Y'}} <span class="time"></span></td>
                                <td>{% toplam_tutar_cikarmai i as fiyat %} ${% fiyat_duzelt_html fiyat %}</td>
                                <td>
                                    {% kalan_tutuari i as fiyat %} ${% fiyat_duzelt_html fiyat %}
                                </td>
                                {% if  odeme == tutar %}
                                <td><span class="status-success">{% trans "Ödendi" %}</span></td>
                                {% elif odeme > 0 %}
                                <td><span class="status-pending">{% trans "Beklemede" %}</span></td>
                                {% elif odeme == 0 %}
                                <td><span class="status-cancel">{% trans "Ödenmedi" %}</span></td>
                                {% endif %}
                                
                                </tr>
                                {% endfor %}

                        </tbody>
                    </table>
                </div>

                <div class="table-footer">
                <a href="/{{dil}}{% url 'accounting:giderler_sayfasi_borc_2' hashler %}">{% trans 'Tümünü Gör <i class="icon icon-chevron-right"></i>' %}</a>
                    
                </div>

            </div>

            <div class="large-stats-card table-card">
                <div class="stats-header">
                    <div class="stats-title">{% trans 'İş Emirleri' %}</div>
                    <div class="stats-period-dropdown">
                        <div class="stats-period">{% trans 'Tüm İş Emirleri' %}</div>
                        <div class="stats-period-content">
                            <a href="/{{dil}}{% url 'main:yapilacaklar' %}">{% trans 'Tüm İş Emirleri' %}</a>
                        </div>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table id="gorevler">
                        <thead>
                            <tr>
                                <th>{% trans 'Görev Adı' %}</th>
                                <th>{% trans 'Açıklama' %}</th>
                                
                                <th>{% trans 'Bitiş Tarihi' %}</th>
                                <th>{% trans 'Öncelik' %}</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for i in son_gorevler %}
                            <tr>
                                <td>{{i.title}}</td>
                                <td>{{i.aciklama}}</td>
                            
                                <td>{{i.teslim_tarihi|date:"d.m.Y"}}</td>
                                <td>
                                {% if i.oncelik_durumu == "High" %}
                                    <span class="status-danger">{{i.oncelik_durumu}}</span>
                                        {% elif i.oncelik_durumu == "Medium" %}
                                        
                                         <span class="status-warning">{{i.oncelik_durumu}}</span>
                                        {% elif i.oncelik_durumu == "Low" %}
                                        <span class="status-success">{{i.oncelik_durumu}}</span>
                                        {% endif %}</td>
                            </tr>
                            {% endfor %}
                            

                        </tbody>
                    </table>
                </div>


                <div class="table-footer">
                   <a href="/{{dil}}{% url 'main:yapilacaklar' %}">{% trans 'Tümünü Gör <i class="icon icon-chevron-right"></i>' %}</a> 
                </div>

            </div>
        </div>

        <script>
            let faturalar = new DataTable('#faturalar', {
                paging: false,
                searching: false,
                info: false,
                // responsive: true
            });

            let borcfaturalar = new DataTable('#borc-faturalar', {
                paging: false,
                searching: false,
                info: false,
                // responsive: true
            });

            let gorevler = new DataTable('#gorevler', {
                paging: false,
                searching: false,
                info: false,
                // responsive: true
            });
        </script>                                      
{% endif %}
        



        <div class="large-cards-second-row">

         <div class="card">
                <div class="stats-header">
                <div class="isemri-title">{% trans 'Aktif İş Emirleri' %}</div>
                </div>
                <div class="card-body">
                    <div class="building-container">
                                                <div class="building" id="building">
                                                    <div class="face" id="face1"><div class="roof">Kuzey</div></div>
                                                    <div class="face" id="face2"><div class="roof">Doğu</div></div>
                                                    <div class="face" id="face3"><div class="roof">Güney</div></div>
                                                    <div class="face" id="face4"><div class="roof">Batı</div></div>
                                                </div>
                    
                                                <!-- Mouse yanında çıkan mini modal -->
                                                <div id="infoModal" class="info-modal">
                                                    <span class="close-btn" onclick="closeInfoModal()">×</span>
                                                    <p id="modalText"></p>
                                                    <button class="action-btn" onclick="goToTask()">İş Emrine Git</button>
                                                </div>
                    </div>
                </div>
                    <div class="card-footer">
                       <a href="/{{dil}}{% url 'main:yapilacaklar' %}" class="card-show-all"> {% trans 'Tümünü Gör <i class="icon icon-forward"></i>' %}</a>
                    </div>
            </div>
<!-- Eski 3d bina bloğu
            <div class="card">
                <div class="cardbuild">
                            <div class="stats-header">
                                <div class="stats-title">
                                    {% trans 'Aktif İş Emirleri' %}
                                </div>
                            </div>
                                <div class="cardbuild-body">
                                            <div class="building-container">
                                                <div class="building" id="building">
                                                    <div class="face" id="face1"><div class="roof">Kuzey</div></div>
                                                    <div class="face" id="face2"><div class="roof">Doğu</div></div>
                                                    <div class="face" id="face3"><div class="roof">Güney</div></div>
                                                    <div class="face" id="face4"><div class="roof">Batı</div></div>
                                                </div>
                                            </div>
                                                <div id="infoModal" class="info-modal">
                                                    <span class="close-btn" onclick="closeInfoModal()">×</span>
                                                    <p id="modalText"></p>
                                                    <button class="action-btn" onclick="goToTask()">İş Emrine Git</button>
                                                </div>
                                    </div>
                </div>
            </div>-->
                            {% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.personeller_odeme_gorme %}  
<div class="card">
                <div class="card-header">
                    <div class="card-title">
                        {% if request.user.kullanicilar_db %}
                        {% dashboard_bilgisi request.user.kullanicilar_db as personelbilgi %}    
                        {% else %}
                        {% dashboard_bilgisi hash_bilgi as personelbilgi %}                                          
                        {% endif %}
                            
                            
                        {% trans 'Personeller' %}
                        <span>{% blocktrans with personel_sayisi=personelbilgi.personel_sayisi %}
                            Toplam {{ personel_sayisi }} personel
                        {% endblocktrans %}</span>
                    </div>
                    <a href="/{{dil}}{% url 'users:personeller_sayfasi' %}"><i class="icon icon-plus"></i></a>
                </div>
                
                <div class="card-body">
                {% for i in personelbilgi.personeller %}
                    <div class="employees">
                        <div class="employee">
                            <div class="employee-image"><img src="{{i.resim}}" alt=""></div>
                            <div class="employee-details">
                                {{i.isim_soyisim}}
                                <span>{{i.telefon_numarasi}}</span>
                            </div>
                            <div class="employee-stats">
                                <span>Ay / Çalışma Saati</span>
                                {{i.toplam_calisma_saati}}
                            </div>
                        </div>
                        
                    </div>
                     {% endfor %}
                    <div class="card-footer">
                       <a href="/{{dil}}{% url 'users:personeller_sayfasi' %}" class="card-show-all"> {% trans 'Tümünü Gör <i class="icon icon-forward"></i>' %}</a>
                    </div>
                </div>
               
            </div>                                                                                                      
{% endif %}
                                
{% else %}
    <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        {% if request.user.kullanicilar_db %}
                        {% dashboard_bilgisi request.user.kullanicilar_db as personelbilgi %}    
                        {% else %}
                        {% dashboard_bilgisi hash_bilgi as personelbilgi %}                                          
                        {% endif %}
                            
                            
                        {% trans 'Personeller' %}
                        <span>{% blocktrans with personel_sayisi=personelbilgi.personel_sayisi %}
                            Toplam {{ personel_sayisi }} personel
                        {% endblocktrans %}</span>
                    </div>
                    <a href="/{{dil}}{% url 'users:personeller_sayfasi' %}"><i class="icon icon-plus"></i></a>
                </div>
                
                <div class="card-body">
                {% for i in personelbilgi.personeller %}
                    <div class="employees">
                        <div class="employee">
                            <div class="employee-image"><img src="{{i.resim}}" alt=""></div>
                            <div class="employee-details">
                                {{i.isim_soyisim}}
                                <span>{{i.telefon_numarasi}}</span>
                            </div>
                            <div class="employee-stats">
                                <span>Ay / Çalışma Saati</span>
                                {{i.toplam_calisma_saati}}
                            </div>
                        </div>
                        
                    </div>
                     {% endfor %}
                    <div class="card-footer">
                       <a href="/{{dil}}{% url 'users:personeller_sayfasi' %}" class="card-show-all"> {% trans 'Tümünü Gör <i class="icon icon-forward"></i>' %}</a>
                    </div>
                </div>
               
            </div>                                    
{% endif %}
           {% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.santiye_gorme %}   
<div class="info-card">
                <div class="info-card-image">
                    <img src="{% static 'go/images/info-card-1.png' %}" alt="Aktif Şantiye Sayısı">
                </div>
                <div class="info-card-content">
                {% blocktrans with aktif_santiye=personelbilgi.aktif_santiye %}
                        {{ aktif_santiye }} <span>Aktif Şantiye Sayısı</span>
                        {% endblocktrans %}
                
                    
                </div>
            </div>                                                                                                     
{% endif %}
                                
{% else %}
     <div class="info-card">
                <div class="info-card-image">
                    <img src="{% static 'go/images/info-card-1.png' %}" alt="Aktif Şantiye Sayısı">
                </div>
                <div class="info-card-content">
                {% blocktrans with aktif_santiye=personelbilgi.aktif_santiye %}
                        {{ aktif_santiye }} <span>Aktif Şantiye Sayısı</span>
                        {% endblocktrans %}
                
                    
                </div>
            </div>                                     
{% endif %}

     {% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.personeller_gorme %} 
            <div class="info-card">
                <div class="info-card-image">
                    <img src="{% static 'go/images/info-card-2.png' %}" alt="Aktif Personel Sayısı">
                </div>
                <div class="info-card-content">
                {% blocktrans with personel_sayisi=personelbilgi.personel_sayisi %}
                        {{ personel_sayisi }} <span>Aktif Personel Sayısı</span>
                        {% endblocktrans %}
                   
                </div>
            </div>                                                                                                       
{% endif %}
                                
{% else %}
                   <div class="info-card">
                <div class="info-card-image">
                    <img src="{% static 'go/images/info-card-2.png' %}" alt="Aktif Personel Sayısı">
                </div>
                <div class="info-card-content">
                {% blocktrans with personel_sayisi=personelbilgi.personel_sayisi %}
                        {{ personel_sayisi }} <span>Aktif Personel Sayısı</span>
                        {% endblocktrans %}
                   
                </div>
            </div>                                    
{% endif %}    
{% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.projeler_gorme %}  
<div class="info-card">
                <div class="info-card-image">
                    <img src="{% static 'go/images/info-card-3.png' %}" alt="Aktif Proje Sayısı">
                </div>
                <div class="info-card-content">
                {% blocktrans with aktif_proje=personelbilgi.aktif_proje %}
                        {{ aktif_proje }} <span>Aktif Proje Sayısı</span>
                        {% endblocktrans %}
                    
                </div>
            </div>                                                                                                      
{% endif %}
                                
{% else %}
    <div class="info-card">
                <div class="info-card-image">
                    <img src="{% static 'go/images/info-card-3.png' %}" alt="Aktif Proje Sayısı">
                </div>
                <div class="info-card-content">
                {% blocktrans with aktif_proje=personelbilgi.aktif_proje %}
                        {{ aktif_proje }} <span>Aktif Proje Sayısı</span>
                        {% endblocktrans %}
                    
                </div>
            </div>                                     
{% endif %}


          

        </div>

    </div>



</main>
{% else %} 

    <main>

        <div class="quick-actions">
            <div class="quick-actions-header">
                <div class="quick-actions-title">{% trans 'Hızlı Menü' %}</div>
                <div class="quick-actions-right">
                    <button class="quick-actions-add" onclick="showHiddenActions()">
                        <i class="icon icon-add"></i> {% trans 'Gizli Öğeler' %}
                    </button>
                    <div class="quick-actions-toggle">
                        <i class="icon icon-arrow-circle-up"></i>
                        <i class="icon icon-arrow-circle-down"></i>
                    </div>
                </div>
            </div>
            <div class="quick-actions-body close">
                <div class="quick-actions-inner">
                    <div class="quick-actions-grid" id="quick-actions-grid">
                        <a href="/{{dil}}{% url 'main:santiye_kalem_ve_blog' %}" class="quick-action" data-id="1" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-document"></i> {% trans 'Raporlar' %}</a>
                        <a href="/{{dil}}{% url 'main:santiye_kalem_ve_blog'  %}" class="quick-action" data-id="2" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-ilerleme-takibi"></i>{% trans 'İlerleme Takibi' %} </a>
                        <a href="/{{dil}}{% url 'accounting:giderler_ozeti' %}" class="quick-action" data-id="3" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-giderler"></i> {% trans 'Giderler' %}</a>
                        <a href="/{{dil}}{% url 'accounting:gelirler_ozeti' %}" class="quick-action" data-id="4" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-gelirler"></i>{% trans 'Gelirler' %} </a>
                        <a href="/{{dil}}{% url 'accounting:giderler_sayfasi_borc'  %}" class="quick-action" data-id="5" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-muhasebe"></i>{% trans 'Borçlar' %} </a>
                        <a href="/{{dil}}{% url 'users:personeller_puantaj_sayfasi'  %}" class="quick-action" data-id="6" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-puantaj-girisi"></i>{% trans 'Puantaj Girişi' %}</a>
                        <a href="/{{dil}}{% url 'accounting:satin_alma_talabi' %}" class="quick-action" data-id="7" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-satin-alma"></i>{% trans 'Satın Alma' %}</a>
                        <a href="/{{dil}}{% url 'users:personeller_sayfasi'  %}" class="quick-action" data-id="8" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-yeni-personel"></i>{% trans 'Personel Ekle' %} </a>
                        <a href="/{{dil}}{% url 'users:kullanicilarim'  %}" class="quick-action" data-id="9" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-yeni-kullanici"></i> {% trans 'Kullanıcı Ekle' %}</a>
                        <a href="/{{dil}}{% url 'main:depolama_sistemim' %}" class="quick-action" data-id="10" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-dosya-yoneticisi"></i>{% trans 'Dosya Yöneticisi' %} </a>
                        <a href="/{{dil}}{% url 'main:taseron_sayfasi'  %}" class="quick-action" data-id="11" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-taseronlar"></i> {% trans 'Taşeronlar' %}</a>
                        <a href="/{{dil}}{% url 'main:sozlesmler_sayfasi'  %}"  class="quick-action" data-id="12" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-sozlesmeler"></i> {% trans 'Sözleşmeler' %}</a>
                        <a href="/{{dil}}{% url 'main:hakedis_sayfasi'  %}" class="quick-action" data-id="13" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-hakedisler"></i> {% trans 'Hakedişler' %}</a>
                        <a href="/{{dil}}{% url 'main:yapilacaklar'  %}" class="quick-action" data-id="14" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-gorevler"></i> {% trans 'İş Emirleri' %}</a>
                        <a href="/{{dil}}{% url 'accounting:kasa'  %}" class="quick-action" data-id="15" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-kasa"></i> {% trans 'Kasa' %}</a>
                        <a href="/{{dil}}{% url 'accounting:cari'  %}" class="quick-action" data-id="16" oncontextmenu="hideQuickLink(event, this)"><i
                                class="icon icon-users"></i> {% trans 'Cari Hesapları' %}</a>
                    </div>
                </div>
            </div>
        </div>


        <div class="quick-action-modal " id="hiddenLinksModal">
            <div class="quick-action-modal-content">
                <div class="quick-action-modal-header">
                    <span>{% trans 'Gizli Öğeler' %}</span>
                    <button onclick="hideHiddenActions()"><i class="icon icon-close"></i></button>
                </div>
                <div class="quick-actions-grid modal-body">
                </div>
            </div>
        </div>

        <script>

            const hiddenLinksModalBody = document.querySelector('#hiddenLinksModal .modal-body');
            document.addEventListener('DOMContentLoaded', function () {
                const quickLinks = document.getElementById('quick-actions-grid');
                const hiddenLinksModalBody = document.querySelector('#hiddenLinksModal .modal-body');

                // Hızlı linkleri sürükle-bırak düzenleme
                new Sortable(quickLinks, {
                    animation: 150,
                    handle: '.quick-action',
                    onEnd: function (evt) {
                        const items = Array.from(quickLinks.children);
                        const order = items.map(item => item.dataset.id);
                        sessionStorage.setItem('quickLinksOrder', JSON.stringify(order));
                    }
                });


                // Gizli linkleri modalda geri getirme
                hiddenLinksModalBody.addEventListener('click', function (event) {
                    const link = event.target.closest('.hidden-link');
                    if (link) {
                        const id = link.dataset.id;
                        const hiddenItem = document.querySelector(`[data-id="${id}"]`);
                        if (hiddenItem) {
                            hiddenItem.style.display = "flex"; // Linki geri görünür yap
                            quickLinks.appendChild(hiddenItem); // Sayfaya geri ekle
                            link.remove(); // Modaldan kaldır
                            saveHiddenLinks(); // Gizli linklerin durumunu kaydet
                        }
                    }
                });

                // Oturum açıldığında kullanıcı düzenini yükle
                const savedQuickLinksOrder = JSON.parse(sessionStorage.getItem('quickLinksOrder'));
                if (savedQuickLinksOrder) {
                    savedQuickLinksOrder.forEach(id => {
                        const item = quickLinks.querySelector(`[data-id='${id}']`);
                        if (item) {
                            quickLinks.appendChild(item);
                        }
                    });
                }

                // Gizli linklerin durumunu kaydet
                function saveHiddenLinks() {
                    const hiddenLinks = Array.from(hiddenLinksModalBody.querySelectorAll('.hidden-link')).map(link => link.dataset.id);
                    sessionStorage.setItem('hiddenLinks', JSON.stringify(hiddenLinks));
                }

                // Gizli linkleri yükleme
                function loadHiddenLinks() {
                    const hiddenLinks = JSON.parse(sessionStorage.getItem('hiddenLinks'));
                    if (hiddenLinks) {
                        hiddenLinks.forEach(id => {
                            const item = quickLinks.querySelector(`[data-id='${id}']`);
                            if (item) {
                                item.style.display = "none"; // Linki gizle
                                const hiddenLink = document.createElement('div');
                                hiddenLink.className = 'hidden-link';
                                hiddenLink.dataset.id = id;
                                hiddenLink.innerHTML = item.innerHTML;
                                hiddenLinksModalBody.appendChild(hiddenLink);
                            }
                        });
                    }
                }

                loadHiddenLinks(); // Gizli linkleri sayfa yüklendiğinde çağır
            });

            // Gizli linklerin durumunu kaydet
            function saveHiddenLinks() {
                const hiddenLinks = Array.from(hiddenLinksModalBody.querySelectorAll('.hidden-link')).map(link => link.dataset.id);
                sessionStorage.setItem('hiddenLinks', JSON.stringify(hiddenLinks));
            }

            // Hızlı linki gizleme
            function hideQuickLink(event, element) {
                event.preventDefault();
                const id = element.dataset.id;
                element.style.display = "none"; // Sayfadan gizle
                const hiddenLink = document.createElement('div');
                hiddenLink.className = 'hidden-link';
                hiddenLink.dataset.id = id;
                hiddenLink.innerHTML = element.innerHTML;
                document.querySelector('#hiddenLinksModal .modal-body').appendChild(hiddenLink);
                saveHiddenLinks(); // Gizli linklerin durumunu kaydet
            }

            function showHiddenActions() {
                $(".quick-action-modal").css("display", "flex").hide().fadeIn();
            }

            function hideHiddenActions() {
                $(".quick-action-modal").fadeOut();
            }

            let quickActionModal = document.querySelector(".quick-action-modal");
            $(".quick-action-modal").on("click", function (e) {
                if (e.target == quickActionModal) {
                    hideHiddenActions();
                }
            })

            let quickActionsToggle = document.querySelector(".quick-actions-toggle");
            let quickActionsBody = document.querySelector(".quick-actions-body");

            quickActionsToggle.addEventListener("click", function () {
                quickActionsBody.classList.toggle("open");
            });







        </script>



        <div class="main-cards">
            <div class="profile-card">
                <div class="profile-avatar-dash">
                {% if request.user.image %}
                        <img src="{{request.user.image.url}}" style="max-width: 80px; max-height: 80px;" alt="Profile">

                        {% else %}
                        <img src="{% static 'go/images/profile.png' %}" alt="Profile">
                        {% endif %}
                    
                </div>
                <div class="profile-info">
                    <div class="profile-title">{{request.user.last_name}} <span> {% if request.user.gorevi %}
                        {{request.user.gorevi}}
                    {% else %}
                    {% endif %} </span></div>
                    <div class="profile-date"><i class="icon icon-calendar"></i> 

  <span id="day-name"> </span><span id="fds">-</span>
  <span id="full-date"></span>
</div>
                    
                </div>
            </div>
            {% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.gelir_ozeti_gorme %}
           <div class="stats-card">
                <div class="stats-title">{% trans 'GELİR' %}</div>
                {% if request.user.kullanicilar_db %}
                {% gelirler_tutari request.user.kullanicilar_db as gelir_bilgisi_cek %}
                {% else %}
                {% gelirler_tutari request.user as gelir_bilgisi_cek %}
                {% endif %}
                <div class="stats-content">
                    <div class="stats-value"> $ {{gelir_bilgisi_cek.tutar}}</div>
                    <div class="stats-rease">

                        {% if request.user.kullanicilar_db %}
                        {% gelir_yuzde_farki request.user.kullanicilar_db  as gelirhaftafarki %}
                        {% else %}
                        {% gelir_yuzde_farki request.user as gelirhaftafarki %}
                        {% endif %}
                        {% if request.user.kullanicilar_db %}
                        {% son_dort_ay_tutar request.user.kullanicilar_db  as aylik_gelir %}
                        {% else %}
                        {% son_dort_ay_tutar request.user as aylik_gelir %}
                        {% endif %}
                        {% if gelirhaftafarki.arti  %}
                    <div class="stats-rease-icon"><i class="icon icon-increment"></i></div>
                    {% blocktrans with fark=gelirhaftafarki.fark %}
                        <b>{{ fark }}%</b> haftalık değişim
                    {% endblocktrans %}
                </div>
                {% else %}
                    <div class="stats-rease-icon"><i class="icon icon-decrement"></i></div>
                    {% blocktrans with fark=gelirhaftafarki.fark %}
                        <b>{{ fark }}%</b> haftalık değişim
                    {% endblocktrans %}
                </div>
                {% endif %}

                        
                </div>
                <div class="stats-img">


                    <div id="stats-gelir"></div>

                    <script>
                        var options = {
                            series: [{
                                name: "{% trans 'Gelir' %}",
                                data: {{aylik_gelir.tutarlar | safe}}
                            }],
                            chart: {
                                width: 120,
                                height: 120,
                                type: 'line',
                                toolbar: {
                                    show: false
                                },
                                zoom: {
                                    enabled: false
                                },
                            },
                            dataLabels: {
                                enabled: false
                            },
                            stroke: {
                                curve: 'smooth',
                                colors: ['#22B076']
                            },
                            xaxis: {
                                labels: {
                                    show: false
                                },
                                axisBorder: {
                                    show: false
                                },
                                axisTicks: {
                                    show: false
                                },
                                tickAmount: 0,
                                categories: {{aylik_gelir.aylar | safe}}
                            },
                            yaxis: {
                                labels: {
                                    show: false
                                },
                                axisBorder: {
                                    show: false
                                },
                                axisTicks: {
                                    show: false
                                },
                                tickAmount: 0
                            },
                            grid: {
                                show: false
                            }
                        };


                        var chart = new ApexCharts(document.querySelector("#stats-gelir"), options);
                        chart.render();


                    </script>




                </div>
            </div>                                     
                                                                                                        
{% endif %}
{% if yetki.gider_ozeti_gorme %}  
<div class="stats-card">
                <div class="stats-title">{% trans 'GİDER' %}</div>
                {% if request.user.kullanicilar_db %}
                {% giderler_tutari request.user.kullanicilar_db  as gider_bilgisicekeme %}
                {% else %}
                {% giderler_tutari request.user  as gider_bilgisicekeme %}
                {% endif %}
                <div class="stats-content">
                    <div class="stats-value">$ {{gider_bilgisicekeme.genel_odeme2}}</div>
                    <div class="stats-rease">
                    {% if request.user.kullanicilar_db %}
                        {% gider_yuzde_farki request.user.kullanicilar_db  as gelirhaftafarki %}
                        {% else %}
                        {% gider_yuzde_farki request.user as gelirhaftafarki %}
                        {% endif %}
                        {% if request.user.kullanicilar_db %}
                        {% son_dort_ay_tutar_gider request.user.kullanicilar_db  as aylik_gelir %}
                        {% else %}
                        {% son_dort_ay_tutar_gider request.user as aylik_gelir %}
                        {% endif %}
                        {% if gelirhaftafarki.arti  %}
                    <div class="stats-rease-icon"><i class="icon icon-increment"></i></div>
                    {% blocktrans with fark=gelirhaftafarki.fark %}
                        <b>{{ fark }}%</b> haftalık değişim
                    {% endblocktrans %}
                </div>
                {% else %}
                    <div class="stats-rease-icon"><i class="icon icon-decrement"></i></div>
                    {% blocktrans with fark=gelirhaftafarki.fark %}
                        <b>{{ fark }}%</b> haftalık değişim
                    {% endblocktrans %}
                </div>
                {% endif %}
                        
                </div>
                <div class="stats-img">

                    <div id="stats-gider"></div>

                    <script>
                        var options = {
                            series: [{
                                name: "{% trans 'Gider' %}",
                                data: {{aylik_gelir.tutarlar | safe}}
                            }],
                            chart: {
                                width: 120,
                                height: 120,
                                type: 'line',
                                toolbar: {
                                    show: false
                                },
                                zoom: {
                                    enabled: false
                                },
                            },
                            dataLabels: {
                                enabled: false
                            },
                            stroke: {
                                curve: 'smooth',
                                colors: ['#26CFE3']
                            },
                            xaxis: {
                                labels: {
                                    show: false
                                },
                                axisBorder: {
                                    show: false
                                },
                                axisTicks: {
                                    show: false
                                },
                                tickAmount: 0,
                                categories: {{aylik_gelir.aylar | safe}}
                            },
                            yaxis: {
                                labels: {
                                    show: false
                                },
                                axisBorder: {
                                    show: false
                                },
                                axisTicks: {
                                    show: false
                                },
                                tickAmount: 0
                            },
                            grid: {
                                show: false
                            }
                        };


                        var chart = new ApexCharts(document.querySelector("#stats-gider"), options);
                        chart.render();


                    </script>


                </div>
            </div>                                                      
{% endif %}
{% if yetki.hesap_ekstra_gorme %}
       <div class="stats-card">
                <div class="stats-title">{% trans 'BORÇ' %}</div>
                {% basit_cikarma  gelir_bilgisi_cek.tutar gelir_bilgisi_cek.genel_odeme as gelir_islem_sonucu  %}
                                                    {% basit_cikarma  gider_bilgisicekeme.tutar gider_bilgisicekeme.genel_odeme as gider_islem_sonucu  %}
                                                    {% basit_cikarma  gelir_islem_sonucu gider_islem_sonucu as sonuc_Bilgisi  %}
                <div class="stats-content">
                    <div class="stats-value">${% mutlak_deger  sonuc_Bilgisi %}</div>
                    <div class="stats-rease">
                        {% if request.user.kullanicilar_db %}
                        {% borc_yuzde_farki request.user.kullanicilar_db  as gelirhaftafarki %}
                        {% else %}
                        {% borc_yuzde_farki request.user as gelirhaftafarki %}
                        {% endif %}
                        {% if request.user.kullanicilar_db %}
                        {% borc_son_dort_ay_tutar request.user.kullanicilar_db  as aylik_gelir %}
                        {% else %}
                        {% borc_son_dort_ay_tutar request.user as aylik_gelir %}
                        {% endif %}
                        {% if gelirhaftafarki.arti  %}
                    <div class="stats-rease-icon"><i class="icon icon-increment"></i></div>
                    {% blocktrans with fark=gelirhaftafarki.fark %}
                        <b>{{ fark }}%</b> haftalık değişim
                    {% endblocktrans %}
                </div>
                {% else %}
                    <div class="stats-rease-icon"><i class="icon icon-decrement"></i></div>
                    {% blocktrans with fark=gelirhaftafarki.fark %}
                        <b>{{ fark }}%</b> haftalık değişim
                    {% endblocktrans %}
                </div>
                {% endif %}
                </div>
                <div class="stats-img">

                    <div id="stats-borc"></div>

                    <script>
                        var options = {
                            series: [{
                                name: "{% trans 'Borç' %}",
                                data: {{aylik_gelir.tutarlar | safe}}
                            }],
                            chart: {
                                width: 120,
                                height: 120,
                                type: 'line',
                                toolbar: {
                                    show: false
                                },
                                zoom: {
                                    enabled: false
                                },
                            },
                            dataLabels: {
                                enabled: false
                            },
                            stroke: {
                                curve: 'smooth',
                                colors: ['#26CFE3']
                            },
                            xaxis: {
                                labels: {
                                    show: false
                                },
                                axisBorder: {
                                    show: false
                                },
                                axisTicks: {
                                    show: false
                                },
                                tickAmount: 0,
                                categories: {{aylik_gelir.aylar | safe}}
                            },
                            yaxis: {
                                labels: {
                                    show: false
                                },
                                axisBorder: {
                                    show: false
                                },
                                axisTicks: {
                                    show: false
                                },
                                tickAmount: 0
                            },
                            grid: {
                                show: false
                            }
                        };


                        var chart = new ApexCharts(document.querySelector("#stats-borc"), options);
                        chart.render();


                    </script>


                </div>
            </div>                                                                                                                                              
{% endif %}
{% if yetki.kasa_detay_izni %}
         <div class="register-card">
                <div class="register-card-title">
                    {% if kasa %}
                        {{ kasa|length }}
                    {% else %}
                        0
                    {% endif %}
                    <span>{% trans 'Kasa' %}</span>
                </div>
                <div class="register-card-registers">
                {% for i in kasa %}

                    <div class="register-card-register"><i class="icon icon-register"></i> {{i.kasa_adi}} <span>$
                            {% kasa_toplam i %}</span></div>
                {% endfor %}
                </div>
            </div>                                                                                                                                             
{% endif %}
                                    
{% else %}
        <div class="stats-card">
                <div class="stats-title">{% trans 'GELİR' %}</div>
                {% if request.user.kullanicilar_db %}
                {% gelirler_tutari request.user.kullanicilar_db as gelir_bilgisi_cek %}
                {% else %}
                {% gelirler_tutari request.user as gelir_bilgisi_cek %}
                {% endif %}
                <div class="stats-content">
                    <div class="stats-value"> $ {{gelir_bilgisi_cek.tutar}}</div>
                    <div class="stats-rease">

                        {% if request.user.kullanicilar_db %}
                        {% gelir_yuzde_farki request.user.kullanicilar_db  as gelirhaftafarki %}
                        {% else %}
                        {% gelir_yuzde_farki request.user as gelirhaftafarki %}
                        {% endif %}
                        {% if request.user.kullanicilar_db %}
                        {% son_dort_ay_tutar request.user.kullanicilar_db  as aylik_gelir %}
                        {% else %}
                        {% son_dort_ay_tutar request.user as aylik_gelir %}
                        {% endif %}
                        {% if gelirhaftafarki.arti  %}
                    <div class="stats-rease-icon"><i class="icon icon-increment"></i></div>
                    {% blocktrans with fark=gelirhaftafarki.fark %}
                        <b>{{ fark }}%</b> haftalık değişim
                    {% endblocktrans %}
                </div>
                {% else %}
                    <div class="stats-rease-icon"><i class="icon icon-decrement"></i></div>
                    {% blocktrans with fark=gelirhaftafarki.fark %}
                        <b>{{ fark }}%</b> haftalık değişim
                    {% endblocktrans %}
                </div>
                {% endif %}

                        
                </div>
                <div class="stats-img">


                    <div id="stats-gelir"></div>

                    <script>
                        var options = {
                            series: [{
                                name: "{% trans 'Gelir' %}",
                                data: {{aylik_gelir.tutarlar | safe}}
                            }],
                            chart: {
                                width: 120,
                                height: 120,
                                type: 'line',
                                toolbar: {
                                    show: false
                                },
                                zoom: {
                                    enabled: false
                                },
                            },
                            dataLabels: {
                                enabled: false
                            },
                            stroke: {
                                curve: 'smooth',
                                colors: ['#22B076']
                            },
                            xaxis: {
                                labels: {
                                    show: false
                                },
                                axisBorder: {
                                    show: false
                                },
                                axisTicks: {
                                    show: false
                                },
                                tickAmount: 0,
                                categories: {{aylik_gelir.aylar | safe}}
                            },
                            yaxis: {
                                labels: {
                                    show: false
                                },
                                axisBorder: {
                                    show: false
                                },
                                axisTicks: {
                                    show: false
                                },
                                tickAmount: 0
                            },
                            grid: {
                                show: false
                            }
                        };


                        var chart = new ApexCharts(document.querySelector("#stats-gelir"), options);
                        chart.render();


                    </script>




                </div>
            </div>
            <div class="stats-card">
                <div class="stats-title">{% trans 'GİDER' %}</div>
                {% if request.user.kullanicilar_db %}
                {% giderler_tutari request.user.kullanicilar_db  as gider_bilgisicekeme %}
                {% else %}
                {% giderler_tutari request.user  as gider_bilgisicekeme %}
                {% endif %}
                <div class="stats-content">
                    <div class="stats-value">$ {{gider_bilgisicekeme.genel_odeme2}}</div>
                    <div class="stats-rease">
                    {% if request.user.kullanicilar_db %}
                        {% gider_yuzde_farki request.user.kullanicilar_db  as gelirhaftafarki %}
                        {% else %}
                        {% gider_yuzde_farki request.user as gelirhaftafarki %}
                        {% endif %}
                        {% if request.user.kullanicilar_db %}
                        {% son_dort_ay_tutar_gider request.user.kullanicilar_db  as aylik_gelir %}
                        {% else %}
                        {% son_dort_ay_tutar_gider request.user as aylik_gelir %}
                        {% endif %}
                        {% if gelirhaftafarki.arti  %}
                    <div class="stats-rease-icon"><i class="icon icon-increment"></i></div>
                    {% blocktrans with fark=gelirhaftafarki.fark %}
                        <b>{{ fark }}%</b> haftalık değişim
                    {% endblocktrans %}
                </div>
                {% else %}
                    <div class="stats-rease-icon"><i class="icon icon-decrement"></i></div>
                    {% blocktrans with fark=gelirhaftafarki.fark %}
                        <b>{{ fark }}%</b> haftalık değişim
                    {% endblocktrans %}
                </div>
                {% endif %}
                        
                </div>
                <div class="stats-img">

                    <div id="stats-gider"></div>

                    <script>
                        var options = {
                            series: [{
                                name: "{% trans 'Gider' %}",
                                data: {{aylik_gelir.tutarlar | safe}}
                            }],
                            chart: {
                                width: 120,
                                height: 120,
                                type: 'line',
                                toolbar: {
                                    show: false
                                },
                                zoom: {
                                    enabled: false
                                },
                            },
                            dataLabels: {
                                enabled: false
                            },
                            stroke: {
                                curve: 'smooth',
                                colors: ['#26CFE3']
                            },
                            xaxis: {
                                labels: {
                                    show: false
                                },
                                axisBorder: {
                                    show: false
                                },
                                axisTicks: {
                                    show: false
                                },
                                tickAmount: 0,
                                categories: {{aylik_gelir.aylar | safe}}
                            },
                            yaxis: {
                                labels: {
                                    show: false
                                },
                                axisBorder: {
                                    show: false
                                },
                                axisTicks: {
                                    show: false
                                },
                                tickAmount: 0
                            },
                            grid: {
                                show: false
                            }
                        };


                        var chart = new ApexCharts(document.querySelector("#stats-gider"), options);
                        chart.render();


                    </script>


                </div>
            </div>
            <div class="weather-card">
                <div class="weather-location">
                {{sehir}}
                <span id="day-names"></span>
                <span id="time-date"></span>
                </div>
                <div class="weather-content">
                    <div class="weather-wind">
                        <span>{{weather_data.wind.speed}} km/s</span>
                        <div class="wind-direction" style="transform: rotate({{weather_data.wind.deg}}deg);">
                            <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L15 8H9L12 2ZM12 22V8" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="weather-temp">
                        <span>{{weather_data.main.temp |stringformat:'.f'}}°</span>
                        <img src="http://openweathermap.org/img/wn/{{icon}}@2x.png" alt="">
                    </div>
                </div>
            </div>
            <div class="stats-card">
                <div class="stats-title">{% trans 'BORÇ' %}</div>
                {% basit_cikarma  gelir_bilgisi_cek.tutar gelir_bilgisi_cek.genel_odeme as gelir_islem_sonucu  %}
                                                    {% basit_cikarma  gider_bilgisicekeme.tutar gider_bilgisicekeme.genel_odeme as gider_islem_sonucu  %}
                                                    {% basit_cikarma  gelir_islem_sonucu gider_islem_sonucu as sonuc_Bilgisi  %}
                <div class="stats-content">
                    <div class="stats-value">${% mutlak_deger  sonuc_Bilgisi %}</div>
                    <div class="stats-rease">
                        {% if request.user.kullanicilar_db %}
                        {% borc_yuzde_farki request.user.kullanicilar_db  as gelirhaftafarki %}
                        {% else %}
                        {% borc_yuzde_farki request.user as gelirhaftafarki %}
                        {% endif %}
                        {% if request.user.kullanicilar_db %}
                        {% borc_son_dort_ay_tutar request.user.kullanicilar_db  as aylik_gelir %}
                        {% else %}
                        {% borc_son_dort_ay_tutar request.user as aylik_gelir %}
                        {% endif %}
                        {% if gelirhaftafarki.arti  %}
                    <div class="stats-rease-icon"><i class="icon icon-increment"></i></div>
                    {% blocktrans with fark=gelirhaftafarki.fark %}
                        <b>{{ fark }}%</b> haftalık değişim
                    {% endblocktrans %}
                </div>
                {% else %}
                    <div class="stats-rease-icon"><i class="icon icon-decrement"></i></div>
                    {% blocktrans with fark=gelirhaftafarki.fark %}
                        <b>{{ fark }}%</b> haftalık değişim
                    {% endblocktrans %}
                </div>
                {% endif %}
                </div>
                <div class="stats-img">

                    <div id="stats-borc"></div>

                    <script>
                        var options = {
                            series: [{
                                name: "{% trans 'Borç' %}",
                                data: {{aylik_gelir.tutarlar | safe}}
                            }],
                            chart: {
                                width: 120,
                                height: 120,
                                type: 'line',
                                toolbar: {
                                    show: false
                                },
                                zoom: {
                                    enabled: false
                                },
                            },
                            dataLabels: {
                                enabled: false
                            },
                            stroke: {
                                curve: 'smooth',
                                colors: ['#26CFE3']
                            },
                            xaxis: {
                                labels: {
                                    show: false
                                },
                                axisBorder: {
                                    show: false
                                },
                                axisTicks: {
                                    show: false
                                },
                                tickAmount: 0,
                                categories: {{aylik_gelir.aylar | safe}}
                            },
                            yaxis: {
                                labels: {
                                    show: false
                                },
                                axisBorder: {
                                    show: false
                                },
                                axisTicks: {
                                    show: false
                                },
                                tickAmount: 0
                            },
                            grid: {
                                show: false
                            }
                        };


                        var chart = new ApexCharts(document.querySelector("#stats-borc"), options);
                        chart.render();


                    </script>


                </div>
            </div>
            <div class="register-card">
                <div class="register-card-title">
                    {% if kasa %}
                        {{ kasa|length }}
                    {% else %}
                        0
                    {% endif %}
                    <span>{% trans 'Kasa' %}</span>
                </div>
                <div class="register-card-registers">
                {% for i in kasa %}

                    <div class="register-card-register"><i class="icon icon-register"></i> {{i.kasa_adi}} <span>$
                            {% kasa_toplam i %}</span></div>
                {% endfor %}
                </div>
            </div>                                     
{% endif %}
          
        </div>
        {% if request.user.kullanicilar_db %}
         {% ozellikler request.user.kullanicilar_db as ozellikleri %}      
        {% else %}
        {% ozellikler request.user as ozellikleri %}                                            
        {% endif %}
        {% if request.user.is_authenticated %}
        {% if request.user.kullanicilar_db %}
         {% kategori_bilgi_ver request.user.kullanicilar_db as bilgi_cagir %}    
        {% else %}
        {% kategori_bilgi_ver request.user as bilgi_cagir %}                                           
        {% endif %}
            
            {% endif %}
        {% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.hesap_ekstra_gorme %}   
        <div class="large-cards">
            <div class="large-stats-card">
                <div class="stats-header">
                    <div class="stats-title">{% trans 'Gelir - Gider Grafiği' %}</div>
                    <div class="stats-period-dropdown">
                        <div class="stats-period">{% trans 'Aylık' %}</div>
                        <div class="stats-period-content">
                            <a href="#">{% trans 'Aylık' %}</a>
                            <a href="#">{% trans 'Yıllık' %}</a>
                        </div>
                    </div>
                </div>
                <div id="gelirgider"></div>
            </div>
            <div class="large-stats-card expenses-by-category">
                <div class="stats-header">
    <div class="stats-title">{% trans 'Kategorilere Göre Giderler' %}</div>

</div>
                <div id="expenses-by-category"></div>
                <span>
                {% trans 'En yüksek değere sahip 10 kategori listelenmiştir.' %}
            </span>
                <div class="stats-footer">
                    <div class="stats-footer-part">
                        <span>{% trans 'Kategori Sayısı' %}</span>
                        {{bilgi_cagir.isimleri | length}}
                    </div>
                    <div class="stats-footer-part">
                        <span>{% trans 'Toplam Gider' %}</span>
                        ${{bilgi_cagir.tutar}}
                    </div>
                </div>
            </div>
        </div>
        
        <script>
            var options = {
                series: [{
                    name: '{% trans "Gelir" %}',
                    data: {{ozellikleri.gelir | safe }}
                }, {
                    name: '{% trans "Gider" %}',
                    data: {{ozellikleri.gider | safe }}
                }],
                chart: {
                    height: 350,
                    type: 'area',
                    zoom: {
                        enabled: false
                    }
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    curve: 'smooth'
                },
                xaxis: {
                    type: 'category',
                    categories: 
                        {{ozellikleri.aylar | safe }}
                    
                },
                colors: ['#5FC396', '#FFAB00'],
                tooltip: {
                    x: {
                        format: 'MMM'
                    }
                }
            };

            var chart = new ApexCharts(document.querySelector("#gelirgider"), options);
            chart.render();




           // Örnek veriler
let seriesData = {{bilgi_cagir.a}}; // Gider değerleri
let labelsData = {{bilgi_cagir.isimleri |safe}}; // Gider kategorileri

// Giderleri sıralayıp en büyük 10'u seçiyoruz
let combinedData = seriesData.map((value, index) => ({ value, label: labelsData[index] }));
combinedData.sort((a, b) => b.value - a.value); // Büyükten küçüğe sıralama
let top10Data = combinedData.slice(0, 10);

// Yeni series ve labels oluşturuyoruz
let top10Series = top10Data.map(item => item.value);
let top10Labels = top10Data.map(item => item.label);

// ApexCharts için ayarlar
var options = {
    series: top10Series,
    labels: top10Labels,
    chart: {
        type: 'polarArea',
    },
    stroke: {
        colors: ['#fff']
    },
    fill: {
        opacity: 0.8
    },
    tooltip: {
        y: {
            formatter: function (value) {
                return value.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            }
        }
    },
};

var chart = new ApexCharts(document.querySelector("#expenses-by-category"), options);
chart.render();





        </script>                                                                                                     
{% endif %}
                                    
{% else %}
               <div class="large-cards">
            <div class="large-stats-card">
                <div class="stats-header">
                    <div class="stats-title">{% trans 'Gelir - Gider Grafiği' %}</div>
                    <div class="stats-period-dropdown">
                        <div class="stats-period">{% trans 'Aylık' %}</div>
                        <div class="stats-period-content">
                            <a href="#">{% trans 'Aylık' %}</a>
                            <a href="#">{% trans 'Yıllık' %}</a>
                        </div>
                    </div>
                </div>
                <div id="gelirgider"></div>
            </div>
            <div class="large-stats-card expenses-by-category">
                <div class="stats-header">
    <div class="stats-title">{% trans 'Kategorilere Göre Giderler' %}</div>
    
</div>
                <div id="expenses-by-category"></div>
                <span>
                {% trans 'En yüksek değere sahip 10 kategori listelenmiştir.' %}
            </span>
                <div class="stats-footer">
                    <div class="stats-footer-part">
                        <span>{% trans 'Kategori Sayısı' %}</span>
                        {{bilgi_cagir.isimleri | length}}
                    </div>
                    <div class="stats-footer-part">
                        <span>{% trans 'Toplam Gider' %}</span>
                        ${{bilgi_cagir.tutar}}
                    </div>
                </div>
            </div>
        </div>
        
        <script>
            var options = {
                series: [{
                    name: '{% trans "Gelir" %}',
                    data: {{ozellikleri.gelir | safe }}
                }, {
                    name: '{% trans "Gider" %}',
                    data: {{ozellikleri.gider | safe }}
                }],
                chart: {
                    height: 350,
                    type: 'area',
                    zoom: {
                        enabled: false
                    }
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    curve: 'smooth'
                },
                xaxis: {
                    type: 'category',
                    categories: {{ozellikleri.aylar | safe }}
                },
                colors: ['#5FC396', '#FFAB00'],
                tooltip: {
                    x: {
                        format: 'MMM'
                    }
                }
            };

            var chart = new ApexCharts(document.querySelector("#gelirgider"), options);
            chart.render();




// Örnek veriler
let seriesData = {{bilgi_cagir.a}}; // Gider değerleri
let labelsData = {{bilgi_cagir.isimleri |safe}}; // Gider kategorileri

// Giderleri sıralayıp en büyük 10'u seçiyoruz
let combinedData = seriesData.map((value, index) => ({ value, label: labelsData[index] }));
combinedData.sort((a, b) => b.value - a.value); // Büyükten küçüğe sıralama
let top10Data = combinedData.slice(0, 10);

// Yeni series ve labels oluşturuyoruz
let top10Series = top10Data.map(item => item.value);
let top10Labels = top10Data.map(item => item.label);

// ApexCharts için ayarlar
var options = {
    series: top10Series,
    labels: top10Labels,
    chart: {
        type: 'polarArea',
    },
    stroke: {
        colors: ['#fff']
    },
    fill: {
        opacity: 0.8
    },
    tooltip: {
        y: {
            formatter: function (value) {
                return value.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            }
        }
    },
};

var chart = new ApexCharts(document.querySelector("#expenses-by-category"), options);
chart.render();




        </script>                                    
{% endif %}



        <div class="large-cards">
            {% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.gelir_ozeti_gorme %}      
<div class="large-cards-main-row">
                <div class="large-stats-card table-card">
                    <div class="stats-header">
                        <div class="stats-title">{% trans 'Faturalar' %}</div>
                        <div class="stats-period-dropdown">
                            <div class="stats-period">{% trans 'Aylık' %}</div>
                            <div class="stats-period-content">
                                <a href="#">{% trans 'Aylık' %}</a>
                                <a href="#">{% trans 'Yıllık' %}</a>
                            </div>
                        </div>
                    </div>

                    <div class="table-wrapper">
                        <table id="faturalar">
                            <thead>
                                <tr>
                                    <th>{% trans 'Fatura No' %}</th>
                                    <th>{% trans 'Ünvan' %}</th>
                                    <th> {% trans 'Açıklama' %}</th>
                                    <th>{% trans 'Fatura Tarihi' %}</th>
                                    <th>{% trans 'Fatura Tutarı' %}</th>
                                    <th>{% trans 'Kalan Tutarı' %}</th>
                                    <th>{% trans 'Durum' %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for i in  bilgi %}
                                <tr>
                                    {% toplam_odenme_tutari i as odeme %}
                                    {% toplam_tutar_cikarmai i as tutar %}
                                    <td><h5 class="fs-13 my-1"><a  href="/{{dil}}{% url 'accounting:fatura_goster2' i.id %}"  class="faturano-link">{{i.fatura_no}}</a>
                                    </h5></td>
                                    <td>{{i.cari_bilgisi.cari_adi}}</td>
                                    <td>{{i.aciklama}}</td>
                                    <td>{{i.fatura_tarihi| date:'d.m.Y'}} <span class="time"></span></td>
                                    <td> {% toplam_tutar_cikarmai i as fiyat %} $ {% fiyat_duzelt_html fiyat %}</td>
                                    <td>
                                        {% kalan_tutuari i as fiyat %}$ {% fiyat_duzelt_html fiyat %}
                                    </td>
                                    {% if  odeme == tutar %}
                                    <td><span class="status-success">{% trans "Ödendi" %}</span></td>
                                    {% elif odeme > 0 %}
                                    <td><span class="status-pending">{% trans "Beklemede" %}</span></td>
                                    {% elif odeme == 0 %}
                                    <td><span class="status-cancel">{% trans "Ödenmedi" %}</span></td>
                                    {% endif %}
                                    
                                    </tr>
                                    {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div class="table-footer">
                        <a href="/{{dil}}{% url 'accounting:giderler_sayfasi'  %}">{% trans 'Tümünü Gör <i class="icon icon-chevron-right"></i>' %}</a>
                    </div>

                </div>

                <div class="large-stats-card table-card">
                    <div class="stats-header">
                        <div class="stats-title">{% trans 'Borç Faturaları' %}</div>
                        <div class="stats-period-dropdown">
                            <div class="stats-period">{% trans 'Aylık' %}</div>
                            <div class="stats-period-content">
                                <a href="#">{% trans 'Aylık' %}</a>
                                <a href="#">{% trans 'Yıllık' %}</a>
                            </div>
                        </div>
                    </div>

                    <div class="table-wrapper">
                        <table id="borc-faturalar">
                            <thead>
                                <tr>
                                    <th>{% trans 'Fatura No' %}</th>
                                    <th>{% trans 'Ünvan' %}</th>
                                    <th> {% trans 'Açıklama' %}</th>
                                    <th>{% trans 'Fatura Tarihi' %}</th>
                                    <th>{% trans 'Fatura Tutarı' %}</th>
                                    <th>{% trans 'Kalan Tutarı' %}</th>
                                    <th>{% trans 'Durum' %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for i in  gider  %}
                                <tr>
                                    {% toplam_odenme_tutari i as odeme %}
                                    {% toplam_tutar_cikarmai i as tutar %}
                                    <td><h5 class="fs-13 my-1"><a  href="/{{dil}}{% url 'accounting:fatura_goster2' i.id %}"  class="faturano-link">{{i.fatura_no}}</a>
                                    </h5></td>
                                    <td>{{i.cari_bilgisi.cari_adi}}</td>
                                    <td>{{i.aciklama}}</td>
                                    <td>{{i.fatura_tarihi| date:'d.m.Y'}} <span class="time"></span></td>
                                    <td>{% toplam_tutar_cikarmai i as fiyat %} ${% fiyat_duzelt_html fiyat %}</td>
                                    <td>
                                        {% kalan_tutuari i as fiyat %} ${% fiyat_duzelt_html fiyat %}
                                    </td>
                                    {% if  odeme == tutar %}
                                    <td><span class="status-success">{% trans "Ödendi" %}</span></td>
                                    {% elif odeme > 0 %}
                                    <td><span class="status-pending">{% trans "Beklemede" %}</span></td>
                                    {% elif odeme == 0 %}
                                    <td><span class="status-cancel">{% trans "Ödenmedi" %}</span></td>
                                    {% endif %}
                                    
                                    </tr>
                                    {% endfor %}

                            </tbody>
                        </table>
                    </div>

                    <div class="table-footer">
                    <a href="/{{dil}}{% url 'accounting:giderler_sayfasi_borc'  %}">{% trans 'Tümünü Gör <i class="icon icon-chevron-right"></i>' %}</a>
                        
                    </div>

                </div>

                <div class="large-stats-card table-card">
                    <div class="stats-header">
                        <div class="stats-title">{% trans 'İş Emirleri' %}</div>
                        <div class="stats-period-dropdown">
                            <div class="stats-period">{% trans 'Tüm İş Emirleri' %}</div>
                            <div class="stats-period-content">
                                <a href="/{{dil}}{% url 'main:yapilacaklar' %}">{% trans 'Tüm İş Emirleri' %}</a>
                            </div>
                        </div>
                    </div>

                    <div class="table-wrapper">
                        <table id="gorevler">
                            <thead>
                                <tr>
                                    <th>{% trans 'İş Emri Adı' %}</th>
                                    <th>{% trans 'Açıklama' %}</th>
                                    
                                    <th>{% trans 'Bitiş Tarihi' %}</th>
                                    <th>{% trans 'Öncelik' %}</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for i in son_gorevler %}
                                <tr>
                                    <td>{{i.title}}</td>
                                    <td>{{i.aciklama}}</td>
                                
                                    <td>{{i.teslim_tarihi|date:"d.m.Y"}}</td>
                                    <td>
                                    {% if i.oncelik_durumu == "High" %}
                                        <span class="status-danger">{{i.oncelik_durumu}}</span>
                                            {% elif i.oncelik_durumu == "Medium" %}
                                            
                                             <span class="status-warning">{{i.oncelik_durumu}}</span>
                                            {% elif i.oncelik_durumu == "Low" %}
                                            <span class="status-success">{{i.oncelik_durumu}}</span>
                                            {% endif %}</td>
                                </tr>
                                {% endfor %}
                                

                            </tbody>
                        </table>
                    </div>


                    <div class="table-footer">
                       <a href="/{{dil}}{% url 'main:yapilacaklar' %}">{% trans 'Tümünü Gör <i class="icon icon-chevron-right"></i>' %}</a> 
                    </div>

                </div>
            </div>

            <script>
                let faturalar = new DataTable('#faturalar', {
                    paging: false,
                    searching: false,
                    info: false,
                    // responsive: true
                });

                let borcfaturalar = new DataTable('#borc-faturalar', {
                    paging: false,
                    searching: false,
                    info: false,
                    // responsive: true
                });

                let gorevler = new DataTable('#gorevler', {
                    paging: false,
                    searching: false,
                    info: false,
                    // responsive: true
                });
            </script>                                                                                                  
{% endif %}
                                    
{% else %}
     <div class="large-cards-main-row">
                <div class="large-stats-card table-card">
                    <div class="stats-header">
                        <div class="stats-title">{% trans 'Faturalar' %}</div>
                        <div class="stats-period-dropdown">
                            <div class="stats-period">{% trans 'Aylık' %}</div>
                            <div class="stats-period-content">
                                <a href="#">{% trans 'Aylık' %}</a>
                                <a href="#">{% trans 'Yıllık' %}</a>
                            </div>
                        </div>
                    </div>

                    <div class="table-wrapper">
                        <table id="faturalar">
                            <thead>
                                <tr>
                                    <th>{% trans 'Fatura No' %}</th>
                                    <th>{% trans 'Ünvan' %}</th>
                                    <th> {% trans 'Açıklama' %}</th>
                                    <th>{% trans 'Fatura Tarihi' %}</th>
                                    <th>{% trans 'Fatura Tutarı' %}</th>
                                    <th>{% trans 'Kalan Tutarı' %}</th>
                                    <th>{% trans 'Durum' %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for i in  bilgi %}
                                <tr>
                                    {% toplam_odenme_tutari i as odeme %}
                                    {% toplam_tutar_cikarmai i as tutar %}
                                    <td><h5 class="fs-13 my-1"><a  href="/{{dil}}{% url 'accounting:fatura_goster2' i.id %}"  class="faturano-link">{{i.fatura_no}}</a>
                                    </h5></td>
                                    <td>{{i.cari_bilgisi.cari_adi}}</td>
                                    <td>{{i.aciklama}}</td>
                                    <td>{{i.fatura_tarihi| date:'d.m.Y'}} <span class="time"></span></td>
                                    <td> {% toplam_tutar_cikarmai i as fiyat %} $ {% fiyat_duzelt_html fiyat %}</td>
                                    <td>
                                        {% kalan_tutuari i as fiyat %}$ {% fiyat_duzelt_html fiyat %}
                                    </td>
                                    {% if  odeme == tutar %}
                                    <td><span class="status-success">{% trans "Ödendi" %}</span></td>
                                    {% elif odeme > 0 %}
                                    <td><span class="status-pending">{% trans "Beklemede" %}</span></td>
                                    {% elif odeme == 0 %}
                                    <td><span class="status-cancel">{% trans "Ödenmedi" %}</span></td>
                                    {% endif %}
                                    
                                    </tr>
                                    {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div class="table-footer">
                        <a href="/{{dil}}{% url 'accounting:giderler_sayfasi'  %}">{% trans 'Tümünü Gör <i class="icon icon-chevron-right"></i>' %}</a>
                    </div>

                </div>

                <div class="large-stats-card table-card">
                    <div class="stats-header">
                        <div class="stats-title">{% trans 'Borç Faturaları' %}</div>
                        <div class="stats-period-dropdown">
                            <div class="stats-period">{% trans 'Aylık' %}</div>
                            <div class="stats-period-content">
                                <a href="#">{% trans 'Aylık' %}</a>
                                <a href="#">{% trans 'Yıllık' %}</a>
                            </div>
                        </div>
                    </div>

                    <div class="table-wrapper">
                        <table id="borc-faturalar">
                            <thead>
                                <tr>
                                    <th>{% trans 'Fatura No' %}</th>
                                    <th>{% trans 'Ünvan' %}</th>
                                    <th> {% trans 'Açıklama' %}</th>
                                    <th>{% trans 'Fatura Tarihi' %}</th>
                                    <th>{% trans 'Fatura Tutarı' %}</th>
                                    <th>{% trans 'Kalan Tutarı' %}</th>
                                    <th>{% trans 'Durum' %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for i in  gider  %}
                                <tr>
                                    {% toplam_odenme_tutari i as odeme %}
                                    {% toplam_tutar_cikarmai i as tutar %}
                                    <td><h5 class="fs-13 my-1"><a  href="/{{dil}}{% url 'accounting:fatura_goster2' i.id %}"  class="faturano-link">{{i.fatura_no}}</a>
                                    </h5></td>
                                    <td>{{i.cari_bilgisi.cari_adi}}</td>
                                    <td>{{i.aciklama}}</td>
                                    <td>{{i.fatura_tarihi| date:'d.m.Y'}} <span class="time"></span></td>
                                    <td>{% toplam_tutar_cikarmai i as fiyat %} ${% fiyat_duzelt_html fiyat %}</td>
                                    <td>
                                        {% kalan_tutuari i as fiyat %} ${% fiyat_duzelt_html fiyat %}
                                    </td>
                                    {% if  odeme == tutar %}
                                    <td><span class="status-success">{% trans "Ödendi" %}</span></td>
                                    {% elif odeme > 0 %}
                                    <td><span class="status-pending">{% trans "Beklemede" %}</span></td>
                                    {% elif odeme == 0 %}
                                    <td><span class="status-cancel">{% trans "Ödenmedi" %}</span></td>
                                    {% endif %}
                                    
                                    </tr>
                                    {% endfor %}

                            </tbody>
                        </table>
                    </div>

                    <div class="table-footer">
                    <a href="/{{dil}}{% url 'accounting:giderler_sayfasi_borc'  %}">{% trans 'Tümünü Gör <i class="icon icon-chevron-right"></i>' %}</a>
                        
                    </div>

                </div>

                <div class="large-stats-card table-card">
                    <div class="stats-header">
                        <div class="stats-title">{% trans 'İş Emirleri' %}</div>
                        <div class="stats-period-dropdown">
                            <div class="stats-period">{% trans 'Tüm İş Emirleri' %}</div>
                            <div class="stats-period-content">
                                <a href="/{{dil}}{% url 'main:yapilacaklar' %}">{% trans 'Tüm İş Emirleri' %}</a>
                            </div>
                        </div>
                    </div>

                    <div class="table-wrapper">
                        <table id="gorevler">
                            <thead>
                                <tr>
                                    <th>{% trans 'Görev Adı' %}</th>
                                    <th>{% trans 'Açıklama' %}</th>
                                    <th scope="col">{% trans 'Blok' %}</th>
                                    <th scope="col">{% trans 'Kat' %}</th>
                                    <th>{% trans 'Bitiş Tarihi' %}</th>
                                    <th>{% trans 'Öncelik' %}</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for i in son_gorevler %}
                                <tr>
                                    <td>{{i.title}}</td>
                                    <td>{{i.aciklama}}</td>
                                    <td style="text-transform: capitalize; text-align: left; padding-left: 10px;">
                                    {% if i.blok %}
                                        {{i.blok.blog_adi}}
                                    {% else %}
                                    {% endif %}
                                    </td>
                                    <td style="text-transform: capitalize; text-align: left; padding-left: 10px;">{% if i.blok %}
                                        {{i.kat}}
                                    {% else %}
                                    {% endif %}</td>
                                    <td>{{i.teslim_tarihi|date:"d.m.Y"}}</td>
                                    <td>
                                    {% if i.oncelik_durumu == "High" %}
                                        <span class="status-danger">{{i.oncelik_durumu}}</span>
                                            {% elif i.oncelik_durumu == "Medium" %}
                                            
                                             <span class="status-warning">{{i.oncelik_durumu}}</span>
                                            {% elif i.oncelik_durumu == "Low" %}
                                            <span class="status-success">{{i.oncelik_durumu}}</span>
                                            {% endif %}</td>
                                </tr>
                                {% endfor %}
                                

                            </tbody>
                        </table>
                    </div>


                    <div class="table-footer">
                       <a href="/{{dil}}{% url 'main:yapilacaklar' %}">{% trans 'Tümünü Gör <i class="icon icon-chevron-right"></i>' %}</a> 
                    </div>

                </div>
            </div>

            <script>
                let faturalar = new DataTable('#faturalar', {
                    paging: false,
                    searching: false,
                    info: false,
                    // responsive: true
                });

                let borcfaturalar = new DataTable('#borc-faturalar', {
                    paging: false,
                    searching: false,
                    info: false,
                    // responsive: true
                });

                let gorevler = new DataTable('#gorevler', {
                    paging: false,
                    searching: false,
                    info: false,
                    // responsive: true
                });
            </script>                                      
{% endif %}
            



            <div class="large-cards-second-row">

             <div class="card" id="buildingCard">
    <div class="stats-header">
        <div class="isemri-title">{% trans 'Aktif İş Emirleri' %}</div>
    </div>
    <div class="card-body" id="cardBody">
        <!-- butonlar -->
        <div class="block-selector">
        {% if request.user.kullanicilar_db %}
        {% blok_bilgileri request.user.kullanicilar_db as blok_olusturma %}
        {% else %}
            {% blok_bilgileri request.user as blok_olusturma %}
            {% endif %}
            
            {% for i in blok_olusturma %}
                <button onclick="showBlock('{{i.id}}', {{i.kat|safe}})" class="block-btn">{{i.yapi}}</button>
                
            {% endfor %}
            <script>
                function setActiveButton(button) {
                    // Tüm butonlardaki 'active' sınıfını kaldırır
                    document.querySelectorAll('.block-selector .block-btn').forEach(btn => btn.classList.remove('active'));
                    
                    // Tıklanan butona 'active' sınıfı ekler
                    button.classList.add('active');
                }
            </script>
        </div>

        <!-- bloklar -->
        <div class="building-container" id="buildingContainer">
        {% if request.user.kullanicilar_db %}
        {% blok_bilgileri request.user.kullanicilar_db as blok_olusturma %}
        {% else %}
            {% blok_bilgileri request.user as blok_olusturma %}
            {% endif %}
            {% for i in blok_olusturma %}
            
            
            <div class="building" id="building-{{i.id}}" style="display: none;">
                <div class="face" id="{{i.gorseli}}-{{i.id}}-face1"><div class="roof">Kuzey</div></div>
                <div class="face" id="{{i.gorseli}}-{{i.id}}-face2"><div class="roof">Doğu</div></div>
                <div class="face" id="{{i.gorseli}}-{{i.id}}-face3"><div class="roof">Güney</div></div>
                <div class="face" id="{{i.gorseli}}-{{i.id}}-face4"><div class="roof">Batı</div></div>
            </div>
            {% endfor %}
        </div>

        <!-- Mouse yanında çıkan mini modal -->
        <div id="infoModal" class="info-modal">
            <span class="close-btn" onclick="closeInfoModal()">×</span>
            <p id="modalText"></p>
            <button class="action-btn" onclick="goToTask()">İş Emrine Git</button>
        </div>
    </div>
</div>


<!-- Eski 3d bina bloğu
                <div class="card">
                    <div class="cardbuild">
                                <div class="stats-header">
                                    <div class="stats-title">
                                        {% trans 'Aktif İş Emirleri' %}
                                    </div>
                                </div>
                                    <div class="cardbuild-body">
                                                <div class="building-container">
                                                    <div class="building" id="building">
                                                        <div class="face" id="face1"><div class="roof">Kuzey</div></div>
                                                        <div class="face" id="face2"><div class="roof">Doğu</div></div>
                                                        <div class="face" id="face3"><div class="roof">Güney</div></div>
                                                        <div class="face" id="face4"><div class="roof">Batı</div></div>
                                                    </div>
                                                </div>
                                                    <div id="infoModal" class="info-modal">
                                                        <span class="close-btn" onclick="closeInfoModal()">×</span>
                                                        <p id="modalText"></p>
                                                        <button class="action-btn" onclick="goToTask()">İş Emrine Git</button>
                                                    </div>
                                        </div>
                    </div>
                </div>-->
                                {% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.personeller_odeme_gorme %}  
 <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            {% if request.user.kullanicilar_db %}
                            {% dashboard_bilgisi request.user.kullanicilar_db as personelbilgi %}    
                            {% else %}
                            {% dashboard_bilgisi request.user as personelbilgi %}                                          
                            {% endif %}
                                
                                
                            {% trans 'Personeller' %}
                            <span>{% blocktrans with personel_sayisi=personelbilgi.personel_sayisi %}
                                Toplam {{ personel_sayisi }} personel
                            {% endblocktrans %}</span>
                        </div>
                        <a href="/{{dil}}{% url 'users:personeller_sayfasi' %}"><i class="icon icon-plus"></i></a>
                    </div>
                    
                    <div class="card-body">
                    {% for i in personelbilgi.personeller %}
                        <div class="employees">
                            <div class="employee">
                                <div class="employee-image"><img src="{{i.resim}}" alt=""></div>
                                <div class="employee-details">
                                    {{i.isim_soyisim}}
                                    <span>{{i.telefon_numarasi}}</span>
                                </div>
                                <div class="employee-stats">
                                    <span>Ay / Çalışma Saati</span>
                                    {{i.toplam_calisma_saati}}
                                </div>
                            </div>
                            
                        </div>
                         {% endfor %}
                        <div class="card-footer">
                           <a href="/{{dil}}{% url 'users:personeller_sayfasi' %}" class="card-show-all"> {% trans 'Tümünü Gör <i class="icon icon-forward"></i>' %}</a>
                        </div>
                    </div>
                   
                </div>                                                                                                      
{% endif %}
                                    
{% else %}
        <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            {% if request.user.kullanicilar_db %}
                            {% dashboard_bilgisi request.user.kullanicilar_db as personelbilgi %}    
                            {% else %}
                            {% dashboard_bilgisi request.user as personelbilgi %}                                          
                            {% endif %}
                                
                                
                            {% trans 'Personeller' %}
                            <span>{% blocktrans with personel_sayisi=personelbilgi.personel_sayisi %}
                                Toplam {{ personel_sayisi }} personel
                            {% endblocktrans %}</span>
                        </div>
                        <a href="/{{dil}}{% url 'users:personeller_sayfasi' %}"><i class="icon icon-plus"></i></a>
                    </div>
                    
                    <div class="card-body">
                    {% for i in personelbilgi.personeller %}
                        <div class="employees">
                            <div class="employee">
                                <div class="employee-image"><img src="{{i.resim}}" alt=""></div>
                                <div class="employee-details">
                                    {{i.isim_soyisim}}
                                    <span>{{i.telefon_numarasi}}</span>
                                </div>
                                <div class="employee-stats">
                                    <span>Ay / Çalışma Saati</span>
                                    {{i.toplam_calisma_saati}}
                                </div>
                            </div>
                            
                        </div>
                         {% endfor %}
                        <div class="card-footer">
                           <a href="/{{dil}}{% url 'users:personeller_sayfasi' %}" class="card-show-all"> {% trans 'Tümünü Gör <i class="icon icon-forward"></i>' %}</a>
                        </div>
                    </div>
                   
                </div>                                    
{% endif %}
               {% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.santiye_gorme %}   
   <div class="info-card">
                    <div class="info-card-image">
                        <img src="{% static 'go/images/info-card-1.png' %}" alt="Aktif Şantiye Sayısı">
                    </div>
                    <div class="info-card-content">
                    {% blocktrans with aktif_santiye=personelbilgi.aktif_santiye %}
                            {{ aktif_santiye }} <span>Aktif Şantiye Sayısı</span>
                            {% endblocktrans %}
                    
                        
                    </div>
                </div>                                                                                                     
{% endif %}
                                    
{% else %}
         <div class="info-card">
                    <div class="info-card-image">
                        <img src="{% static 'go/images/info-card-1.png' %}" alt="Aktif Şantiye Sayısı">
                    </div>
                    <div class="info-card-content">
                    {% blocktrans with aktif_santiye=personelbilgi.aktif_santiye %}
                            {{ aktif_santiye }} <span>Aktif Şantiye Sayısı</span>
                            {% endblocktrans %}
                    
                        
                    </div>
                </div>                                     
{% endif %}

         {% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.personeller_gorme %} 
                <div class="info-card">
                    <div class="info-card-image">
                        <img src="{% static 'go/images/info-card-2.png' %}" alt="Aktif Personel Sayısı">
                    </div>
                    <div class="info-card-content">
                    {% blocktrans with personel_sayisi=personelbilgi.personel_sayisi %}
                            {{ personel_sayisi }} <span>Aktif Personel Sayısı</span>
                            {% endblocktrans %}
                       
                    </div>
                </div>                                                                                                       
{% endif %}
                                    
{% else %}
                       <div class="info-card">
                    <div class="info-card-image">
                        <img src="{% static 'go/images/info-card-2.png' %}" alt="Aktif Personel Sayısı">
                    </div>
                    <div class="info-card-content">
                    {% blocktrans with personel_sayisi=personelbilgi.personel_sayisi %}
                            {{ personel_sayisi }} <span>Aktif Personel Sayısı</span>
                            {% endblocktrans %}
                       
                    </div>
                </div>                                    
{% endif %}    
{% if request.user.kullanicilar_db %}
{% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
{% if yetki.projeler_gorme %}  
  <div class="info-card">
                    <div class="info-card-image">
                        <img src="{% static 'go/images/info-card-3.png' %}" alt="Aktif Proje Sayısı">
                    </div>
                    <div class="info-card-content">
                    {% blocktrans with aktif_proje=personelbilgi.aktif_proje %}
                            {{ aktif_proje }} <span>Aktif Proje Sayısı</span>
                            {% endblocktrans %}
                        
                    </div>
                </div>                                                                                                      
{% endif %}
                                    
{% else %}
        <div class="info-card">
                    <div class="info-card-image">
                        <img src="{% static 'go/images/info-card-3.png' %}" alt="Aktif Proje Sayısı">
                    </div>
                    <div class="info-card-content">
                    {% blocktrans with aktif_proje=personelbilgi.aktif_proje %}
                            {{ aktif_proje }} <span>Aktif Proje Sayısı</span>
                            {% endblocktrans %}
                        
                    </div>
                </div>                                     
{% endif %}


              

            </div>

        </div>



    </main>

{% endif %}


    {% if request.user.kullanicilar_db %}
    {% blok_bilgileri request.user.kullanicilar_db as blok_olusturmaaa %}
    {% else %}
        {% blok_bilgileri request.user as blok_olusturmaaa %}
        {% endif %}

{% for j in blok_olusturmaaa %}
    {% bina_3d2 j.id  as sonuc_veriyor_yanma_sonme %}
{% for i in sonuc_veriyor_yanma_sonme.gorevler %}
<div class="modal" id="ilerleme{{i.id}}">
    <div class="modal-inner" style="width: 500px;">
        <div class="modal-header">
            {% trans 'İlerleme Takibi' %}
        </div>
        <div class="modal-body">
            <div class="ilerleme-durumlari">
                <div class="ilerleme-durumu">
                    <span>{{i.kayit_tarihi}}</span>
                    <div class="ilerleme-durumu-content">
                        {% trans 'Başlık ' %}  {{i.title}} <br>
                        {% trans 'Açıklama ' %} {{i.aciklama}}<br>
                        {% trans 'Teslim Tarihi ' %} {{i.teslim_tarihi}} <br>
                        {% trans 'Dosyalar ' %} {% dosya_varsa_indirme_isplani i %}
                        {% trans 'Atamalar: ' %} {% for yazar in i.yapacaklar.all %}
                        {{yazar.last_name}},
                 {% endfor %}

                    </div>
                </div>
                {% ilerleme_goster i.id as veriler %}
                    {% for k in  veriler %}
                    <div class="ilerleme-durumu">
                    <span>{{k.kayit_tarihi}}</span>
                    <div class="ilerleme-durumu-content">
                       {% trans 'İşlemi Yapan ' %} {{k.yapan_kisi.last_name}} <br>
                       {% trans 'Açıklama ' %}{{k.aciklama}}<br>
                        {% trans 'Durum ' %}{{k.status}} <br>
                        {% trans 'Teslim Tarihi ' %}{{k.teslim_tarihi}}<br>
                        
                    </div>
                        <div class="ilerleme-durumu-dosyalar">
                            {% dosya_varsa_indirme_isplani_ilerleme k.id %}
                            
                           
                        </div>
                    </div>
                </div>
                
                    
                
                    {% endfor %}
                
            
            </div>
        </div>
    </div>
</div>
{% endfor %}
{% for kat in sonuc_veriyor_yanma_sonme.kat_gonder %}
<div class="modal" id="gorevleri_goster{{kat}}-{{j.id}}">
    <div class="modal-inner" style="width: %90;">
        <div class="modal-header">
            {% blocktrans %}{{ kat }} Bu kattaki İş Emirleri{% endblocktrans %}
            
        </div>
        <div class="modal-body">
            <table id="tumu-table-{{kat}}" class="table">
                <thead>
                    <tr>
                              <th scope="col">{% trans 'İş Emri Adı' %}</th>
                                <th scope="col">{% trans 'Açıklama' %}</th>
                                <th scope="col">{% trans 'İlgililer' %}</th>
                                <th scope="col">{% trans 'Başlangıç' %}</th>
                                <th scope="col">{% trans 'Hedef Tarih' %}</th>
                                <th scope="col">{% trans 'Durum' %}</th>
                                <th scope="col">{% trans 'Öncelik' %}</th>
                                <th scope="col">{% trans 'Aksiyon' %}</th>
                    </tr>
                </thead>
                <tbody>
                {% for i in  sonuc_veriyor_yanma_sonme.gorevler %}
                    {% if i.kat == kat %}
                    
                    
                            {% if request.user.kullanicilar_db %}
                                    {% kulanici_yetkileri_kullandirt request.user request.user.kullanicilar_db as yetki %}
                                    {% if yetki.yapilacaklar_olusturma %}
                    <tr>
                        <td>
                            <div class="task-check">
                                
                                {{i.title}}
                            </div>
                        </td>
                        <td> {{i.aciklama}}</td>
                        <td>
                            <div class="td-assigned-people">
                                <div class="td-assigned-people-profiles">
                                     {% for yazar in i.yapacaklar.all %}
                                           <a href="javascript: void(0);"
                                            class="avatar-group-item"
                                            data-img="{% if yazar.image %}{{yazar.image.url}}{% else %}{% static 'go/content/images/profile.png' %}{% endif %}"
                                            data-bs-toggle="tooltip" data-bs-placement="top"
                                            data-bs-title="{{yazar.last_name}}"> <img
                                                src="{% if yazar.image %}{{yazar.image.url}}{% else %}{% static 'go/content/images/profile.png' %}{% endif %}" alt=""
                                                class="rounded-circle avatar-xxs"> </a>
                                    {% endfor %}
                                    <span>+{{i.yapacaklar.all | length}}</span>
                                </div>
                            </div>
                        </td>
                        <td>{{i.kayit_tarihi}}</td>
                        <td>{{i.teslim_tarihi|date:"d.m.Y"}}</td>
                        <td>
                        {% isplani_durumu_kontrol i.id as b %}
                                    
                                    {% if i.status == "Inprogress" %}
                                        <span
                                        class="status-inprogress stats-lg">{{i.status}}</span>
                                    {% elif i.status == "New" %}
                                    <div class="td-info"><span class="status-highlight stats-lg">Yeni</span></div>
                                    {% elif i.status == "Pending" %}
                                    <div class="td-info"><span class="status-pending stats-lg">Beklemede</span></div>
                                     {% elif i.status == "Completed" %}
                                    <div class="td-info"><span class="status-success stats-lg">Tamamlandı</span></div>
                                        {% endif %}
                                    
                            
                        </td>
                        <td>
                             {% if i.oncelik_durumu == "High" %}
                        <div class="td-info"><span class="status-cancel stats-lg">{{i.oncelik_durumu}}</span></div>
            
                                {% elif i.oncelik_durumu == "Medium" %}
                                <div class="td-info"><span class="status-orange stats-lg">{{i.oncelik_durumu}}</span></div>
                                {% elif i.oncelik_durumu == "Low" %}
                                <div class="td-info"><span class="status-dark stats-lg">{{i.oncelik_durumu}}</span></div>
                                {% endif %}
                        </td>
                        <td>
                            
                        </td>
                    </tr>
                     {% else %}
                        {% if request.user in i.yapacaklar.all %}
                          <tr>
                        <td>
                            <div class="task-check">
                                
                                {{i.title}}
                            </div>
                        </td>
                        <td> {{i.aciklama}}</td>
                        <td>
                            <div class="td-assigned-people">
                                <div class="td-assigned-people-profiles">
                                     {% for yazar in i.yapacaklar.all %}
                                           <a href="javascript: void(0);"
                                            class="avatar-group-item"
                                            data-img="{% if yazar.image %}{{yazar.image.url}}{% else %}{% static 'go/content/images/profile.png' %}{% endif %}"
                                            data-bs-toggle="tooltip" data-bs-placement="top"
                                            data-bs-title="{{yazar.last_name}}"> <img
                                                src="{% if yazar.image %}{{yazar.image.url}}{% else %}{% static 'go/content/images/profile.png' %}{% endif %}" alt=""
                                                class="rounded-circle avatar-xxs"> </a>
                                    {% endfor %}
                                    <span>+{{i.yapacaklar.all | length}}</span>
                                </div>
                            </div>
                        </td>
                        <td>{{i.kayit_tarihi}}</td>
                        <td>{{i.teslim_tarihi|date:"d.m.Y"}}</td>
                        <td>
                        {% isplani_durumu_kontrol i.id as b %}
                                    
                                    {% if i.status == "Inprogress" %}
                                        <span
                                        class="status-inprogress stats-lg">{{i.status}}</span>
                                    {% elif i.status == "New" %}
                                    <div class="td-info"><span class="status-highlight stats-lg">New</span></div>
                                    {% elif i.status == "Pending" %}
                                    <div class="td-info"><span class="status-pending stats-lg">Beklemede</span></div>
                                     {% elif i.status == "Completed" %}
                                    <div class="td-info"><span class="status-success stats-lg">Tamamlandı</span></div>
                                        {% endif %}
                                    
                            
                        </td>
                        <td>
                          {% if i.oncelik_durumu == "High" %}
                        <div class="td-info"><span class="status-cancel stats-lg">{% trans 'Acil' %}</span></div>
            
                                {% elif i.oncelik_durumu == "Medium" %}
                                <div class="td-info"><span class="status-orange stats-lg">{% trans 'Orta' %}</span></div>
                                {% elif i.oncelik_durumu == "Low" %}
                                <div class="td-info"><span class="status-dark stats-lg">{% trans 'Düşük' %}</span></div>
                                {% endif %}
                         </td>
                        <td>
                            <div class="td-actions">
                                
                                        <a onclick="openModal('ilerleme{{i.id}}')" class="status-view"><i
                                            class="icon icon-view"></i></a>
                               

                            </div>
                        </td>
                    </tr>
                       {% endif %}                                                        
                                    
                    {% endif %}
                            
                    {% else %}
                      <tr>
                        <td>
                            <div class="task-check">
                               
                                {{i.title}}
                            </div>
                        </td>
                        <td> {{i.aciklama}}</td>
                        <td>
                            <div class="td-assigned-people">
                                <div class="td-assigned-people-profiles">
                                     {% for yazar in i.yapacaklar.all %}
                                           <a href="javascript: void(0);"
                                            class="avatar-group-item"
                                            data-img="{% if yazar.image %}{{yazar.image.url}}{% else %}{% static 'go/content/images/profile.png' %}{% endif %}"
                                            data-bs-toggle="tooltip" data-bs-placement="top"
                                            data-bs-title="{{yazar.last_name}}"> <img
                                                src="{% if yazar.image %}{{yazar.image.url}}{% else %}{% static 'go/content/images/profile.png' %}{% endif %}" alt=""
                                                class="rounded-circle avatar-xxs"> </a>
                                    {% endfor %}
                                    <span>+{{i.yapacaklar.all | length}}</span>
                                </div>
                            </div>
                        </td>
                        <td>{{i.kayit_tarihi}}</td>
                        <td>{{i.teslim_tarihi|date:"d.m.Y"}}</td>
                        <td>
                        {% isplani_durumu_kontrol i.id as b %}
                                    
                                    {% if i.status == "Inprogress" %}
                                        <span
                                        class="status-inprogress stats-lg">{% trans 'Devam Eden' %}</span>
                                    {% elif i.status == "New" %}
                                    <div class="td-info"><span class="status-highlight stats-lg">{% trans 'Yeniler' %}</span></div>
                                    {% elif i.status == "Pending" %}
                                    <div class="td-info"><span class="status-pending stats-lg">{% trans 'Devam Eden' %}</span></div>
                                     {% elif i.status == "Completed" %}
                                    <div class="td-info"><span class="status-success stats-lg">{% trans 'Tamamlanan' %}</span></div>
                                        {% endif %}
                                    
                            
                        </td>
                        <td>
                        {% if i.oncelik_durumu == "High" %}
                        <div class="td-info"><span class="status-cancel stats-lg">{% trans 'Acil' %}</span></div>
            
                                {% elif i.oncelik_durumu == "Medium" %}
                                <div class="td-info"><span class="status-orange stats-lg">{% trans 'Orta' %}</span></div>
                                {% elif i.oncelik_durumu == "Low" %}
                                <div class="td-info"><span class="status-dark stats-lg">{% trans 'Düşük' %}</span></div>
                                {% endif %}
                            
                        </td>
                        <td>
                            <div class="td-actions">
                                
                                        <a onclick="openModal('ilerleme{{i.id}}')" class="status-view"><i
                                            class="icon icon-view"></i></a>
                               

                            </div>
                        </td>
                    </tr>

                    {% endif %}
                    {% else %}
                    {% endif %}
                    {% endfor %}
                    
                    </tbody>
            </table>
             
                
                <div class="form-actions">
                    <button class="form-action-secondary" type="button" onclick="closeModal('gorevleri_goster{{kat}}-{{j.id}}')">{% trans 'Kapat' %}</button>
                  
                </div>
            
        </div>
    </div>
</div>
{% endfor %}
{% endfor %}
<script>
    function updateWeatherClock() {
      // Dinamik long ve lat değerleri
      var longitude = parseFloat("{{ weather_data.coord.lon|default:0 }}"); // Boylam değeri (float'a çevrilir)
      var latitude = parseFloat("{{ weather_data.coord.lat|default:0 }}");  // Enlem değeri (float'a çevrilir)
    
      // Haftanın günleri
      var days = ["Pazar", "Pazartesi", "Salı", "Çarşamba", "Perşembe", "Cuma", "Cumartesi"];
      var now = new Date();
    
      // Gün, saat ve tarih bilgilerini al
      var dayName = days[now.getDay()];
      var hours = now.getHours();
      var minutes = now.getMinutes();
      var seconds = now.getSeconds();
      var day = now.getDate();
      var month = now.getMonth() + 1; // Aylar 0-11 arası olduğundan +1 eklenir.
      var year = now.getFullYear();
    
      // Dakika ve saniyeleri iki haneli göstermek için
      hours = hours < 10 ? '0' + hours : hours;
      minutes = minutes < 10 ? '0' + minutes : minutes;
      seconds = seconds < 10 ? '0' + seconds : seconds;
    
      // Saati "09:30:45" formatında göster
      var timeString = hours + ":" + minutes + ":" + seconds;
      
      // Tarihi "12/09/2024" formatında göster
      var fullDateString = day + "/" + month + "/" + year;
    
      // Dinamik olarak gün, saat ve tarih bilgilerini güncelle
      document.getElementById("day-name").textContent = dayName;
      document.getElementById("time-date").textContent = timeString;
      document.getElementById("full-date").textContent = fullDateString;
      document.getElementById("day-names").textContent = dayName;
 
    }
    
    // Her saniyede bir güncelleme
    setInterval(updateWeatherClock, 1000);
    
    // Sayfa yüklendiğinde saati güncelle
    updateWeatherClock();
</script>

<script>
    // Resim URL'si statik dosya olarak ayarlanıyor
    const imageUrl = "{% static 'go/images/3dbuild.png' %}";
    const buildingImages = {
        {% for i in binalar %}
        "{{i.id}}": {
            "front": "{{i.ondden_goruntu}}",
            "back": "{{i.arkadan_goruntu}}",
            "left": "{{i.soldan_goruntu }}",
            "right": "{{i.sagdan_goruntu}}"
        },
        {% endfor %}
    };
</script>
<style>
    {% if request.user.kullanicilar_db %}
        {% blok_bilgileri request.user.kullanicilar_db as blok_olusturmaaa %}
        {% else %}
            {% blok_bilgileri request.user as blok_olusturmaaa %}
            {% endif %}
    
    {% for j in blok_olusturmaaa %}
        {% bina_3d2 j.id  as sonuc_veriyor_yanma_sonme %}
    {% for i in sonuc_veriyor_yanma_sonme.kat_bilgileri %}
        .floor[data-floor="{{ i }}"]{% if not forloop.last %},{% endif %}
    {% endfor %}
    {% endfor %}
    {
        animation: red-flash 1s infinite;
    }
    
</style>

<script>

function modals_actirma(event, title,id) {
    openModal(`gorevleri_goster${title}-${id}`);
    
}

function closeModal() {
    const modal = document.getElementById("infoModal");
    modal.style.display = "none";
}

let currentRotation = 0;
let isDragging = false; // Fare sürükleme durumu
let startX = 0;
const infoModal = document.getElementById('infoModal');
{% if request.user.kullanicilar_db %}
        {% blok_bilgilerii request.user.kullanicilar_db as blok_olusturmaa %}
        {% else %}
            {% blok_bilgilerii request.user as blok_olusturmaa %}
            {% endif %}
            
function getFaceImageUrl(buildingId, faceIndex) {
    const building = buildingImages[buildingId];
    if (!building) return '';

    switch (faceIndex) {
        case 1:
            return building.front;
        case 2:
            return building.right;
        case 3:
            return building.back;
        case 4:
            return building.left;
        default:
            return building.front;
    }
}          
function createBuilding() {
    // Django şablon değişkenlerini bu şekilde kullanabilirsiniz
    const bloklar = JSON.parse('{{ blok_olusturmaa }}');

    for (let i = 0; i < bloklar.length; i++) {
        const currentBlok = bloklar[i];
        const floors = currentBlok.kat; // Kat sayısını alın

        for (let j = 1; j <= 4; j++) {
            const face = document.getElementById(`${currentBlok.gorseli}-${currentBlok.id}-face${j}`);
            if (!face) {
                console.error(`${currentBlok.gorseli}-${currentBlok.id}-face${j} elementi bulunamadı!`);
                continue; // Eğer yüzey yoksa, bu döngüyü atla
            }

            face.innerHTML = ''; // Yüzeyi temizle

            for (let k = floors; k >= 1; k--) { // Katları oluştur
                const floor = document.createElement('div');
                floor.className = 'floor';
                floor.style.backgroundImage = `url(${getFaceImageUrl(currentBlok.gorseli, j)})`;  // Resim URL'si
                floor.setAttribute('data-floor', `Kat ${k}-${currentBlok.id}`);
                floor.innerHTML = `Kat ${k}`;
                floor.onclick = function(event) {
                    console.log(`Tıklandı: Kat ${k}-${currentBlok.id}`); // Tıklama olayını kontrol et
                    modals_actirma(event, k,currentBlok.id);
                };
                face.appendChild(floor);
            }
        }
        // Bina döndürme işlevi (Fare ve Touch Eventleri ile)
document.body.addEventListener('pointerdown', function(e) {
    isDragging = true;
    startX = e.clientX; // Başlangıç noktası kaydediliyor
});

document.body.addEventListener('pointermove', function(e) {
    if (!isDragging) return;
    const deltaX = e.clientX - startX;
    currentRotation += deltaX * 0.1; // Döndürme hassasiyeti ayarlandı
    document.querySelector(`#building-${currentBlok.id}`).style.transform = `rotateY(${currentRotation}deg)`;
    startX = e.clientX; // Yeni başlangıç pozisyonu
});

document.body.addEventListener('pointerup', function() {
    isDragging = false; // Sürükleme sonlandırıldı
});

// Dokunmatik cihazlarda döndürme işlevi
document.body.addEventListener('touchstart', function(e) {
    if (e.touches.length === 1) {
        startX = e.touches[0].clientX; // Tek parmakla başla
    }
});

document.body.addEventListener('touchmove', function(e) {
    if (e.touches.length === 1) {
        const deltaX = e.touches[0].clientX - startX;
        currentRotation += deltaX * 0.1; // Dokunmatik döndürme hassasiyeti
        document.querySelector(`#building-${currentBlok.id}`).style.transform = `rotateY(${currentRotation}deg)`;
        startX = e.touches[0].clientX; // Yeni başlangıç pozisyonu
    }
});
    }
}






createBuilding();

</script>

<script>
    function openModal(modalID, close = true) {
        if (close) {
            closeModal();
        }
        if (modalID === "plan-konumu") {
            $("#" + modalID).css({
                "display": "flex",
                "z-index": 100000
            }).hide().fadeIn();
        } else {
            $("#" + modalID).css("display", "flex").hide().fadeIn();
        }
    }

    function closeModal(modalID = "") {
        console.log(modalID.length);
        if (modalID.length === 0) {
            $(".modal").fadeOut();
        } else {
            $("#" + modalID).fadeOut();
        }
    }

    $(".modal").on("click", function (e) {
        if ($(e.target).closest('.modal-inner').length === 0 && $(e.target).closest('.modal').length) {
            closeModal();
        }
    });

    $(document).ready(function () {
        $('input[type="file"]').on('change', function () {
            var files = $(this).prop('files');
            var formElement = $(this).closest('.form-element');
            var fileList = formElement.find('.fileList');
            fileList.find('li:not(label)').remove();

            var selectedFiles = Array.from(files);

            for (var i = 0; i < selectedFiles.length; i++) {
                (function (file) {
                    var listItem = $('<li></li>');

                    if (file.type.startsWith('image/') && (file.type === 'image/png' || file.type === 'image/jpeg' || file.type === 'image/webp')) {
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            listItem.append(`
                                <div class="file-input-uploaded">
                                    <div class="file-input-uploaded-head">
                                        <div class="file-input-uploaded-title" title="${file.name}">${file.name}</div>
                                        <button type="button" class="file-input-uploaded-remove"><i class="icon icon-trash"></i></button>
                                    </div>
                                    <div class="file-input-uploaded-preview">
                                        <img src="${e.target.result}">
                                    </div>
                                </div>
                            `);
                            fileList.append(listItem);

                            listItem.find('.file-input-uploaded-remove').on('click', function () {
                                $(this).closest('li').remove();
                                selectedFiles = selectedFiles.filter(f => f.name !== file.name);
                                updateInput(selectedFiles);
                            });
                        };
                        reader.readAsDataURL(file);
                    } else {
                        listItem.append(`
                            <div class="file-input-uploaded">
                                <div class="file-input-uploaded-head">
                                    <div class="file-input-uploaded-title" title="${file.name}">${file.name}</div>
                                    <button type="button" class="file-input-uploaded-remove"><i class="icon icon-trash"></i></button>
                                </div>
                                <div class="file-input-uploaded-no-preview">
                                    <img src="{% static 'go/content/images/illustration-upload.png' %}">
                                </div>
                            </div>
                        `);
                        fileList.append(listItem);

                        listItem.find('.file-input-uploaded-remove').on('click', function () {
                            $(this).closest('li').remove();
                            selectedFiles = selectedFiles.filter(f => f.name !== file.name);
                            updateInput(selectedFiles);
                        });
                    }
                })(selectedFiles[i]);
            }
        });
    });

    function updateInput(selectedFiles) {
        var dataTransfer = new DataTransfer();
        selectedFiles.forEach(function (file) {
            dataTransfer.items.add(file);
        });
        $('input[type="file"]').prop('files', dataTransfer.files);
    }


</script>
<script>
    document.querySelectorAll('.table').forEach(function(table) {
        let dataTable = new DataTable(table, {
            paging: false,
            searching: true,
            info: false
        });
    });


    $('#stats-search').keyup(function () {
        table.search($(this).val()).draw();
    })
</script>
<script>
    function showBlock(blockId, floors) {
    // Tüm blokları gizle
    document.querySelectorAll('.building').forEach((element) => {
        element.style.display = 'none';
    });

    // Seçili bloğu göster ve kat sayısına göre yüksekliğini ayarla
    const building = document.getElementById('building-' + blockId);
    const buildingContainer = document.getElementById('buildingContainer');
    const cardBody = document.getElementById('cardBody');
    const buildingHeight = floors * 20;

    // Null kontrolü
    if (building && buildingContainer && cardBody) {
        building.style.display = 'block';
        building.style.height = buildingHeight + 'px'; // Bina yüksekliği
        buildingContainer.style.height = buildingHeight + 'px'; // Container yüksekliği
        cardBody.style.height = buildingHeight + 100 + 'px'; // Card-body yüksekliği ek boşluk ile
    } else {
        console.error('Elementlerden biri bulunamadı. Lütfen ID veya sınıf adlarını kontrol edin.');
    }
}

    // Varsayılan olarak ilk bloğu gösterelim
    document.querySelector('.building').style.display = 'block';
    
</script>
<style>
    .block-selector {
        display: flex;
        justify-content: center;
        margin-bottom: 1rem;
        z-index: 10; /* Butonların üstte kalmasını sağlar */
        position: relative; /* Butonların bina tarafından kaplanmasını önler */
        overflow-x: auto;
    }
  

    .block-btn {
        padding: 0.5rem 1rem;
        margin: 0 0.5rem;
        cursor: pointer;
        border: 1px solid #24d6b5;
        background-color: #042940;
        color: #fff;
        border-radius: 5px;
        transition: background-color 0.3s ease;
    }

    .block-btn:hover {
        background-color: #24d6b5;
    }
    .block-btn:active {
        background-color: #24d6b5;
    }

    .building-container {
        transition: height 0.3s ease;
        position: relative;
    }
</style>


{% endblock sidebar %}
