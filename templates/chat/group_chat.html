{% load static %}
{% load custom_tags %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>BiadaGO Sohbet Systems</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="Chitchat">
    <meta name="keywords" content="Chitchat">
    <meta name="author" content="Chitchat">
    <link rel="icon" href="assets/images/favicon/favicon.png" type="image/x-icon">
    <link rel="shortcut icon" href="assets/images/favicon/favicon.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700,800&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,600&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,300i,400,400i,500,500i,700,700i,900,900i&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'go/chat/assets/css/date-picker.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'go/chat/assets/css/magnific-popup.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'go/chat/assets/css/style.css' %}" media="screen" id="color">
    <link rel="stylesheet" type="text/css" href="{% static 'go/chat/assets/css/themify-icons.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'go/chat/assets/css/tour.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'go/chat/assets/js/ckeditor/skins/moono-lisa/editor.css' %}?t=HBDD">
    <link rel="stylesheet" type="text/css" href="{% static 'go/chat/assets/js/ckeditor/plugins/scayt/skins/moono-lisa/scayt.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'go/chat/assets/js/ckeditor/plugins/scayt/dialogs/dialog.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'go/chat/assets/js/ckeditor/plugins/tableselection/styles/tableselection.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'go/chat/assets/js/ckeditor/plugins/wsc/skins/moono-lisa/wsc.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'go/chat/assets/js/ckeditor/plugins/copyformatting/styles/copyformatting.css' %}">
    <style>
        .group-form {
    max-width: 400px; /* Form genişliği */
    margin: 20px auto; /* Ortalama */
    padding: 20px; /* İç boşluk */
    border: 1px solid #ccc; /* Çerçeve */
    border-radius: 8px; /* Köşeleri yuvarlar */
    background-color: #f9f9f9; /* Arka plan rengi */
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Gölge efekti */
}

.form-group {
    margin-bottom: 20px; /* Grup arası boşluk */
}

.form-label {
    font-weight: bold; /* Kalın yazı */
    display: block; /* Satır blok yapar */
    margin-bottom: 5px; /* Etiket ile input arası boşluk */
}

.form-input {
    width: calc(100% - 22px); /* Genişlik ayarı */
    padding: 10px; /* İç boşluk */
    border: 1px solid #ccc; /* Çerçeve */
    border-radius: 4px; /* Köşeleri yuvarlar */
    box-sizing: border-box; /* Genişlik hesabı */
    outline: none; /* Odaklanınca çerçeveyi kaldır */
}

.checkbox-group {
    padding-left: 10px; /* Checkbox grubu iç boşluk */
}

.checkbox-item {
    margin-bottom: 10px; /* Checkbox item boşluk */
}

.form-checkbox {
    margin-right: 10px; /* Checkbox ile etiket arası boşluk */
}

.checkbox-label {
    font-size: 14px; /* Checkbox etiket yazı boyutu */
}

.form-button {
    display: block; /* Tam genişlik */
    width: 100%; /* Buton genişliği */
    padding: 10px; /* İç boşluk */
    background-color: #4CAF50; /* Buton rengi */
    color: white; /* Yazı rengi */
    border: none; /* Çerçeve yok */
    border-radius: 4px; /* Köşeleri yuvarlar */
    cursor: pointer; /* Fare işaretçisi */
    font-size: 16px; /* Yazı boyutu */
    font-weight: bold; /* Yazı kalınlığı */
    margin-top: 10px; /* Üst boşluk */
}

.form-button:hover {
    background-color: #45a049; /* Hover efekti */
}

    </style>
</head>
  <body class="sidebar">
  
    <div class="chitchat-container sidebar-toggle">
      <nav class="main-nav on custom-scroll">
        <div class="logo-warpper"><a href="messenger.html"><img src="assets/images/logo/logo.png" alt="logo"/></a></div>
        <div class="sidebar-main">
          <ul class="sidebar-top">
            
            <li><a class="icon-btn btn-light button-effect" href="favourite" data-tippy-content="Favourite"><i class="fa fa-star">               </i></a></li>
            <li><a class="icon-btn btn-light button-effect" href="document" data-tippy-content="Document"> <i class="fa fa-file-text">       </i></a></li>
            <li>
                <a class="icon-btn btn-light button-effect" href="contact-list" data-tippy-content="Contact List"> 
                    <i class="fa fa-envelope"></i>
                </a>
            </li>
            <li>
                <div class="dot-btn dot-success grow">
                    <a class="icon-btn btn-light button-effect" href="notification" data-tippy-content="Grup Oluştur"> 
                        <i class="fa fa-users"></i>
                    </a>
                </div>
            </li>
            
          </ul>
          <ul class="sidebar-bottom">         
            <li><a class="icon-btn btn-light button-effect mode" href="#" data-tippy-content="Theme Mode" data-intro="Change mode"><i class="fa fa-moon-o"></i></a></li>
            <li><a class="icon-btn btn-light" href="login.html" data-tippy-content=" SignOut"> <i class="fa fa-power-off">  </i></a></li>
          </ul>
        </div>
      </nav>
      <aside class="chitchat-left-sidebar left-disp">
        <div class="recent-default dynemic-sidebar active">
          <div class="recent">
            <div class="theme-title">
              <div class="d-flex">
                <div> 
                  <h2>Sohbet</h2>
                  <h4>Biada Group Çalışanları</h4>
                </div>
                <div class="flex-grow-1"><a class="icon-btn btn-outline-light button-effect pull-right mobile-back" href="#"><i class="ti-angle-right"></i></a><a class="icon-btn btn-outline-light button-effect pull-right mainnav" href="#"><i class="ti-layout-grid2"></i></a></div>
              </div>
            </div>
            
          </div>
          <div style="margin-top: 0px !important ;margin-bottom: 0px !important; height: calc(100vh ) !important;" class="chat custom-scroll">
            <ul class="chat-cont-setting">
              <li> <a href="#" data-bs-toggle="modal" data-bs-target="#msgchatModal"><span>new chat</span>
                  <div class="icon-btn btn-outline-primary button-effect btn-sm"><i data-feather="message-square"></i></div></a></li>
              <li><a href="#" data-bs-toggle="modal" data-bs-target="#msgcallModal"><span>new call</span>
                  <div class="icon-btn btn-outline-success button-effect btn-sm"><i data-feather="phone"></i></div></a></li>
              <li><a href="#" data-bs-toggle="modal" data-bs-target="#exampleModalCenter"><span>new Contact</span>
                  <div class="icon-btn btn-outline-danger button-effect btn-sm"><i data-feather="users"></i></div></a></li>
            </ul>
            <div class="theme-title">
              <div class="d-flex">
                <div> 
                  <h2>Sohbet</h2>
                  <h4>Yeni Konuşma Başlat</h4>
                </div>
                <div class="flex-grow-1"><a class="icon-btn btn-outline-light btn-sm search contact-search" href="#"> <i data-feather="search"></i></a>
                  <form class="form-inline search-form">
                    <div class="form-group">
                      <input class="form-control-plaintext" type="search" placeholder="Search.."/>
                      <div class="icon-close close-search"> <i data-feather="x">                </i></div>
                    </div>
                  </form><a class="icon-btn btn-primary btn-fix chat-cont-toggle outside" href="#"><i data-feather="plus"></i></a>
                </div>
              </div>
            </div>
            <div class="theme-tab tab-sm chat-tabs">     
              <ul class="nav nav-tabs" id="myTab" role="tablist">
                
              </ul>
              <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="chat" role="tabpanel" aria-labelledby="chat-tab"> 
                  <div class="theme-tab">       
                    <ul class="nav nav-tabs" id="myTab1" role="tablist">
                      
                    </ul>
                    <div class="tab-content" id="myTabContent1">
                      <div class="tab-pane fade show active" id="direct" role="tabpanel" aria-labelledby="direct-tab"> 
                        <ul class="chat-main">

                        
                            {% for group in groups %}
                                       
                                          <a href="{% url 'users:group_chat' group.id %}" >
                                            <li  data-to="group_blank">
                                            {% grup_kullanici_ayrimi group.id request.user as grp %}
                                            
                                            <div class="group-box">
                                              <div class="profile">
                                              {% if grp.resim == "0" %}
                                                <img class="bg-img" src="{% static 'go/chat/resimler/grup.png' %}" alt="Avatar"/>
                                              {% elif grp.resim == "1" %}
                                              <img class="bg-img" src="{% static 'go/images/avatar.png' %}" alt="Avatar"/>
                                              {% else %}
                                              <img class="bg-img" src="{{grp.resim}}" alt="Avatar"/>
                                              {% endif %}
                                              </div>
                                              <div class="details">
                                                <h5>{{grp.isim}}</h5>
                                                <h6>{% sonmesaj group.id  %}</h6>
                                              </div>
                                              <div class="date-status">
                                                <ul class="grop-icon">
                                                 
                                                </ul>
                                              </div>
                                              </div>
                                            
                                          </li></a>
                                          {% endfor %}
                        </ul>
                      </div>
                      <div class="tab-pane fade" id="group" role="tabpanel" aria-labelledby="group-tab"> 
                        <div class="search2">
                          <div>
                            <div class="input-group">
                              <div class="input-group-append"><span class="input-group-text"><i class="fa fa-search"></i></span></div>
                              <input class="form-control" type="text" placeholder="Start Sohbet"/>
                            </div>
                          </div>
                        </div>
                        <ul class="group-main">
                          
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
               
              </div>
            </div>
          </div>
        </div>
        <div class="fevorite-tab custom-scrollbar dynemic-sidebar" id="favourite">
          <div class="theme-title">
            <div class="d-flex">
              <div> 
                <h2>Favourite</h2>
                <h4>Last Recent</h4>
              </div>
              <div class="flex-grow-1"><a class="icon-btn btn-outline-light btn-sm m-r-15 search" href="#"> <i data-feather="search"></i></a>
                <form class="form-inline search-form">
                  <div class="form-group">
                    <input class="form-control-plaintext" type="search" placeholder="Search.."/>
                    <div class="icon-close close-search"><i data-feather="x"></i></div>
                  </div>
                </form><a class="icon-btn btn-outline-light btn-sm m-r-15" href="#" data-bs-toggle="modal" data-bs-target="#addcallmodal"><i data-feather="plus">                              </i></a><a class="icon-btn btn-outline-light btn-sm close-panel" href="#"><i data-feather="x"></i></a>
              </div>
            </div>
          </div>
          <ul class="chat-main">
        
          </ul>
        </div>
        <div class="document-tab dynemic-sidebar" id="document">
          <div class="theme-title">
            <div class="d-flex">
              <div> 
                <h2>Document</h2>
                <h4>List of document</h4>
              </div>
              <div class="flex-grow-1"> <a class="icon-btn btn-outline-light btn-sm m-r-15 search" href="#"> <i data-feather="search"></i></a>
                <form class="form-inline search-form">
                  <div class="form-group">
                    <input class="form-control-plaintext" type="search" placeholder="Search.."/>
                    <div class="icon-close close-search"> <i data-feather="x">                              </i></div>
                  </div>
                </form><a class="icon-btn btn-outline-light btn-sm close-panel" href="#"><i data-feather="x"></i></a>
              </div>
            </div>
          </div>
          <ul class="chat-main">
            <li>
              <div class="chat-box">
                <div class="d-flex">
                  <div class="profile"><a class="icon-btn btn-outline-danger btn-xl pull-right rouded15" href="#"><i class="fa fa-file-code-o"></i></a></div>
                  <div class="details">
                    <h5>messenger.html</h5>
                    <h6>2, octomber 2023</h6>
                  </div>
                  <div class="flex-grow-1"><a class="icon-btn btn-outline-light btn-sm pull-right" href="assets/doc/messenger.html" target="_blank"><i data-feather="download"></i></a></div>
                </div>
              </div>
            </li>
            <li>
              <div class="chat-box">
                <div class="d-flex">
                  <div class="profile"><a class="icon-btn btn-outline-success btn-xl pull-right rouded15" href="#"><i class="fa fa-file-video-o"></i></a></div>
                  <div class="details">
                    <h5>chapter1.MP4</h5>
                    <h6>3, Octomber 2023</h6>
                  </div>
                  <div class="flex-grow-1"><a class="icon-btn btn-outline-light btn-sm pull-right" href="assets/doc/chapter1.MP4" target="_blank"> <i data-feather="download"></i></a></div>
                </div>
              </div>
            </li>
            <li>
              <div class="chat-box">
                <div class="d-flex">
                  <div class="profile"><a class="icon-btn btn-outline-primary btn-xl pull-right rouded15" href="#"><i class="fa fa-file-word-o"></i></a></div>
                  <div class="details">
                    <h5>salary.xlsx</h5>
                    <h6>5, Octomber 2023</h6>
                  </div>
                  <div class="flex-grow-1"><a class="icon-btn btn-outline-light btn-sm pull-right" href="assets/doc/salary.xlsx" target="_blank"> <i data-feather="download"></i></a></div>
                </div>
              </div>
            </li>
            <li>
              <div class="chat-box">
                <div class="d-flex">
                  <div class="profile"><a class="icon-btn btn-outline-warning btn-xl pull-right rouded15" href="#"><i class="fa fa-file-pdf-o"></i></a></div>
                  <div class="details">
                    <h5>document.pdf</h5>
                    <h6>7, Octomber 2023</h6>
                  </div>
                  <div class="flex-grow-1"><a class="icon-btn btn-outline-light btn-sm pull-right" href="assets/doc/document.pdf" target="_blank"> <i data-feather="download"></i></a></div>
                </div>
              </div>
            </li>
            <li>
              <div class="chat-box">
                <div class="d-flex">
                  <div class="profile"><a class="icon-btn btn-outline-danger btn-xl pull-right rouded15" href="#"><i class="fa fa-file-text-o"></i></a></div>
                  <div class="details">
                    <h5>details.txt</h5>
                    <h6>20, Octomber 2023</h6>
                  </div>
                  <div class="flex-grow-1"><a class="icon-btn btn-outline-light btn-sm pull-right" href="assets/doc/details.txt" target="_blank"> <i data-feather="download"></i></a></div>
                </div>
              </div>
            </li>
            <li>
              <div class="chat-box">
                <div class="d-flex">
                  <div class="profile"><a class="icon-btn btn-outline-success btn-xl pull-right rouded15" href="#"><i class="fa fa-file-code-o"></i></a></div>
                  <div class="details">
                    <h5>messenger.html</h5>
                    <h6>2, octomber 2023</h6>
                  </div>
                  <div class="flex-grow-1"><a class="icon-btn btn-outline-light btn-sm pull-right" href="assets/doc/messenger.html" target="_blank"><i data-feather="download"></i></a></div>
                </div>
              </div>
            </li>
          </ul>
        </div>
        <!-- Kullanıcılar Mesaj Kısmı -->
        <div class="contact-list-tab dynemic-sidebar custom-scroll" id="contact-list">
          <div class="theme-title">
            <div class="d-flex">
              <div> 
                <h2>Contact</h2>
                <h4>Start talking now</h4>
              </div>
              <div class="flex-grow-1"> <a class="icon-btn btn-outline-light btn-sm m-r-15 search" href="#"> <i data-feather="search"></i></a>
                <form class="form-inline search-form">
                  <div class="form-group">
                    <input class="form-control-plaintext" type="search" placeholder="Search.."/>
                    <div class="icon-close close-search"> <i data-feather="x">                    </i></div>
                  </div>
                </form><a class="icon-btn btn-outline-light btn-sm close-panel" href="#"><i data-feather="x"></i></a>
              </div>
            </div>
          </div>
          <ul class="chat-main">
          {% for user in users %}
                        
                          <li class="">
                          <a href="{% url 'users:user_chat' user.id %}" class="chat-box">
              <div class="chat-box">
                <div class="profile offline">
                    {% if user.image %}
                        <img class="bg-img" src="{{user.image.url}}" alt="Avatar"/>
                    {% else %}
                        
                        <img class="bg-img" src="{% static 'go/images/avatar.png' %}" alt="Avatar"/>
                    {% endif %}
                    </div>
                <div class="details">
                  <h5>{{ user.last_name }}</h5>
                  <h6></h6>
                </div>
                <div class="date-status">
                  <h6></h6>
                  <h6 class="font-success status"> Seen</h6>
                </div>
              </div>
               </a>
            </li>
                    {% endfor %}
            
            
          </ul>
        </div>
        <div class="status-tab custom-scroll dynemic-sidebar" id="status">
            <div class="theme-title">
                <div class="d-flex">
                  <div> 
                    <h2>Grup Oluştur</h2>
                    <h4>Kullanıcılarınızı Seçin</h4>
                  </div>
                  <div class="flex-grow-1"> <a class="icon-btn btn-outline-light btn-sm m-r-15 search" href="#"> <i data-feather="search"></i></a>
                    <form class="form-inline search-form">
                      <div class="form-group">
                        <input class="form-control-plaintext" type="search" placeholder="Search.."/>
                        <div class="icon-close close-search"> <i data-feather="x">                    </i></div>
                      </div>
                    </form><a class="icon-btn btn-outline-light btn-sm close-panel" href="#"><i data-feather="x"></i></a>
                  </div>
                </div>
              </div>
              <form method="post" action="/{{dil}}{% url 'users:create_group' %}" class="group-form">
                {% csrf_token %}
                <div class="form-group">
                    <label for="group_name" class="form-label">Group Name:</label>
                    <input type="text" id="group_name" name="group_name" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="group_name" class="form-label">Group image:</label>
                    <input type="text" id="group_name" name="image" class="form-input" >
                </div>
                <div class="form-group">
                    <label class="form-label">Select Members:</label>
                    <div class="checkbox-group">
                        {% for user in users %}
                            <div class="checkbox-item">
                                <input type="checkbox" id="user_{{ user.id }}" required name="members" value="{{ user.id }}" class="form-checkbox">
                                <label for="user_{{ user.id }}" class="checkbox-label">{{ user.last_name }}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                
                <button type="submit" class="form-button">Create Group</button>
            </form>
            
        </div>
      </aside>
      <div class="chitchat-main small-sidebar" id="content">
        <div class="chat-content tabto active">
          <div class="messages custom-scroll active" id="chating">
            <div class="contact-details">
              <div class="row">
                <form class="form-inline search-form">
                  <div class="form-group">
                    <input class="form-control-plaintext" type="search" placeholder="Search.."/>
                    <div class="icon-close close-search"> <i data-feather="x">   </i></div>
                  </div>
                </form>
                <div class="col-7">
                    {% if group %}
                        <div class="d-flex left">
                    <div class="media-left">
                      <div class="profile online menu-trigger">
                      {% grup_kullanici_ayrimi group.id request.user as grb  %}
                        {% if grb.resim == "0" %}
                            <img class="bg-img" src="{% static 'go/chat/resimler/grup.png' %}" alt="Avatar"/>
                    
                        {% elif grb.resim == "1" %}
                            <img class="bg-img" src="{% static 'go/images/profile.png' %}" alt="Avatar"/>
                        {% else %}
                            <img class="bg-img" src="{{grb.resim}}" alt="Avatar"/>
                        {% endif %}
                      
                      </div>
                    </div>
                    <div class="flex-grow-1">
                      <h5 class="mb-0">{{grb.isim}}</h5>
                      <div class="badge badge-success">Activea</div>
                    </div>
                    <div class="media-right">
                      
                    </div>
                  </div>
                    {% else %}
                    {% endif %}
                  
                </div>
                <div class="col px-0">
                
                </div>
              </div>
            </div>
            <div class="contact-chat">
            {% if group %}
                     <ul class="chatappend" id="chatappend">
                {% for message in messages %}
                {% if message.sender == request.user %}
                    <li class="replies">
                  <div class="d-flex">
                    <div class="profile">
                      {% if message.sender.image %}
                    <img class="bg-img" style="max-width: 50px !important;" src="{{ message.sender.image.url}}" alt="Avatar"/>
                    {% else %}
                    <img class="bg-img" style="max-width: 50px !important;" src="{% static 'go/images/profile.png' %}" alt="Avatar"/>
                    {% endif %}

                    </div>
                    <div class="flex-grow-1">
                      <div class="contact-name">
                        <h5>{{ message.sender.last_name }}</h5>
                        <h6>{{ message.timestamp }}</h6>
                        <ul class="msg-box">
                          <li class="msg-setting-main">
                            <div class="msg-dropdown-main">
                              <div class="msg-setting"><i class="ti-more-alt"></i></div>
                              <div class="msg-dropdown"> 
                                <ul>
                                  <li><a href="#"><i class="fa fa-share"></i>forward</a></li>
                                  <li><a href="#"><i class="fa fa-clone"></i>copy</a></li>
                                  <li><a href="#"><i class="fa fa-star-o"></i>rating</a></li>
                                  <li><a href="#"><i class="ti-trash"></i>delete</a></li>
                                </ul>
                              </div>
                            </div>
                            <h5>
                              {% if message.file %}
                                <a href="{{message.file}}" target="_blank"><img src="{{message.file}}" alt="Image" style="max-width: 200px; max-height: 200px;"/></a>
                              {% else %}
                              {% endif %}
                              
                              {{ message.content }}</h5>
                          </li>
                        
                        </ul>
                      </div>
                    </div>
                  </div>
                </li>
        
                {% else %}
                <li class="send">
                  <div class="d-flex">
                    <div class="profile">
                      {% if message.sender.image %}
                    <img class="bg-img" style="max-width: 50px !important;" src="{{ message.sender.image.url}}" alt="Avatar"/>
                    {% else %}
                    <img class="bg-img" style="max-width: 50px !important;" src="{% static 'go/images/profile.png' %}" alt="Avatar"/>
                    {% endif %}
                    </div>
                    <div class="flex-grow-1">
                      <div class="contact-name">
                        <h5>{{ message.sender.last_name }}</h5>
                        <h6>{{ message.timestamp }}</h6>
                        <ul class="msg-box">
                          <li class="msg-setting-main">
                            <div class="msg-dropdown-main">
                              <div class="msg-setting"><i class="ti-more-alt"></i></div>
                              <div class="msg-dropdown"> 
                                <ul>
                                  <li><a href="#"><i class="fa fa-share"></i>forward</a></li>
                                  <li><a href="#"><i class="fa fa-clone"></i>copy</a></li>
                                  <li><a href="#"><i class="fa fa-star-o"></i>rating</a></li>
                                  <li><a href="#"><i class="ti-trash"></i>delete</a></li>
                                </ul>
                              </div>
                            </div>
                            <h5>{{ message.content }}</h5>
                          </li>
                        
                        </ul>
                      </div>
                    </div>
                  </div>
                </li>
        
                {% endif %}
           
            {% endfor %}

              </ul>
                    {% else %}
                    {% endif %}
              
            </div>
          </div>
          <div class="messages custom-scroll" id="blank">
            <div class="contact-details">
              <div class="row">
                <div class="col">
                  <div class="d-flex left">
                    <div class="media-left me-3">
                      <div class="profile online menu-trigger"><img class="bg-img" src="assets/images/contact/2.jpg" alt="Avatar"/></div>
                    </div>
                    <div class="flex-grow-1">
                      
                    </div>
                    <div class="media-right">
                      <ul>
                        <li><a class="icon-btn btn-light button-effect mute" href="#"><i class="fa fa-volume-up"></i></a></li>
                        <li><a class="icon-btn btn-light search search-right" href="#"> <i data-feather="search"></i></a>
                          <form class="form-inline search-form">
                            <div class="form-group">
                              <input class="form-control-plaintext" type="search" placeholder="Search.."/>
                              <div class="icon-close close-search"> <i data-feather="x"></i></div>
                            </div>
                          </form>
                        </li>
                        <li><a class="icon-btn btn-light button-effect mobile-sidebar" href="#"><i data-feather="chevron-left"></i></a></li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="col"> 
                  <ul class="calls text-end">
                    <li><a class="icon-btn btn-light button-effect" href="#" data-tippy-content="Quick Audio Call" data-bs-toggle="modal" data-bs-target="#audiocall"><i data-feather="phone"></i></a></li>
                    <li><a class="icon-btn btn-light button-effect" href="#" data-tippy-content="Quick Video Call" data-bs-toggle="modal" data-bs-target="#videocall"><i data-feather="video"></i></a></li>
                    <li><a class="icon-btn btn-light button-effect apps-toggle" href="#" data-tippy-content="All Apps"><i class="ti-layout-grid2"></i></a></li>
                    <li class="chat-friend-toggle"><a class="icon-btn btn-light bg-transparent button-effect outside" href="#" data-tippy-content="Quick action"><i data-feather="more-vertical"></i></a>
                      <div class="chat-frind-content">
                        <ul>
                          <li><a class="icon-btn btn-outline-primary button-effect btn-sm" href="#"><i data-feather="user"></i></a>
                            <h5>profile</h5>
                          </li>
                          <li><a class="icon-btn btn-outline-success button-effect btn-sm" href="#"><i data-feather="plus-circle"></i></a>
                            <h5>archive</h5>
                          </li>
                          <li><a class="icon-btn btn-outline-danger button-effect btn-sm" href="#"><i data-feather="trash-2"></i></a>
                            <h5>delete</h5>
                          </li>
                          <li><a class="icon-btn btn-outline-light button-effect btn-sm" href="#"><i data-feather="slash"></i></a>
                            <h5>block</h5>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="contact-chat">
              <div class="rightchat animat-rate">
                <div class="bg_circle">
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                </div>
                <div class="cross"></div>
                <div class="cross1"></div>
                <div class="cross2"></div>
                <div class="dot"></div>
                <div class="dot1"> </div>
              </div>
            </div>
            <div class="call-list-center"><img src="assets/images/chat.png" alt=""/>
              <div class="animated-bg"><i></i><i></i><i></i></div>
              <p>Select a chat to read messages</p>
            </div>
          </div>
          <div class="messages custom-scroll" id="group_chat">
            <div class="contact-details">
              <div class="row">
                <div class="col">
                  <div class="d-flex left">
                    <div class="media-left me-3">
                      <div class="profile online menu-trigger"><img class="bg-img" src="assets/images/avtar/teq.jpg" alt="Avatar"/></div>
                    </div>
                    <div class="flex-grow-1">
                      <h5>Tech Ninjas</h5>
                      <div class="badge badge-success">Active</div>
                    </div>
                    <div class="media-right">
                      <ul>
                        <li><a class="icon-btn btn-light button-effect mute" href="#"><i class="fa fa-volume-up"></i></a></li>
                        <li><a class="icon-btn btn-light search search-right" href="#"> <i data-feather="search"></i></a>
                          <form class="form-inline search-form">
                            <div class="form-group">
                              <input class="form-control-plaintext" type="search" placeholder="Search.."/>
                              <div class="icon-close close-search"><i data-feather="x"></i></div>
                            </div>
                          </form>
                        </li>
                        <li><a class="icon-btn btn-light button-effect mobile-sidebar" href="#"><i data-feather="chevron-left"></i></a></li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="col"> 
                  <ul class="calls text-end">
                    <li><a class="icon-btn btn-light button-effect" href="#" data-tippy-content="Start Audio Conference" data-bs-toggle="modal" data-bs-target="#confercall"><i data-feather="phone"></i></a></li>
                    <li><a class="icon-btn btn-light button-effect" href="#" data-tippy-content="Start Video Conference" data-bs-toggle="modal" data-bs-target="#confvideocl"><i data-feather="video"></i></a></li>
                    <li><a class="icon-btn btn-light button-effect apps-toggle" href="#" data-tippy-content="All Apps"><i class="ti-layout-grid2"></i></a></li>
                    <li class="chat-friend-toggle"><a class="icon-btn btn-light bg-transparent button-effect outside" href="#" data-tippy-content="Quick action"></a>
                      <div class="chat-frind-content">
                        <ul>
                          <li><a class="icon-btn btn-outline-primary button-effect btn-sm" href="#"><i data-feather="user"></i></a>
                            <h5>profile</h5>
                          </li>
                          <li><a class="icon-btn btn-outline-success button-effect btn-sm" href="#"><i data-feather="plus-circle"></i></a>
                            <h5>archive</h5>
                          </li>
                          <li><a class="icon-btn btn-outline-danger button-effect btn-sm" href="#"><i data-feather="trash-2"></i></a>
                            <h5>delete</h5>
                          </li>
                          <li><a class="icon-btn btn-outline-light button-effect btn-sm" href="#"><i data-feather="slash"></i></a>
                            <h5>block</h5>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          
          </div>
          <div class="messages custom-scroll" id="group_blank">
            <div class="contact-details">
              <div class="row">
                <div class="col">
                  <div class="d-flex left">
                    <div class="media-left me-3">
                      <div class="profile online menu-trigger"><img class="bg-img" src="assets/images/avtar/family.jpg" alt="Avatar"/></div>
                    </div>
                    <div class="flex-grow-1">
                      <h5>Family Ties</h5>
                      <h6>Last Seen 2 hours</h6>
                    </div>
                    <div class="media-right">
                      <ul>
                        <li><a class="icon-btn btn-light button-effect mute" href="#"><i class="fa fa-volume-up"></i></a></li>
                        <li><a class="icon-btn btn-light search search-right" href="#"> <i data-feather="search"></i></a>
                          <form class="form-inline search-form">
                            <div class="form-group">
                              <input class="form-control-plaintext" type="search" placeholder="Search.."/>
                              <div class="icon-close close-search"> <i data-feather="x"></i></div>
                            </div>
                          </form>
                        </li>
                        <li><a class="icon-btn btn-light button-effect mobile-sidebar" href="#"><i data-feather="chevron-left"></i></a></li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="col"> 
                  <ul class="calls text-end">
                    <li><a class="icon-btn btn-light button-effect" href="#" data-tippy-content="Quick Audio Call" data-bs-toggle="modal" data-bs-target="#confercall"><i data-feather="phone"></i></a></li>
                    <li><a class="icon-btn btn-light button-effect" href="#" data-tippy-content="Quick Video Call" data-bs-toggle="modal" data-bs-target="#confvideocl"><i data-feather="video"></i></a></li>
                    <li><a class="icon-btn btn-light button-effect apps-toggle" href="#" data-tippy-content="All Apps"><i class="ti-layout-grid2"></i></a></li>
                    <li class="chat-friend-toggle"><a class="icon-btn btn-light bg-transparent button-effect outside" href="#" data-tippy-content="Quick action"><i data-feather="more-vertical"></i></a>
                      <div class="chat-frind-content">
                        <ul>
                          <li><a class="icon-btn btn-outline-primary button-effect btn-sm" href="#"><i data-feather="user"></i></a>
                            <h5>profile</h5>
                          </li>
                          <li><a class="icon-btn btn-outline-success button-effect btn-sm" href="#"><i data-feather="plus-circle"></i></a>
                            <h5>archive</h5>
                          </li>
                          <li><a class="icon-btn btn-outline-danger button-effect btn-sm" href="#"><i data-feather="trash-2"></i></a>
                            <h5>delete</h5>
                          </li>
                          <li><a class="icon-btn btn-outline-light button-effect btn-sm" href="#"><i data-feather="slash"></i></a>
                            <h5>block</h5>
                          </li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="contact-chat">
              <div class="rightchat animat-rate">
                <div class="bg_circle">
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                </div>
                <div class="cross"></div>
                <div class="cross1"></div>
                <div class="cross2"></div>
                <div class="dot"></div>
                <div class="dot1"> </div>
              </div>
            </div>
            <div class="call-list-center"><img src="assets/images/chat.png" alt=""/>
              <div class="animated-bg"><i></i><i></i><i></i></div>
              <p>Select a chat to read messages</p>
            </div>
          </div>
          
          <div class="message-input">
            <div class="wrap emojis-main">
              <div class="dot-btn dot-primary"><a class="icon-btn btn-outline-primary button-effect toggle-emoji" href="#"><i data-feather="smile"></i></a></div>
              <div class="contact-poll">
              

              </div>
              <input type="file" id="file-input" accept="image/*,application/pdf" />
              <input class="setemoj" id="message-input" name="content" type="text" placeholder="Write your message..."/>
              <button class=" icon-btn btn-primary " id="send-message" type="submit"  ><i data-feather="send"></i></button>
              
              <div class="emojis-contain">
                <div class="emojis-sub-contain custom-scroll">
                  <ul>
                    <li>&#128512;</li>
                    <li>&#128513;</li>
                    <li>&#128514;</li>
                    <li>&#128515;</li>
                    <li>&#128516;</li>
                    <li>&#128517;</li>
                    <li>&#128518;</li>
                    <li>&#128519;</li>
                    <li>&#128520;</li>
                    <li>&#128521;</li>
                    <li>&#128522;</li>
                    <li>&#128523;</li>
                    <li>&#128524;</li>
                    <li>&#128525;</li>
                    <li>&#128526;</li>
                    <li>&#128527;</li>
                    <li>&#128528;</li>
                    <li>&#128529;</li>
                    <li>&#128530;</li>
                    <li>&#128531;</li>
                    <li>&#128532;</li>
                    <li>&#128533;</li>
                    <li>&#128534;</li>
                    <li>&#128535;</li>
                    <li>&#128536;</li>
                    <li>&#128537;</li>
                    <li>&#128538;</li>
                    <li>&#128539;</li>
                    <li>&#128540;</li>
                    <li>&#128541;</li>
                    <li>&#128542;</li>
                    <li>&#128543;</li>
                    <li>&#128544;</li>
                    <li>&#128545;</li>
                    <li>&#128546;</li>
                    <li>&#128547;</li>
                    <li>&#128549;</li>
                    <li>&#128550;</li>
                    <li>&#128551;</li>
                    <li>&#128552;</li>
                    <li>&#128553;</li>
                    <li>&#128554;</li>
                    <li>&#128555;</li>
                    <li>&#128557;</li>
                    <li>&#128558;</li>
                    <li>&#128559;</li>
                    <li>&#128560;</li>
                    <li>&#128561;</li>
                    <li>&#128562;</li>
                    <li>&#128563;</li>
                    <li>&#128564;</li>
                    <li>&#128565;</li>
                    <li>&#128566;</li>
                    <li>&#128567;</li>
                    <li>&#128568;</li>
                    <li>&#128569;</li>
                    <li>&#128570;</li>
                    <li>&#128571;</li>
                    <li>&#128572;</li>
                    <li>&#128573;</li>
                    <li>&#128574;</li>
                    <li>&#128576;                    </li>
                    <li>&#128579;                    </li>
                  </ul>
                </div>
              </div>
        </div>
       

      </div>
    </div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const roomName = document.querySelector('body').dataset.roomName;  
    const chatSocket = new WebSocket('ws://' + window.location.host + '/ws/chat/' + '{{ group.id }}/');

    chatSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        console.log('Received data:', data);  // Debugging log
        const chatLog = document.getElementById('chatappend');
        console.log('Chat log element:', chatLog);  // Debugging log

        const isSender = data.user === "{{ user.username }}";
        console.log('Is sender:', isSender);  // Debugging log

        if (data.file_url === null) {
            chatLog.innerHTML += `
            <li class="${isSender ? 'replies' : 'send'}">
                <div class="d-flex">
                    <div class="profile">
                    {% if user.image %}
                    <img class="bg-img" style="max-width: 50px !important;" src="{{ user.image.url}}" alt="Avatar"/>
                    {% else %}
                    <img class="bg-img" style="max-width: 50px !important;" src="{% static 'go/images/profile.png' %}" alt="Avatar"/>
                    {% endif %}
                        
                    </div>
                    <div class="flex-grow-1">
                        <div class="contact-name">
                            <h5>${data.user}</h5>
                            <h6>${new Date().toLocaleTimeString()}</h6>
                            <ul class="msg-box">
                                <li class="msg-setting-main">
                                    <h5>${data.message}</h5>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </li>`;
        } else {
            const fileType = data.file_url.split(';')[0].split(':')[1];
            let fileDisplay = '';

            if (fileType.startsWith('image/')) {
              fileDisplay = `<a href="${data.file_url}" target="_blank"><img src="${data.file_url}" alt="Image" style="max-width: 200px; max-height: 200px;"/></a>`;
            } else if (fileType === 'application/pdf') {
              fileDisplay = `<embed src="${data.file_url}" type="application/pdf" width="200" height="200"/>`;
            } else {
              fileDisplay = `<a href="${data.file_url}" target="_blank">Dosyayı Görüntüle</a>`;
            }

            chatLog.innerHTML += `
            <li class="${isSender ? 'replies' : 'send'}">
                <div class="d-flex">
                    <div class="profile">
                                            {% if user.image %}
                    <img class="bg-img" style="max-width: 50px !important;" src="{{ user.image.url}}" alt="Avatar"/>
                    {% else %}
                    <img class="bg-img" style="max-width: 50px !important;" src="{% static 'go/images/profile.png' %}" alt="Avatar"/>
                    {% endif %}

                    </div>
                    <div class="flex-grow-1">
                        <div class="contact-name">
                            <h5>${data.user}</h5>
                            <h6>${new Date().toLocaleTimeString()}</h6>
                            <ul class="msg-box">
                                <li class="msg-setting-main">
                                    ${fileDisplay}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </li>`;
        }
    };

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    function sendMessage() {
        const messageInputDom = document.querySelector('#message-input');
        const fileInput = document.querySelector('#file-input');
        const message = messageInputDom.value;
        const file = fileInput.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = function() {
                const file_url = reader.result;
                chatSocket.send(JSON.stringify({
                    'message': message,
                    'file_url': file_url
                }));
            };
            reader.readAsDataURL(file);
        } else {
            chatSocket.send(JSON.stringify({
                'message': message,
                'file_url': null
            }));
        }

        messageInputDom.value = '';
        fileInput.value = '';
    }

    document.querySelector('#send-message').onclick = function(e) {
        sendMessage();
    };

    document.querySelector('#message-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            sendMessage();
        }
    });
});

</script>

    <script src="{% static 'go/chat/assets/js/jquery-3.7.1.min.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/owl.carousel.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/popper.min.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/tippy-bundle.iife.min.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/bootstrap.bundle.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/switchery.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/easytimer.min.js' %}">        </script>
    <script src="{% static 'go/chat/assets/js/index.js' %}">        </script>
    <script src="{% static 'go/chat/assets/js/feather-icon/feather.min.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/feather-icon/feather-icon.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/ckeditor/ckeditor.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/ckeditor/styles.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/ckeditor/adapters/jquery.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/ckeditor/ckeditor.custom.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/date-picker/datepicker.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/date-picker/datepicker.en.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/date-picker/datepicker.custom.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/jquery.magnific-popup.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/zoom-gallery.js' %}"></script>
    <script src="{% static 'go/chat/assets/js/script.js' %}"></script>

  </body>
</html>