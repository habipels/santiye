<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiadaGo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:ital,wght@0,300..900;1,300..900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./content/style/style.css">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://momentjs.com/downloads/moment.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/v/dt/dt-2.1.6/r-3.0.3/datatables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
        <!-- Konva.js ve PDF.js Kütüphaneleri -->
    <script src="https://cdn.jsdelivr.net/npm/konva@8.3.7/konva.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
        <style>

        #toolbar {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            width: max-content; 
        }

        /* Buton ve input stilleri */
        #toolbar input[type="file"] {
            display: none;
        }
        #toolbar label {
            background-color: #052941;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
        }
        #toolbar button {
            background-color: #22D6B5;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #toolbar button:hover, #toolbar label:hover {
            opacity: 0.8;
        }
        /* Responsive Düzen */
        @media (max-width: 600px) {
            #toolbar {
                flex-direction: column;
                align-items: center;
            }
            #toolbar label, #toolbar button {
                width: 100%;
                text-align: center;
            }
        }
               .modal-content {
            position: relative;
            background-color: #fefefe;
            margin: 5% auto; /* Ekranın ortasında yer alması için */
            padding: 20px;
            border: 1px solid #888;
            width: 720px; /* Resim genişliğine uygun */
            max-width: 90%; /* Responsive için maksimum genişlik */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-radius: 5px;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: black;
            text-decoration: none;
        }
        #captured-image {
            display: block;
            margin: 0 auto;
            border: 1px solid #ccc;
        }
        #download-link {
            display: block;
            text-align: center;
            margin-top: 15px;
            background-color: #007BFF;
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
        }
        #download-link:hover {
            opacity: 0.8;
        }
    </style>

</head>

<body>

    <aside class="sidebar">
        <div class="sidebar-toggle"><i class="icon icon-sidebar-right"></i><i class="icon icon-sidebar-left"></i></div>
        <div class="sidebar-logo">
            <div class="sidebar-logo-main-part"></div>
            <div class="sidebar-logo-second-part"></div>
            <div class="sidebar-logo-large-parts">
                <img src="./content/images/half-o.png">
                <img src="./content/images/o.png">
            </div>
        </div>
        <div class="sidebar-navs">
            <ul class="sidebar-nav">
                <li class="active"><a href="#"><i class="icon icon-dashboard"></i> <span>{% trans 'Dashboard' %}</span> </a></li>

                <li>
                    <a class="sidebar-sub-toggle" href="#"><i class="icon icon-super-admin"></i> <span>Super
                            Admin</span> <i class="icon icon-caret"></i></a>
                    <ul class="sidebar-sub-menu">
                        <li><a href="#" class="sidebar-sub-item">Altmenü</a></li>
                        <li><a href="#" class="sidebar-sub-item">Altmenü...</a></li>
                        <li>
                            <a class="sidebar-sub-toggle" href="#"><span>AltAltmenü</span> <i
                                    class="icon icon-caret"></i></a>
                            <ul class="sidebar-sub-menu">
                                <li><a href="#" class="sidebar-sub-item">Altmenü</a></li>
                                <li><a href="#" class="sidebar-sub-item">Altmenü</a></li>
                                <li><a href="#" class="sidebar-sub-item">Altmenü</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>

                <li><a href="#"><i class="icon icon-document"></i> <span>{% trans 'Raporlar' %}</span> </a></li>

                <li>
                    <a class="sidebar-sub-toggle" href="#"><i class="icon icon-santiye-yonetimi"></i> <span>Şantiye
                            Yönetimi</span> <i class="icon icon-caret"></i></a>
                    <ul class="sidebar-sub-menu">
                        <li><a href="#" class="sidebar-sub-item">Proje Yönetimi</a></li>
                        <li><a href="#" class="sidebar-sub-item">İş Emirleri</a></li>
                        <li><a href="#" class="sidebar-sub-item">Dosya Yöneticisi</a></li>
                        <li><a href="#" class="sidebar-sub-item">Taşeronlar</a></li>
                        <li><a href="#" class="sidebar-sub-item">Üst Yönetici</a></li>
                        <li><a href="#" class="sidebar-sub-item">Hakedişler</a></li>
                        <li><a href="#" class="sidebar-sub-item">Sözleşmeler</a></li>
                    </ul>
                </li>


                <li></li>
                <li><a href="#"><i class="icon icon-muhasebe"></i> <span>Muhasebe</span> </a></li>
                <li><a href="#"><i class="icon icon-profile"></i> <span>Personel</span> </a></li>
                <li><a href="#"><i class="icon icon-stok"></i> <span>Satın Alma ve Stok</span> </a></li>
                <li><a href="#"><i class="icon icon-users"></i> <span>Kullanıcılar</span> </a></li>
            </ul>
            <hr>
            <ul class="sidebar-nav">
                <li><a href="#"><i class="icon icon-notifications"></i> <span>{% trans 'Bildirimler' %}</span> </a></li>

                <li>
                    <a class="sidebar-sub-toggle" href="#"><i class="icon icon-settings"></i> <span>Ayarlar</span> <i
                            class="icon icon-caret"></i></a>
                    <ul class="sidebar-sub-menu">
                        <li>
                            <a class="sidebar-sub-toggle" href="#"><span>Kullanıcı Ayarları</span> <i
                                    class="icon icon-caret"></i></a>
                            <ul class="sidebar-sub-menu">
                                <li><a href="#" class="sidebar-sub-item">...</a></li>
                            </ul>
                        </li>
                        <li>
                            <a class="sidebar-sub-toggle" href="#"><span>Şantiye Ayarları</span> <i
                                    class="icon icon-caret"></i></a>
                            <ul class="sidebar-sub-menu">
                                <li><a href="#" class="sidebar-sub-item">Proje Tipi</a></li>
                                <li><a href="#" class="sidebar-sub-item">Şantiye</a></li>
                            </ul>
                        </li>
                        <li>
                            <a class="sidebar-sub-toggle" href="#"><span>Muhasebe Ayarları</span> <i
                                    class="icon icon-caret"></i></a>
                            <ul class="sidebar-sub-menu">
                                <li><a href="#" class="sidebar-sub-item">...</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><a href="#"><i class="icon icon-help"></i> <span>Destek ve Yardım</span> </a></li>
            </ul>
        </div>
    </aside>

    <div class="sidebar-mobile-toggle">
        <img src="./content/images/logo-sm.png" class="sidebar-mobile-sm-logo" alt="" />
        <i class="icon icon-chevron-right"></i>
    </div>

    <script>
        let sidebar = document.querySelector(".sidebar");
        let sidebarToggle = document.querySelector(".sidebar-toggle");
        let sidebarMobileToggle = document.querySelector(".sidebar-mobile-toggle");
        sidebarToggle.addEventListener("click", function () {
            sidebar.classList.toggle("sidebar-collapsed");
        })
        sidebarMobileToggle.addEventListener("click", function () {
            sidebar.classList.toggle("sidebar-collapsed");
        })

        $('.sidebar-sub-toggle').click(function () {
            $(this).next('.sidebar-sub-menu').slideToggle();
            $(this).next('.sidebar-sub-menu').toggleClass("open");
            $(this).find('.icon-caret').toggleClass('rotate');
        });
    </script>

    <header>
        <div class="header-search">
            <input type="search" name="search" id="search" placeholder="{% trans 'Uygulama içerisinde ara' %}">
            <button><i class="icon icon-search"></i></button>
        </div>
        <div class="header-actions">
            <div class="header-actions-dropdown">
                <a href="#"><i class="icon icon-dashboard"></i></a>
                <div class="actions-dropdown-content">
                    <div class="actions-dropdown-content-title">
                        Web Apps
                    </div>
                    <div class="actions-dropdown-content-apps">
                        <a href="#" class="adc-app">
                            <div class="adc-app-icon">
                                <img src="./content/images/google-play.png" alt="Google Play">
                            </div>
                            <div class="adc-app-title">Android</div>
                        </a>
                        <a href="#" class="adc-app">
                            <div class="adc-app-icon">
                                <img src="./content/images/appstore.png" alt="App Store">
                            </div>
                            <div class="adc-app-title">IOS</div>
                        </a>
                    </div>
                </div>
            </div>
            <a href="#" onclick="toggleFullScreen()"><i class="icon icon-fullscreen"></i></a>
            <a href="#"><i class="icon icon-moon"></i></a>
            <div class="header-actions-dropdown notifications-dropdown">
                <a href="#"><i class="icon icon-notification"></i></a>
                <div class="actions-dropdown-content">
                    <div class="actions-dropdown-content-title">
                        {% trans 'Bildirimler' %}
                        <span>12 {% trans 'adet yeni bildiriminiz var.' %}</span>
                    </div>
                    <div class="notifications-tabs">
                        <button onclick="notificationTab(event, 'notification-all')"
                            class="notification-tab-btn active">{% trans 'adet yeni bildiriminiz var.' %}
                            <span>22</span></button>
                        <button onclick="notificationTab(event, 'notification-unread')"
                            class="notification-tab-btn">Okunmamış <span>3</span></button>
                    </div>
                    <div class="notifications" id="notification-all">
                        <div class="notification">
                            <div class="notification-avatar">
                                <img src="./content/images/avatar-2.png" alt="Avatar">
                            </div>
                            <div class="notification-content notification-unread">
                                <div class="notification-title">tolga_info@biadagroup.com</div>
                                <div class="notification-subtitle">site_info - klasörler</div>
                                <div class="notification-date">07 Ağustos 2024 • 09:36</div>
                                <div class="notification-actions">
                                    <button class="notification-inspect-button">{% trans 'İncele' %}</button>
                                    <button class="notification-confirm-button">Onayla</button>
                                </div>
                            </div>
                        </div>
                        <div class="notification">
                            <div class="notification-avatar">
                                <img src="./content/images/avatar-2.png" alt="Avatar">
                            </div>
                            <div class="notification-content notification-unread">
                                <div class="notification-title">tolga_info@biadagroup.com</div>
                                <div class="notification-subtitle">site_info - klasörler</div>
                                <div class="notification-date">07 Ağustos 2024 • 09:36</div>
                                <div class="notification-actions">
                                    <button class="notification-inspect-button">{% trans 'İncele' %}</button>
                                    <button class="notification-confirm-button">Onayla</button>
                                </div>
                            </div>
                        </div>
                        <div class="notification">
                            <div class="notification-avatar">
                                <img src="./content/images/avatar-2.png" alt="Avatar">
                            </div>
                            <div class="notification-content notification-unread">
                                <div class="notification-title notification-title-success">Görevinizi tamamladınız</div>
                                <div class="notification-date">07 Ağustos 2024 • 09:36</div>
                            </div>
                        </div>
                        <div class="notification">
                            <div class="notification-avatar">
                                <img src="./content/images/avatar-2.png" alt="Avatar">
                            </div>
                            <div class="notification-content notification-unread">
                                <div class="notification-title notification-title-danger">Ödeme tarihini geçen bir
                                    faturanız bulunmaktadır.</div>
                                <div class="notification-date">07 Ağustos 2024 • 09:36</div>
                                <div class="notification-actions">
                                    <button class="notification-inspect-button">{% trans 'İncele' %}</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="notifications" id="notification-unread" style="display: none;">
                        <div class="notification">
                            <div class="notification-avatar">
                                <img src="./content/images/avatar-2.png" alt="Avatar">
                            </div>
                            <div class="notification-content notification-unread">
                                <div class="notification-title">tolga_info@biadagroup.com</div>
                                <div class="notification-subtitle">site_info - klasörler</div>
                                <div class="notification-date">07 Ağustos 2024 • 09:36</div>
                                <div class="notification-actions">
                                    <button class="notification-inspect-button">{% trans 'İncele' %}</button>
                                    <button class="notification-confirm-button">Onayla</button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <script>
                        function notificationTab(e, id) {
                            var i, x, notificationTabBtn;
                            x = document.getElementsByClassName("notifications");
                            for (i = 0; i < x.length; i++) {
                                x[i].style.display = "none";
                            }
                            notificationTabBtn = document.getElementsByClassName("notification-tab-btn");
                            for (i = 0; i < x.length; i++) {
                                notificationTabBtn[i].className = notificationTabBtn[i].className.replace(" active", "");
                            }
                            document.getElementById(id).style.display = "block";
                            e.currentTarget.className += " active";
                        }
                    </script>

                    <div class="notifications-footer">
                        <a href="#">Tümünü Gör <i class="icon icon-forward"></i></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-language-wrapper">
            <div class="header-language">
                <img src="./content/images/tr.png" alt="TR" class="header-language-flag">
                <span>Türkçe</span>
                <i class="icon icon-chevron-bottom"></i>
            </div>
            <div class="header-language-dropdown">
                <div class="language-selector">
                    <input type="radio" name="lang" id="lang-tr" checked>
                    <label for="lang-tr">
                        <img src="./content/images/tr.png" alt="TR">
                        Türkçe
                    </label>
                </div>
                <div class="language-selector">
                    <input type="radio" name="lang" id="lang-en">
                    <label for="lang-en">
                        <img src="./content/images/tr.png" alt="TR">
                        İngilizce
                    </label>
                </div>
                <div class="language-selector">
                    <input type="radio" name="lang" id="lang-ar">
                    <label for="lang-ar">
                        <img src="./content/images/tr.png" alt="TR">
                        Arapça
                    </label>
                </div>
            </div>
        </div>
        <div class="header-profile-wrapper">
            <div class="header-profile">
                <div class="profile-avatar">
                    <img src="./content/images/avatar.png" alt="Avatar">
                </div>
                <div class="profile-title">
                    <span>Welcome back 👋</span>
                    Johnathan
                </div>
                <i class="icon icon-chevron-bottom"></i>
            </div>
            <div class="header-profile-dropdown">
                <div class="profile-dropdown-title">
                    Johnathan
                    <span>Admin...</span>
                </div>
                <div class="profile-dropdown-actions">
                    <a href="#"><i class="icon icon-profile"></i> Profil</a>
                    <a href="#"><i class="icon icon-settings"></i> Ayarlar</a>
                    <a href="#"><i class="icon icon-lock"></i> Ekranı Kilitle</a>
                </div>
                <div class="profile-dropdown-logout">
                    <a href="#">Çıkış Yap</a>
                </div>
            </div>
        </div>
    </header>

    <main>


        <div class="page-header">
            <div class="page-info">
                <div class="page-title">
                    <a href="#"><i class="icon icon-arrow-circle-left"></i></a>
                    İş Emri
                </div>
                <ul class="page-breadcrumb">
                    <li><a href="#">{% trans 'Dashboard' %}</a></li>
                    <li><a href="#">{% trans 'Şantiye Yönetimi' %}</a></li>
                    <li><a href="#">İş Emri</a></li>
                </ul>
            </div>

            <div class="page-actions">
                <button class="page-primary-btn" onclick="openModal('is-emri-olustur')"><i class="icon icon-new"></i>
                    İş Emri Oluştur</button>
            </div>
        </div>

        <div class="large-stats-card table-card table-detail-card">
            <div class="stats-header">
                <div class="stats-title">İş Emri</div>
                <div class="stats-right">
                    <div class="stats-search">
                        <input type="text" name="stats-search" id="stats-search" placeholder="{% trans 'Ara' %}">
                        <button><i class="icon icon-search"></i></button>
                    </div>
                </div>
            </div>


            <div class="tab-navs">
                <button class="tab-navs-btn active" data-tab="Tümü">Tümü</button>
                <button class="tab-navs-btn " data-tab="New">Yeniler</button>
                <button class="tab-navs-btn " data-tab="Tamamlandı">Tamamlanan</button>
                <button class="tab-navs-btn " data-tab="Beklemede">Devam Eden</button>
                <button class="tab-navs-btn " data-tab="İptal Edildi">İptal Edilen</button>
            </div>

            <div class="tab-contents">

                <div class="tab-content active" id="tumu">
                    <div class="table-wrapper">
                        <table id="tumu-table">
                            <thead>
                                <tr>
                                    <th>Task Adı</th>
                                    <th>{% trans 'Açıklama' %}</th>
                                    <th>Atanan Kişi</th>
                                    <th>Başlangıç Tarihi</th>
                                    <th>Durum</th>
                                    <th>Aciliyet</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <div class="task-check">
                                            <input type="checkbox" id="task-check-1">
                                            Programla Alakalı Eksiklikler
                                        </div>
                                    </td>
                                    <td>biadago eksiklerini yap</td>
                                    <td>
                                        <div class="td-assigned-people">
                                            <div class="td-assigned-people-profiles">
                                                <img src="./content/images/assigned-people.jpg">
                                                <img src="./content/images/assigned-people.jpg">
                                                <img src="./content/images/assigned-people.jpg">
                                                <span>+8</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>01.01.2000</td>
                                    <td>
                                        <div class="td-info"><span class="status-highlight stats-lg">New</span></div>
                                    </td>
                                    <td>
                                        <div class="td-info"><span class="status-cancel stats-lg">HIGH</span></div>
                                    </td>
                                    <td>
                                        <div class="td-actions">
                                            <a class="status-success"><i class="icon icon-action-edit"></i></a>
                                            <a href="#" class="status-cancel"><i
                                                    class="icon icon-action-delete"></i></a>
                                            <div class="biadago-tooltip">
                                                <a><i class="icon icon-three-dots"></i></a>
                                                <div class="biadago-tooltip-content">
                                                    <a href="#">Durum Güncelle</a>
                                                    <a href="#">Süreç İzleme</a>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="task-check">
                                            <input type="checkbox" id="task-check-1">
                                            Programla Alakalı Eksiklikler
                                        </div>
                                    </td>
                                    <td>biadago eksiklerini yap</td>
                                    <td>
                                        <div class="td-assigned-people">
                                            <div class="td-assigned-people-profiles">
                                                <img src="./content/images/assigned-people.jpg">
                                                <img src="./content/images/assigned-people.jpg">
                                            </div>
                                        </div>
                                    </td>
                                    <td>01.01.2000</td>
                                    <td>
                                        <div class="td-info"><span class="status-success stats-lg">Tamamlandı</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="td-info"><span class="status-dark stats-lg">LOW</span></div>
                                    </td>
                                    <td>
                                        <div class="td-actions">
                                            <a class="status-success"><i class="icon icon-action-edit"></i></a>
                                            <a href="#" class="status-cancel"><i
                                                    class="icon icon-action-delete"></i></a>
                                            <div class="biadago-tooltip">
                                                <a><i class="icon icon-three-dots"></i></a>
                                                <div class="biadago-tooltip-content">
                                                    <a href="#">Durum Güncelle</a>
                                                    <a href="#">Süreç İzleme</a>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="task-check">
                                            <input type="checkbox" id="task-check-1">
                                            Programla Alakalı Eksiklikler
                                        </div>
                                    </td>
                                    <td>biadago eksiklerini yap</td>
                                    <td>
                                        <div class="td-assigned-people">
                                            <div class="td-assigned-people-profiles">
                                                <img src="./content/images/assigned-people.jpg">
                                            </div>
                                        </div>
                                    </td>
                                    <td>01.01.2000</td>
                                    <td>
                                        <div class="td-info"><span class="status-pending stats-lg">Beklemede</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="td-info"><span class="status-orange stats-lg">MEDIUM</span></div>
                                    </td>
                                    <td>
                                        <div class="td-actions">
                                            <a class="status-success"><i class="icon icon-action-edit"></i></a>
                                            <a href="#" class="status-cancel"><i
                                                    class="icon icon-action-delete"></i></a>
                                            <div class="biadago-tooltip">
                                                <a><i class="icon icon-three-dots"></i></a>
                                                <div class="biadago-tooltip-content">
                                                    <a href="#">Durum Güncelle</a>
                                                    <a href="#">Süreç İzleme</a>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="task-check">
                                            <input type="checkbox" id="task-check-1">
                                            Programla Alakalı Eksiklikler
                                        </div>
                                    </td>
                                    <td>biadago eksiklerini yap</td>
                                    <td>
                                        <div class="td-assigned-people">
                                            <div class="td-assigned-people-profiles">
                                                <img src="./content/images/assigned-people.jpg">
                                                <img src="./content/images/assigned-people.jpg">
                                                <img src="./content/images/assigned-people.jpg">
                                            </div>
                                        </div>
                                    </td>
                                    <td>01.01.2000</td>
                                    <td>
                                        <div class="td-info"><span class="status-cancel stats-lg">İptal Edildi</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="td-info"><span class="status-orange stats-lg">MEDIUM</span></div>
                                    </td>
                                    <td>
                                        <div class="td-actions">
                                            <a class="status-success"><i class="icon icon-action-edit"></i></a>
                                            <a href="#" class="status-cancel"><i
                                                    class="icon icon-action-delete"></i></a>
                                            <div class="biadago-tooltip">
                                                <a><i class="icon icon-three-dots"></i></a>
                                                <div class="biadago-tooltip-content">
                                                    <a href="#">Durum Güncelle</a>
                                                    <a href="#">Süreç İzleme</a>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>



            </div>

        </div>

        <script>
            let table = new DataTable('#tumu-table', {
                paging: false,
                searching: true,
                info: false
            });

            $('.tab-navs-btn').on('click', function () {
                $(".tab-navs-btn").removeClass("active");
                $(this).addClass("active");

                if ($(this).attr("data-tab") == "Tümü") {
                    table.search('').columns().search('').draw();
                } else {
                    table.column(4).search($(this).attr("data-tab")).draw();
                }

            });



            $('#stats-search').keyup(function () {
                table.search($(this).val()).draw();
            })
        </script>


    </main>




    <div class="modal" id="is-emri-olustur">
        <div class="modal-inner" style="width: 1000px">
            <div class="modal-header">
                İş Emri Oluştur
            </div>
            <div class="modal-body">
                <form>
                    <div class="modal-form-rows">
                        <div class="modal-form-row">
                            <div class="form-element">
                                <label for="baslik">Başlık Ekle</label>
                                <input type="text" name="baslik" id="baslik">
                            </div>
                            <div class="form-element">
                                <label for="aciklama">{% trans 'Açıklama' %}</label>
                                <input type="text" name="aciklama" id="aciklama">
                            </div>
                            <div class="form-row">
                                <div class="form-element">
                                    <label for="durum">Durum</label>
                                    <select name="durum" id="durum">
                                        <option value="" selected disabled></option>
                                        <option value="New">New</option>
                                        <option value="Beklemede">Beklemede</option>
                                        <option value="Tamamlandı">Tamamlandı</option>
                                        <option value="İptal Edildi">İptal Edildi</option>
                                    </select>
                                </div>
                                <div class="form-element">
                                    <label for="aciliyet">Aciliyet</label>
                                    <select name="aciliyet" id="aciliyet">
                                        <option value="" selected disabled></option>
                                        <option value="High">High</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Low">Low</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-element">
                                <label for="kisiler">Atama (Birden fazla atama için ctrl ile birlikte seçim yapınız)</label>
                                <select name="kisiler" id="kisiler">
                                    <option value="" selected disabled></option>
                                    <option value="Kişi">Kişi</option>
                                    <option value="Kişi">Kişi</option>
                                    <option value="Kişi">Kişi</option>
                                </select>
                            </div>
                            <div class="form-element">
                                <label for="tarih">Bitiş Tarihi</label>
                                <input type="date" name="tarih" id="tarih">
                            </div>
                        </div>
                        <div class="modal-form-row">
                            <div class="form-element">
                                <label for="katman">Katman</label>
                                <input type="text" name="katman" id="katman">
                            </div>
                            <div class="form-element">
                                <div class="plan-konumu-preview" onclick="openModal('plan-konumu', false)">
                                    <img src="./content/images/plan-konumu-preview.png" alt="Plan Konumu">
                                </div>
                            </div>
                            <div class="form-element">
                                <label for="ekler">Ekler</label>

                                <div class="file-input file-preview-input">
                                    <ul class="fileList">



                                        <label for="ekler">
                                            <button><i class="icon icon-file"></i>{% trans 'Dosya Seç' %}</button>
                                        </label>
                                    </ul>

                                    <input multiple type="file" name="ekler" id="ekler">
                                </div>


                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="form-action-secondary" type="button" onclick="closeModal()">Vazgeç</button>
                        <button class="form-action-primary" type="submit">İş Emri Oluştur</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <div class="modal" id="plan-konumu">
        <div class="modal-inner modal-fullscreen">
            <div class="modal-header">
                <div class="modal-title">Plan Konumu</div>
                <div class="modal-actions">
                   <!-- <a href="#" class="modal-action-primary"><i class="icon icon-pin"></i> Plan Konumunu Değiştir</a>
                    <a href="#" class="modal-action-remove">Plan Konumunu Sil <i class="icon icon-action-delete"></i></a>-->
                                <!-- Araç Çubuğu -->
                    <div id="toolbar">
                        <label for="file-upload">Proje Resmi Yükle (PDF veya JPG/PNG)</label>
                        <input type="file" id="file-upload" accept=".pdf,.jpg,.jpeg,.png"/>
                        <button id="save-btn" class="modal-action-primary"><i class="icon icon-pin"></i>Pinleri Kaydet</button>
                        <button id="capture-btn">Alanı Kırp ve Göster</button>
                    </div>
                    <a onclick="closeModal('plan-konumu')" class="modal-close-btn"><i class="icon icon-modal-close"></i></a>
                </div>
            </div>

                <!-- Konva Container -->
                <div id="container"></div>
                <!-- Modal -->
                <div id="capture-modal" class="modal">
                    <div class="modal-content">
                        <span class="close-btn">&times;</span>
                        <h3>Kırpılmış Alan:</h3>
                        <img id="captured-image" src="" alt="Captured Area">
                        <a id="download-link" href="#" download="captured_area.png">İndir</a>
                    </div>
                </div>
        </div>
    </div>

    <script>
        // Konva Stage ve Layer'ları oluşturma
        const stage = new Konva.Stage({
            container: 'container',
            width: window.innerWidth,
            height: window.innerHeight,
            draggable: true  // Panning
        });

        const gridLayer = new Konva.Layer();      // Izgara katmanı
        const imageLayer = new Konva.Layer();     // PDF veya Resim katmanı
        const pinLayer = new Konva.Layer();       // Pinler katmanı

        // Katmanları doğru sırayla ekleyerek pinLayer'ın en üstte olmasını sağla
        stage.add(gridLayer);
        stage.add(imageLayer);
        stage.add(pinLayer);

        // Izgara çizme fonksiyonu
        function drawGrid(layer, gridSize = 100) {
            layer.destroyChildren(); // Önceki çizimleri temizle
            const lines = [];

            // Izgara alanını çok geniş tutarak "sonsuz" gibi görünmesini sağlıyoruz
            const gridLimit = 10000; // Gridin genişliği ve yüksekliği

            // Dikey çizgiler
            for (let i = -gridLimit; i <= gridLimit; i += gridSize) {
                lines.push(new Konva.Line({
                    points: [i, -gridLimit, i, gridLimit],
                    stroke: '#ddd', // Izgara çizgi rengi
                    strokeWidth: 1
                }));
            }

            // Yatay çizgiler
            for (let j = -gridLimit; j <= gridLimit; j += gridSize) {
                lines.push(new Konva.Line({
                    points: [-gridLimit, j, gridLimit, j],
                    stroke: '#ddd', // Izgara çizgi rengi
                    strokeWidth: 1
                }));
            }

            layer.add(...lines);
            layer.batchDraw();
        }

        drawGrid(gridLayer, 100); // Izgara katmanını çiz

        // Pin simgesi için SVG veri URI
        const pinSVG = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path fill="red" d="M12 2C8.1 2 5 5.1 5 9c0 5.3 7 13 7 13s7-7.7 7-13c0-3.9-3.1-7-7-7zm0 9.5c-1.4 0-2.5-1.1-2.5-2.5S10.6 6.5 12 6.5 14.5 7.6 14.5 9 13.4 11.5 12 11.5z"/>
            </svg>
        `;
        const pinImageSrc = 'data:image/svg+xml;base64,' + btoa(pinSVG);

        // Tek pin için referans
        let currentPin = null;

        // Pin ekleme fonksiyonu
        function addPin(x, y) {
            // Önceki pin varsa sil
            if (currentPin) {
                currentPin.destroy();
                currentPin = null;
            }

            const pin = new Konva.Image({
                x: x - 12,  // Centering (pin genişliği yarısı)
                y: y - 24,  // Adjust to show tip (pin yüksekliği)
                width: 24,
                height: 24,
                image: new Image(),
                draggable: false  // Pin sürüklenemez
            });

            const img = new Image();
            img.onload = () => {
                pin.image(img);
                pinLayer.add(pin);
                pinLayer.batchDraw();
                currentPin = pin; // Yeni pin referansını güncelle
            };
            img.src = pinImageSrc;

            // Sağ tıklama ile pin silme (masaüstü)
            pin.on('contextmenu', function(e) {
                e.evt.preventDefault();
                pin.destroy();
                pinLayer.batchDraw();
                currentPin = null;
            });

            // Uzun basma ile pin silme (mobil)
            pin.on('touchstart', function(e) {
                if (e.evt.touches && e.evt.touches.length > 1) return; // Çoklu dokunuşları yoksay
                // Uzun basma algılama
                const duration = 500; // 500ms uzun basma
                let timer;

                const touchMoveHandler = () => {
                    clearTimeout(timer);
                };

                const touchEndHandler = () => {
                    clearTimeout(timer);
                    window.removeEventListener('touchmove', touchMoveHandler);
                    window.removeEventListener('touchend', touchEndHandler);
                };

                window.addEventListener('touchmove', touchMoveHandler);
                window.addEventListener('touchend', touchEndHandler);

                timer = setTimeout(() => {
                    pin.destroy();
                    pinLayer.batchDraw();
                    currentPin = null;
                    window.removeEventListener('touchmove', touchMoveHandler);
                    window.removeEventListener('touchend', touchEndHandler);
                }, duration);
            });
        }

        // Stage'in scale ve position bilgilerine göre içerik koordinatlarını hesaplama
        function getTransformedPointerPosition() {
            const pointer = stage.getPointerPosition();
            if (!pointer) return null;
            const transform = stage.getAbsoluteTransform().copy().invert();
            return transform.point(pointer);
        }

        // Pin ekleme fonksiyonu - Sahneye tıklama veya dokunma
        stage.on('click tap', function(e) {
            // Dragging olmadığında pin ekle
            if (!stage.isDragging()) {
                const pos = getTransformedPointerPosition();
                if (pos) {
                    addPin(pos.x, pos.y);
                }
            }
        });

        // Zoom işlevi - Konva.js örneğinden uyarlanmıştır
        stage.on('wheel', (e) => {
            e.evt.preventDefault();
            const oldScale = stage.scaleX();
            const pointer = stage.getPointerPosition();

            const scaleBy = 1.1;
            let newScale = e.evt.deltaY > 0 ? oldScale / scaleBy : oldScale * scaleBy;
            newScale = Math.max(0.1, Math.min(newScale, 10)); // Zoom sınırları

            stage.scale({ x: newScale, y: newScale });

            // Zoom odak noktası
            const mousePointTo = {
                x: (pointer.x - stage.x()) / oldScale,
                y: (pointer.y - stage.y()) / oldScale,
            };

            const newPos = {
                x: pointer.x - mousePointTo.x * newScale,
                y: pointer.y - mousePointTo.y * newScale,
            };
            stage.position(newPos);
            stage.batchDraw();

            // Pinlerin ölçeğini sabit tutmak için her zoom işleminde pinleri ters orantılı ölçeklendir
            if (currentPin) {
                currentPin.scale({ x: 1 / newScale, y: 1 / newScale });
                pinLayer.batchDraw();
            }
        });

        // PDF yükleme fonksiyonu
        async function loadPDF(file) {
            try {
                const fileReader = new FileReader();
                fileReader.onload = async function(event) {
                    const typedArray = new Uint8Array(event.target.result);
                    const pdf = await pdfjsLib.getDocument(typedArray).promise;
                    console.log("PDF Yüklendi:", pdf);

                    const page = await pdf.getPage(1);  // İlk sayfayı yükle

                    const scale = 1.5;  // Performans için ölçek
                    const viewport = page.getViewport({ scale: scale });
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');

                    canvas.width = viewport.width;
                    canvas.height = viewport.height;

                    const renderContext = {
                        canvasContext: context,
                        viewport: viewport
                    };
                    await page.render(renderContext).promise;
                    console.log("PDF Render Edildi.");

                    // PDF'in canvas'ını Konva sahnesine ekle
                    const pdfImage = new Konva.Image({
                        x: 0,
                        y: 0,
                        image: canvas,
                        width: viewport.width,
                        height: viewport.height,
                        draggable: false,
                    });

                    imageLayer.destroyChildren(); // Önceki görüntüyü sil
                    imageLayer.add(pdfImage);
                    imageLayer.batchDraw();
                };
                fileReader.readAsArrayBuffer(file);
            } catch (error) {
                console.error("PDF Yükleme Hatası:", error);
                alert("PDF dosyası yüklenemedi. Lütfen geçerli bir PDF dosyası yükleyin.");
            }
        }

        // Resim yükleme fonksiyonu
        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const konvaImage = new Konva.Image({
                        x: 0,
                        y: 0,
                        image: img,
                        width: img.width,
                        height: img.height,
                        draggable: false,
                    });
                    imageLayer.destroyChildren(); // Önceki görüntüyü sil
                    imageLayer.add(konvaImage);
                    imageLayer.batchDraw();
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Dosya yükleme işlemi
        document.getElementById('file-upload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.type === 'application/pdf') {
                    loadPDF(file);
                } else if (file.type.startsWith('image/')) {
                    loadImage(file);
                } else {
                    alert("Lütfen geçerli bir PDF veya resim dosyası yükleyin!");
                }
            }
        });

        // Kaydet butonu - pin koordinatlarını kaydetme
        document.getElementById('save-btn').addEventListener('click', function() {
            if (currentPin) {
                const pinData = {
                    x: currentPin.x(),
                    y: currentPin.y(),
                };
                console.log('Pin Bilgileri:', JSON.stringify(pinData));
                alert('Pin başarıyla kaydedildi! Konsolu kontrol edin.');
            }
            else{
                alert("Henüz pin eklenmedi.");
            }
        });

        // Pencere yeniden boyutlandırıldığında sahneyi yeniden ayarlama
        window.addEventListener('resize', function() {
            stage.width(window.innerWidth);
            stage.height(window.innerHeight);
            drawGrid(gridLayer, 100); // Izgara katmanını yeniden çiz
            imageLayer.batchDraw();
            pinLayer.batchDraw();
        });

        // Modal kontrolü
        const modal = document.getElementById('capture-modal');
        const closeBtn = document.querySelector('.close-btn');

        // Modalı kapatma fonksiyonu
        closeBtn.onclick = function() {
            modal.style.display = "none";
        }

        // Modal dışında tıklayınca kapatma
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Area Capture (700x250 px) fonksiyonu
        document.getElementById('capture-btn').addEventListener('click', function() {
            if (!currentPin) {
                alert("Lütfen bir pin ekleyin.");
                return;
            }

            // Pin'in sahnedeki tam konumunu al
            const pinStagePos = currentPin.getAbsolutePosition();
            if (!pinStagePos) {
                alert("Pin pozisyonu alınamadı.");
                return;
            }
            const pinStageX = pinStagePos.x;
            const pinStageY = pinStagePos.y;

            console.log(`Pin'in stage koordinatları: (${pinStageX}, ${pinStageY})`);

            // 700x250 px'lik alanın sol üst köşesini hesapla (pin merkezde olacak)
            const captureWidth = 700;
            const captureHeight = 250;
            let captureX = pinStageX - (captureWidth / 2);
            let captureY = pinStageY - (captureHeight / 2);

            console.log(`Kırpılacak alanın sol üst köşesi: (${captureX}, ${captureY})`);

            // Kırpılacak alanın stage sınırları içinde kalmasını sağla
            captureX = Math.max(0, Math.min(captureX, stage.width() - captureWidth));
            captureY = Math.max(0, Math.min(captureY, stage.height() - captureHeight));

            console.log(`Sınırlandırılmış kırpma koordinatları: (${captureX}, ${captureY})`);

            // stage.toDataURL ile tüm katmanları dahil ederek kırp
            stage.toDataURL({
                x: captureX,
                y: captureY,
                width: captureWidth,
                height: captureHeight,
                pixelRatio: 1,
                callback: function(dataURL) {
                    // PNG oluştur ve göster
                    const capturedImage = document.getElementById('captured-image');
                    capturedImage.src = dataURL;

                    // İndirme linkini güncelle
                    const downloadLink = document.getElementById('download-link');
                    downloadLink.href = dataURL;
                    downloadLink.download = 'captured_area.png';

                    // Modalı göster
                    modal.style.display = "block";
                }
            });
        });
    </script>
    <script>
        function openModal(modalID, close = true) {
            if (close) {
                closeModal();
            }
            $("#" + modalID).css("display", "flex").hide().fadeIn()
        }

        function closeModal(modalID = "") {
            console.log(modalID.length);
            if (modalID.length === 0) {
                $(".modal").fadeOut();
            } else {
                $("#" + modalID).fadeOut();
            }
        }

        $(".modal").on("click", function (e) {
            if ($(e.target).closest('.modal-inner').length === 0 && $(e.target).closest('.modal').length) {
                closeModal();
            }
        });

        $(document).ready(function () {
            $('input[type="file"]').on('change', function () {
                var files = $(this).prop('files');
                var formElement = $(this).closest('.form-element');
                var fileList = formElement.find('.fileList');
                fileList.find('li:not(label)').remove();

                var selectedFiles = Array.from(files);

                for (var i = 0; i < selectedFiles.length; i++) {
                    (function (file) {
                        var listItem = $('<li></li>');

                        if (file.type.startsWith('image/') && (file.type === 'image/png' || file.type === 'image/jpeg' || file.type === 'image/webp')) {
                            var reader = new FileReader();
                            reader.onload = function (e) {
                                listItem.append(`
                                    <div class="file-input-uploaded">
                                        <div class="file-input-uploaded-head">
                                            <div class="file-input-uploaded-title" title="${file.name}">${file.name}</div>
                                            <button type="button" class="file-input-uploaded-remove"><i class="icon icon-trash"></i></button>
                                        </div>
                                        <div class="file-input-uploaded-preview">
                                            <img src="${e.target.result}">
                                        </div>
                                    </div>
                                `);
                                fileList.append(listItem);

                                listItem.find('.file-input-uploaded-remove').on('click', function () {
                                    $(this).closest('li').remove();
                                    selectedFiles = selectedFiles.filter(f => f.name !== file.name);
                                    updateInput(selectedFiles);
                                });
                            };
                            reader.readAsDataURL(file);
                        } else {
                            listItem.append(`
                                <div class="file-input-uploaded">
                                    <div class="file-input-uploaded-head">
                                        <div class="file-input-uploaded-title" title="${file.name}">${file.name}</div>
                                        <button type="button" class="file-input-uploaded-remove"><i class="icon icon-trash"></i></button>
                                    </div>
                                    <div class="file-input-uploaded-no-preview">
                                        <img src="./content/images/illustration-upload.png">
                                    </div>
                                </div>
                            `);
                            fileList.append(listItem);

                            listItem.find('.file-input-uploaded-remove').on('click', function () {
                                $(this).closest('li').remove();
                                selectedFiles = selectedFiles.filter(f => f.name !== file.name);
                                updateInput(selectedFiles);
                            });
                        }
                    })(selectedFiles[i]);
                }
            });
        });

        function updateInput(selectedFiles) {
            var dataTransfer = new DataTransfer();
            selectedFiles.forEach(function (file) {
                dataTransfer.items.add(file);
            });
            $('input[type="file"]').prop('files', dataTransfer.files);
        }


    </script>


    <script>
        function toggleFullScreen() {
            var doc = window.document;
            var docEl = doc.documentElement;

            var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
            var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

            if (!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
                requestFullScreen.call(docEl);
            }
            else {
                cancelFullScreen.call(doc);
            }
        }

        function updateMaxWidth() {
            var tableCardWidth = $(".table-card")[0].clientWidth;
            $(".table-wrapper").css("max-width", tableCardWidth + "px");
        }
        $(document).ready(updateMaxWidth);
        $(window).resize(updateMaxWidth);
    </script>

</body>

</html>