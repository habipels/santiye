<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gelişmiş Raporlama Dashboard</title>
    <link rel="stylesheet" href="global.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.21/jspdf.plugin.autotable.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .box-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .box {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .box h2 {
            margin-bottom: 20px;
        }
        .small-table {
            width: 100%;
            border-collapse: collapse;
        }
        .small-table th, .small-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .small-table th {
            background-color: #042940;
            color: white;
        }
        canvas {
            max-width: 100%;
            max-height: 200px;
        }
        .table-container {
            margin-top: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #042940;
            color: white;
        }
        button {
            background-color: #24d6b5;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 20px;
        }
        button:hover {
    background-color: #042940;  /* Arka plan beyaz olduğunda */
    color: #24d6b5;  /* Yazı rengi düzeltiliyor */
}

        .button-container {
            text-align: center;
        }

        @media (max-width: 768px) {
            .box-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="header">Depo ve Stok Raporlama Dashboard</h1>

    <!-- Box Yapısı: Stok, Zimmet, Kullanım, Kritik Stok ve Bakımdaki Ürünler -->
    <div class="box-container">
        <div class="box">
            <h2>Stok Durumu</h2>
            <canvas id="stockChart"></canvas>
        </div>
        <div class="box">
            <h2>Zimmet Dağılımı</h2>
            <canvas id="zimmetChart"></canvas>
        </div>
        <div class="box">
            <h2>Kullanım İstatistikleri</h2>
            <canvas id="usageChart"></canvas>
        </div>
        <div class="box">
            <h2>Kritik Stok</h2>
            <table class="small-table">
                <thead>
                    <tr>
                        <th>Ürün</th>
                        <th>Stok</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Köpük</td>
                        <td>10 adet</td>
                    </tr>
                    <tr>
                        <td>Epoksi</td>
                        <td>5 adet</td>
                    </tr>
                    <tr>
                        <td>Eldiven</td>
                        <td>8 adet</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="box">
            <h2>Bakımdaki Ürünler</h2>
            <table class="small-table">
                <thead>
                    <tr>
                        <th>Ürün</th>
                        <th>Durum</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Matkap</td>
                        <td>Bakımda</td>
                    </tr>
                    <tr>
                        <td>Hilti</td>
                        <td>Bakımda</td>
                    </tr>
                    <tr>
                        <td>Çekiç</td>
                        <td>Bakımda</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="box">
            <h2>Depo Durumu</h2>
            <canvas id="depoChart"></canvas>
        </div>
    </div>

    <!-- Veri Tablosu -->
    <div class="table-container">
        <h2>Depo ve Stok Verileri</h2>
        <table id="reportTable">
            <thead>
                <tr>
                    <th>Ürün Adı</th>
                    <th>Kategori</th>
                    <th>Stok Durumu</th>
                    <th>Zimmet Durumu</th>
                    <th>Kullanım Durumu</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Çekiç</td>
                    <td>El Aletleri</td>
                    <td>120 adet</td>
                    <td>Ahmet Yılmaz (05/09/2024)</td>
                    <td>5 kez kullanıldı</td>
                </tr>
                <tr>
                    <td>Matkap</td>
                    <td>Elektrik</td>
                    <td>30 adet</td>
                    <td>Mehmet Kaya (10/09/2024)</td>
                    <td>2 kez kullanıldı</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- PDF Export Butonu -->
    <div class="button-container">
        <button onclick="exportToPDF()">PDF'e Aktar</button>
    </div>
</div>

<script>
    // Grafikler için Chart.js kullanımı
    const stockCtx = document.getElementById('stockChart').getContext('2d');
    const zimmetCtx = document.getElementById('zimmetChart').getContext('2d');
    const usageCtx = document.getElementById('usageChart').getContext('2d');
    const depoCtx = document.getElementById('depoChart').getContext('2d');

    // Stok Grafiği
    const stockChart = new Chart(stockCtx, {
        type: 'bar',
        data: {
            labels: ['Çivi', 'Matkap', 'Hilti', 'Manila', 'Kriko'],
            datasets: [{
                label: 'Stok Durumu (adet)',
                data: [200, 30, 15, 10, 5],
                backgroundColor: ['#24d6b5', '#042940', '#ff6384', '#36a2eb', '#ffcd56']
            }],
            options: {
                maintainAspectRatio: true  // En-boy oranını koruma
            }
        }
    });

    // Zimmet Grafiği
    const zimmetChart = new Chart(zimmetCtx, {
        type: 'pie',
        data: {
            labels: ['Çivi - Ahmet Yılmaz', 'Matkap - Mehmet Kaya', 'Hilti - Ayşe Demir', 'Manila - Veli Kara', 'Kriko - Ali Aksoy'],
            datasets: [{
                data: [200, 30, 15, 10, 5],
                backgroundColor: ['#24d6b5', '#042940', '#ff6384', '#36a2eb', '#ffcd56']
            }]
        },
        options: {
            maintainAspectRatio: true  // En-boy oranını koruma
        }
    });

    // Kullanım Grafiği
    const usageChart = new Chart(usageCtx, {
        type: 'line',
        data: {
            labels: ['Ocak', 'Şubat', 'Mart', 'Nisan'],
            datasets: [{
                label: 'Kullanım Miktarı',
                data: [5, 7, 10, 12],
                borderColor: '#24d6b5',
                fill: false
            }],
            options: {
                maintainAspectRatio: true  // En-boy oranını koruma
            }
        }
    });

    // Depo Durumu Grafiği
    const depoChart = new Chart(depoCtx, {
        type: 'doughnut',
        data: {
            labels: ['Çivi', 'Matkap', 'Hilti', 'Manila', 'Kriko'],
            datasets: [{
                data: [200, 30, 15, 10, 5],
                backgroundColor: ['#24d6b5', '#042940', '#ff6384', '#36a2eb', '#ffcd56']
            }]
        },
        options: {
            maintainAspectRatio: true  // En-boy oranını koruma
        }
    });

    // DataTable Özellikleri: Filtreleme ve Sayfalama
    $(document).ready(function() {
        $('#reportTable').DataTable();
    });

    // PDF'e Aktarma İşlevi - Roboto yazı tipi ile ve yatay A4 formatında
    function exportToPDF() {
        const { jsPDF } = window.jspdf;

        // Roboto yazı tipini base64 olarak ekle
        const robotoBase64 = 'AAEAAAASAQAABAAgR0RFRrRRsGEAAAWQAAACYkdQT1PPSKF2AABKDAAAXcxHU1VCXH9RMgAANHwAABWQT1MvMpeCsagAAAIoAAAAYGNtYXC0y1S4AAAPoAAABoRjdnQgK6gHnQAAAdQAAABUZnBnbXf4YKsAAAPUAAABvGdhc3AACAATAAABLAAAAAxnbHlmJroL9AAAp9gAAelsaGRteFV6YHoAAAqIAAAFGGhlYWT8atJ6AAABnAAAADZoaGVhCroKrgAAAXgAAAAkaG10eK5yj5cAACBEAAAUOGxvY2GAd';  // Buraya Roboto base64 kodunu ekleyin
        const doc = new jsPDF({ orientation: 'landscape' });
        doc.addFileToVFS('Roboto-Regular.ttf', robotoBase64);
        doc.addFont('Roboto-Regular.ttf', 'Roboto', 'normal');
        doc.setFont('Roboto');

        // Başlık ekleme
        doc.setFontSize(18);
        doc.text("Depo ve Stok Raporu", 10, 10);

        // Stok Grafiğini PDF'e ekleme
        const stockCanvas = document.getElementById('stockChart');
        const stockImage = stockCanvas.toDataURL('image/png');
        doc.addImage(stockImage, 'PNG', 10, 20, 90, 60);

        // Zimmet Grafiğini PDF'e ekleme
        const zimmetCanvas = document.getElementById('zimmetChart');
        const zimmetImage = zimmetCanvas.toDataURL('image/png');
        doc.addImage(zimmetImage, 'PNG', 110, 20, 90, 60);

        // Kullanım Grafiğini PDF'e ekleme
        const usageCanvas = document.getElementById('usageChart');
        const usageImage = usageCanvas.toDataURL('image/png');
        doc.addImage(usageImage, 'PNG', 10, 90, 90, 60);

        // Depo Durumu Grafiğini PDF'e ekleme
        const depoCanvas = document.getElementById('depoChart');
        const depoImage = depoCanvas.toDataURL('image/png');
        doc.addImage(depoImage, 'PNG', 110, 90, 90, 60);

        // Kritik Stok ve Bakımdaki Ürünler tablolarını PDF'e ekleme
        doc.autoTable({ html: '.box:nth-child(4) table', startY: 160 });
        doc.autoTable({ html: '.box:nth-child(5) table', startY: doc.lastAutoTable.finalY + 10 });

        // Veri tablosunu PDF'e ekleme
        doc.autoTable({ html: '#reportTable', startY: doc.lastAutoTable.finalY + 20 });

        // PDF'i kaydetme
        const date = new Date();
        const fileName = `depo_stok_raporu_${date.getFullYear()}-${(date.getMonth() + 1)}-${date.getDate()}_${date.getHours()}-${date.getMinutes()}.pdf`;
        doc.save(fileName);
    }
</script>

</body>
</html>
